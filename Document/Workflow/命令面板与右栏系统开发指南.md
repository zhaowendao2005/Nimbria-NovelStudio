# å‘½ä»¤é¢æ¿ä¸å³ä¾§æ ç³»ç»Ÿå¼€å‘æŒ‡å—

> **ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-10-08  
> **é€‚ç”¨èŒƒå›´**: Nimbria Project Page System

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
4. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
5. [æ·»åŠ æ–°å‘½ä»¤](#æ·»åŠ æ–°å‘½ä»¤)
6. [æ·»åŠ æ–°é¢æ¿](#æ·»åŠ æ–°é¢æ¿)
7. [è·¨æ¨¡å—çŠ¶æ€è®¿é—®](#è·¨æ¨¡å—çŠ¶æ€è®¿é—®)
8. [ä¿®æ”¹ç°æœ‰åŠŸèƒ½](#ä¿®æ”¹ç°æœ‰åŠŸèƒ½)
9. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
11. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### è®¾è®¡åŸåˆ™

1. **æ’ä»¶åŒ–**: å‘½ä»¤å’Œé¢æ¿å‡é€šè¿‡æ’ä»¶æ³¨å†Œï¼Œæ ¸å¿ƒç³»ç»Ÿä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘
2. **è§£è€¦**: UIã€çŠ¶æ€ã€ä¸šåŠ¡é€»è¾‘ä¸¥æ ¼åˆ†ç¦»
3. **å»¶è¿ŸåŠ è½½**: é¢æ¿ç»„ä»¶ä½¿ç”¨ `defineAsyncComponent` åŠ¨æ€åŠ è½½
4. **å¤šçª—å£éš”ç¦»**: æ¯ä¸ªé¡¹ç›®çª—å£æ‹¥æœ‰ç‹¬ç«‹çš„ Pinia Store å®ä¾‹
5. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ

### ç³»ç»Ÿç»„æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ProjectPageSystem                     â”‚
â”‚  (åº”ç”¨å¯åŠ¨æ—¶ç»Ÿä¸€æ³¨å†Œæ‰€æœ‰æ’ä»¶)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  å‘½ä»¤é¢æ¿ç³»ç»Ÿ    â”‚    â”‚   å³ä¾§æ ç³»ç»Ÿ      â”‚
    â”‚ Command Palette â”‚    â”‚ Right Sidebar    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Command Store  â”‚    â”‚ Sidebar Store    â”‚
    â”‚  (Pinia)        â”‚    â”‚ (Pinia)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Command API   â”‚    â”‚  Sidebar API     â”‚
    â”‚   (å•ä¾‹æœåŠ¡)     â”‚    â”‚  (å•ä¾‹æœåŠ¡)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  å‘½ä»¤æ’ä»¶é›†åˆ    â”‚    â”‚  é¢æ¿æ’ä»¶é›†åˆ     â”‚
    â”‚  (Utils/Plugins) â”‚    â”‚  (Utils/Plugins) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
ç”¨æˆ·æ“ä½œ
  â†“
UI ç»„ä»¶ (CommandPalette.vue / RightSidebar.vue)
  â†“
API æœåŠ¡ (command.api.ts / rightSidebar.api.ts)
  â†“
Pinia Store (çŠ¶æ€ç®¡ç†)
  â†“
æ‰§è¡Œæ’ä»¶æ³¨å†Œçš„ action / æ¸²æŸ“æ’ä»¶æä¾›çš„ component
```

---

## ğŸ§© æ ¸å¿ƒæ¦‚å¿µ

### 1. å‘½ä»¤ (Command)

å‘½ä»¤æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„æ“ä½œï¼Œç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

```typescript
interface Command {
  id: string                           // å”¯ä¸€æ ‡è¯†ï¼ˆæ ¼å¼: category.actionï¼‰
  label: string                        // æ˜¾ç¤ºæ–‡æœ¬
  category: CommandCategory            // åˆ†ç±» (view/file/edit/navigate/tools/custom)
  action: () => void | Promise<void>   // æ‰§è¡Œå‡½æ•°ï¼ˆç”±æ’ä»¶æä¾›ï¼‰
  icon?: string                        // Element Plus icon name
  keywords?: string[]                  // æœç´¢å…³é”®è¯ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰
  shortcut?: string                    // å¿«æ·é”®æ˜¾ç¤ºæ–‡æœ¬ï¼ˆä»…å±•ç¤ºç”¨ï¼‰
  priority?: number                    // ä¼˜å…ˆçº§ï¼ˆæ•°å€¼è¶Šå¤§è¶Šé å‰ï¼‰
  when?: () => boolean                 // æ˜¾ç¤ºæ¡ä»¶ï¼ˆè¿”å›falseåˆ™ä¸æ˜¾ç¤ºï¼‰
}
```

**å…³é”®ç‚¹**:
- `action` å‡½æ•°**å¿…é¡»ç”±æ’ä»¶æä¾›**ï¼ŒåŒ…å«å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
- `when` å‡½æ•°ç”¨äºåŠ¨æ€æ§åˆ¶å‘½ä»¤æ˜¯å¦å¯è§ï¼ˆä¾‹å¦‚ï¼šä»…åœ¨æ‰“å¼€æ–‡ä»¶æ—¶æ˜¾ç¤ºï¼‰

### 2. é¢æ¿ (Panel)

é¢æ¿æ˜¯å³ä¾§æ ä¸­çš„ä¸€ä¸ªæ ‡ç­¾é¡µï¼Œç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

```typescript
interface RightSidebarPanel {
  id: string                    // å”¯ä¸€æ ‡è¯†
  label: string                 // æ ‡ç­¾æ–‡æœ¬
  component: Component          // Vueç»„ä»¶ï¼ˆç”±æ’ä»¶æä¾›ï¼‰
  icon?: string                 // Element Plus icon name
  closable?: boolean            // æ˜¯å¦å¯å…³é—­ï¼ˆé»˜è®¤trueï¼‰
  order?: number                // æ’åºæƒé‡ï¼ˆæ•°å€¼è¶Šå°è¶Šé å‰ï¼‰
  when?: () => boolean          // æ˜¾ç¤ºæ¡ä»¶
}
```

**å…³é”®ç‚¹**:
- `component` **å¿…é¡»ç”±æ’ä»¶æä¾›**ï¼Œè´Ÿè´£æ¸²æŸ“é¢æ¿å†…å®¹
- ä½¿ç”¨ `defineAsyncComponent` å®ç°æ‡’åŠ è½½

### 3. æ’ä»¶ (Plugin)

æ’ä»¶æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œè´Ÿè´£æ³¨å†Œå‘½ä»¤æˆ–é¢æ¿ï¼š

```typescript
// å‘½ä»¤æ’ä»¶ç¤ºä¾‹
export function registerMyCommands() {
  commandApi.register({
    id: 'my.command',
    label: 'æˆ‘çš„å‘½ä»¤',
    category: 'custom',
    action: () => { /* ä¸šåŠ¡é€»è¾‘ */ }
  })
}

// é¢æ¿æ’ä»¶ç¤ºä¾‹
export function registerMyPanel() {
  rightSidebarApi.register({
    id: 'my-panel',
    label: 'æˆ‘çš„é¢æ¿',
    component: defineAsyncComponent(() => import('./MyPanel.vue'))
  })
}
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
Nimbria/Client/
â”œâ”€â”€ GUI/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ ProjectPage.Shell/
â”‚   â”‚       â”œâ”€â”€ CommandPalette/
â”‚   â”‚       â”‚   â”œâ”€â”€ CommandPalette.vue          # å‘½ä»¤é¢æ¿ UI
â”‚   â”‚       â”‚   â””â”€â”€ CommandPalette.scss         # å‘½ä»¤é¢æ¿æ ·å¼
â”‚   â”‚       â””â”€â”€ RightSidebar/
â”‚   â”‚           â”œâ”€â”€ RightSidebar.vue            # å³ä¾§æ å®¹å™¨ UI
â”‚   â”‚           â”œâ”€â”€ RightSidebar.scss           # å³ä¾§æ æ ·å¼
â”‚   â”‚           â””â”€â”€ panels/                     # é¢æ¿ç»„ä»¶é›†åˆ
â”‚   â”‚               â””â”€â”€ OutlinePanel.vue        # ç¤ºä¾‹ï¼šå¤§çº²é¢æ¿
â”‚   â”œâ”€â”€ Index/
â”‚   â”‚   â””â”€â”€ ProjectPageSystem.vue               # ğŸ”¥ æ’ä»¶æ³¨å†Œå…¥å£
â”‚   â””â”€â”€ layouts/
â”‚       â””â”€â”€ ProjectMainLayout.vue               # ğŸ”¥ é›†æˆç‚¹ï¼ˆå¿«æ·é”®ç›‘å¬ï¼‰
â”‚
â”œâ”€â”€ Service/
â”‚   â””â”€â”€ CommandPanelRightSidebar/
â”‚       â”œâ”€â”€ command.api.ts                      # å‘½ä»¤ API æœåŠ¡
â”‚       â””â”€â”€ rightSidebar.api.ts                 # å³ä¾§æ  API æœåŠ¡
â”‚
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ projectPage/
â”‚       â”œâ”€â”€ commandPalette/
â”‚       â”‚   â”œâ”€â”€ commandPalette.store.ts         # å‘½ä»¤é¢æ¿ Store
â”‚       â”‚   â””â”€â”€ types.ts                        # å‘½ä»¤ç›¸å…³ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ rightSidebar/
â”‚           â”œâ”€â”€ rightSidebar.store.ts           # å³ä¾§æ  Store
â”‚           â””â”€â”€ types.ts                        # é¢æ¿ç›¸å…³ç±»å‹å®šä¹‰
â”‚
â””â”€â”€ Utils/
    â””â”€â”€ Plugins/
        â”œâ”€â”€ commands/
        â”‚   â”œâ”€â”€ index.ts                        # ğŸ”¥ å‘½ä»¤æ’ä»¶æ³¨å†Œä¸­å¿ƒ
        â”‚   â””â”€â”€ view-commands.plugin.ts         # ç¤ºä¾‹ï¼šè§†å›¾å‘½ä»¤æ’ä»¶
        â””â”€â”€ panels/
            â”œâ”€â”€ index.ts                        # ğŸ”¥ é¢æ¿æ’ä»¶æ³¨å†Œä¸­å¿ƒ
            â””â”€â”€ outline-panel.plugin.ts         # ç¤ºä¾‹ï¼šå¤§çº²é¢æ¿æ’ä»¶
```

**å…³é”®æ–‡ä»¶è¯´æ˜**:

| æ–‡ä»¶ | èŒè´£ | ä¿®æ”¹é¢‘ç‡ |
|------|------|----------|
| `ProjectPageSystem.vue` | åº”ç”¨å¯åŠ¨æ—¶ç»Ÿä¸€è°ƒç”¨æ‰€æœ‰æ’ä»¶æ³¨å†Œ | å‡ ä¹ä¸æ”¹ |
| `ProjectMainLayout.vue` | é›†æˆå‘½ä»¤é¢æ¿ã€ç›‘å¬å…¨å±€å¿«æ·é”® | å‡ ä¹ä¸æ”¹ |
| `command.api.ts` / `rightSidebar.api.ts` | å°è£… Store æ“ä½œï¼Œæä¾›ç»Ÿä¸€æ¥å£ | å‡ ä¹ä¸æ”¹ |
| `*.store.ts` | Pinia çŠ¶æ€ç®¡ç† | å‡ ä¹ä¸æ”¹ |
| `Utils/Plugins/commands/index.ts` | ğŸ”¥ **æ·»åŠ æ–°å‘½ä»¤æ’ä»¶æ—¶éœ€ä¿®æ”¹** | ç»å¸¸ |
| `Utils/Plugins/panels/index.ts` | ğŸ”¥ **æ·»åŠ æ–°é¢æ¿æ’ä»¶æ—¶éœ€ä¿®æ”¹** | ç»å¸¸ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åº”ç”¨å¯åŠ¨æµç¨‹

1. **`ProjectPageSystem.vue` æŒ‚è½½æ—¶**:
   ```typescript
   onMounted(() => {
     registerAllPanelPlugins()    // æ³¨å†Œæ‰€æœ‰é¢æ¿
     registerAllCommandPlugins()  // æ³¨å†Œæ‰€æœ‰å‘½ä»¤
   })
   ```

2. **æ’ä»¶æ³¨å†Œä¸­å¿ƒè°ƒç”¨å„ä¸ªæ’ä»¶**:
   ```typescript
   // Utils/Plugins/commands/index.ts
   export function registerAllCommandPlugins() {
     registerViewCommands()
     // ... å…¶ä»–å‘½ä»¤æ’ä»¶
   }
   ```

3. **æ¯ä¸ªæ’ä»¶é€šè¿‡ API æ³¨å†Œ**:
   ```typescript
   export function registerViewCommands() {
     commandApi.register({ /* ... */ })
   }
   ```

### ç”¨æˆ·äº¤äº’æµç¨‹

1. **æ‰“å¼€å‘½ä»¤é¢æ¿**: `Ctrl+Shift+P` â†’ `ProjectMainLayout` ç›‘å¬é”®ç›˜äº‹ä»¶ â†’ `commandApi.toggle()`
2. **æœç´¢å‘½ä»¤**: è¾“å…¥å…³é”®è¯ â†’ UI è¿‡æ»¤ `availableCommands`
3. **æ‰§è¡Œå‘½ä»¤**: ç‚¹å‡»æˆ–å›è½¦ â†’ `commandApi.execute(commandId)` â†’ è°ƒç”¨æ’ä»¶æ³¨å†Œçš„ `action()`
4. **åˆ‡æ¢é¢æ¿**: ç‚¹å‡»æ ‡ç­¾ â†’ `rightSidebarApi.switchTo(panelId)` â†’ æ¸²æŸ“å¯¹åº” `component`

---

## â• æ·»åŠ æ–°å‘½ä»¤

### æ­¥éª¤ 1: åˆ›å»ºå‘½ä»¤æ’ä»¶æ–‡ä»¶

åœ¨ `Client/Utils/Plugins/commands/` ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼Œä¾‹å¦‚ `file-commands.plugin.ts`:

```typescript
/**
 * æ–‡ä»¶æ“ä½œå‘½ä»¤æ’ä»¶
 */

import { commandApi } from '@service/CommandPanelRightSidebar/command.api'
import type { Command } from '@stores/projectPage/commandPalette/types'

const createFileCommands = (): Command[] => {
  return [
    {
      id: 'file.newMarkdown',
      label: 'æ–°å»º Markdown æ–‡ä»¶',
      category: 'file',
      keywords: ['new', 'file', 'markdown', 'æ–°å»º', 'æ–‡ä»¶'],
      icon: 'Document',
      shortcut: 'Ctrl+N',
      priority: 100,
      action: async () => {
        // ğŸ”¥ è¿™é‡Œæ˜¯ä½ çš„ä¸šåŠ¡é€»è¾‘
        console.log('Creating new markdown file...')
        // ç¤ºä¾‹ï¼šè°ƒç”¨ Store æˆ– Service
        // await markdownStore.createFile()
      },
      when: () => {
        // å¯é€‰ï¼šåŠ¨æ€æ§åˆ¶å‘½ä»¤æ˜¯å¦æ˜¾ç¤º
        // return markdownStore.hasOpenProject
        return true
      }
    },
    {
      id: 'file.save',
      label: 'ä¿å­˜å½“å‰æ–‡ä»¶',
      category: 'file',
      keywords: ['save', 'ä¿å­˜', 'ctrl+s'],
      icon: 'Document',
      shortcut: 'Ctrl+S',
      priority: 99,
      action: async () => {
        // ä½ çš„ä¿å­˜é€»è¾‘
      }
    }
  ]
}

/**
 * æ³¨å†Œæ–‡ä»¶å‘½ä»¤æ’ä»¶
 */
export function registerFileCommands() {
  commandApi.registerBatch(createFileCommands())
  console.log('[Plugin] File commands registered')
}
```

### æ­¥éª¤ 2: åœ¨æ³¨å†Œä¸­å¿ƒæ·»åŠ æ’ä»¶

ç¼–è¾‘ `Client/Utils/Plugins/commands/index.ts`:

```typescript
import { registerViewCommands } from './view-commands.plugin'
import { registerFileCommands } from './file-commands.plugin'  // ğŸ”¥ å¯¼å…¥

export function registerAllCommandPlugins() {
  registerViewCommands()
  registerFileCommands()  // ğŸ”¥ æ³¨å†Œ
  // ... ç»§ç»­æ·»åŠ å…¶ä»–æ’ä»¶
}
```

### æ­¥éª¤ 3: æµ‹è¯•

1. é‡å¯åº”ç”¨
2. æŒ‰ `Ctrl+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
3. æœç´¢ä½ çš„å‘½ä»¤ï¼ˆä¾‹å¦‚è¾“å…¥ "æ–°å»º"ï¼‰
4. æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

---

## â• æ·»åŠ æ–°é¢æ¿

### æ­¥éª¤ 1: åˆ›å»ºé¢æ¿ç»„ä»¶

åœ¨ `Client/GUI/components/ProjectPage.Shell/RightSidebar/panels/` ä¸‹åˆ›å»ºæ–°ç»„ä»¶ï¼Œä¾‹å¦‚ `SearchPanel.vue`:

```vue
<template>
  <div class="search-panel">
    <h3>æœç´¢ç»“æœ</h3>
    <p>{{ searchQuery }}</p>
    <!-- ğŸ”¥ ä½ çš„é¢æ¿å†…å®¹ -->
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

/**
 * SearchPanel
 * æœç´¢ç»“æœé¢æ¿
 * æ³¨æ„ï¼šæ ‡é¢˜æ å’Œå…³é—­æŒ‰é’®ç”± RightSidebar ç»Ÿä¸€ç®¡ç†
 */

const searchQuery = ref('')

// ğŸ”¥ ä½ çš„é¢æ¿é€»è¾‘
</script>

<style scoped>
.search-panel {
  padding: 16px;
  height: 100%;
  overflow-y: auto;
}
</style>
```

### æ­¥éª¤ 2: åˆ›å»ºé¢æ¿æ’ä»¶

åœ¨ `Client/Utils/Plugins/panels/` ä¸‹åˆ›å»ºæ’ä»¶æ–‡ä»¶ `search-panel.plugin.ts`:

```typescript
/**
 * æœç´¢é¢æ¿æ’ä»¶
 */

import { rightSidebarApi } from '@service/CommandPanelRightSidebar/rightSidebar.api'
import { defineAsyncComponent } from 'vue'

export function registerSearchPanel() {
  rightSidebarApi.register({
    id: 'search',
    label: 'æœç´¢',
    icon: 'Search',           // Element Plus icon
    closable: true,           // å¯å…³é—­
    order: 2,                 // æ’åºæƒé‡ï¼ˆæ•°å€¼è¶Šå°è¶Šé å‰ï¼‰
    component: defineAsyncComponent(() => 
      import('@components/ProjectPage.Shell/RightSidebar/panels/SearchPanel.vue')
    ),
    when: () => {
      // å¯é€‰ï¼šåŠ¨æ€æ§åˆ¶é¢æ¿æ˜¯å¦æ˜¾ç¤º
      return true
    }
  })
  
  console.log('[Plugin] Search panel registered')
}
```

### æ­¥éª¤ 3: åœ¨æ³¨å†Œä¸­å¿ƒæ·»åŠ æ’ä»¶

ç¼–è¾‘ `Client/Utils/Plugins/panels/index.ts`:

```typescript
import { registerOutlinePanel } from './outline-panel.plugin'
import { registerSearchPanel } from './search-panel.plugin'  // ğŸ”¥ å¯¼å…¥

export function registerAllPanelPlugins() {
  registerOutlinePanel()
  registerSearchPanel()  // ğŸ”¥ æ³¨å†Œ
  // ... ç»§ç»­æ·»åŠ å…¶ä»–æ’ä»¶
}
```

### æ­¥éª¤ 4: (å¯é€‰) æ·»åŠ å¯¹åº”çš„å‘½ä»¤

åœ¨å‘½ä»¤æ’ä»¶ä¸­æ·»åŠ æ‰“å¼€è¯¥é¢æ¿çš„å‘½ä»¤ï¼š

```typescript
{
  id: 'view.showSearch',
  label: 'æ˜¾ç¤ºæœç´¢é¢æ¿',
  category: 'view',
  keywords: ['search', 'æœç´¢'],
  action: () => {
    rightSidebarApi.switchTo('search')
  }
}
```

---

## ğŸ”— è·¨æ¨¡å—çŠ¶æ€è®¿é—®

### æ ¸å¿ƒåŸåˆ™

**Pinia Store æœ¬èº«å°±æ˜¯å…¨å±€çš„**ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼ˆæ’ä»¶ã€ç»„ä»¶ã€å…¶ä»– Storeï¼‰ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼Œ**æ— éœ€é¢å¤–çš„æ³¨å†Œæœºåˆ¶**ã€‚

### åœºæ™¯ 1: å‘½ä»¤æ’ä»¶è®¿é—®å…¶ä»– Store

**ç›´æ¥å¯¼å…¥å³å¯**ï¼š

```typescript
import { commandApi } from '@service/CommandPanelRightSidebar/command.api'
import { useMarkdownStore } from '@stores/projectPage/Markdown'
import type { MarkdownTab } from '@stores/projectPage/Markdown/types'

export function registerMarkdownCommands() {
  commandApi.register({
    id: 'markdown.save',
    label: 'ä¿å­˜å½“å‰æ–‡ä»¶',
    category: 'file',
    action: async () => {
      // ğŸ”¥ ç›´æ¥è·å– Store å®ä¾‹
      const markdownStore = useMarkdownStore()
      
      // è®¿é—®çŠ¶æ€å’Œæ–¹æ³•
      if (markdownStore.hasUnsavedChanges) {
        await markdownStore.saveCurrentFile()
      }
    },
    when: () => {
      // ğŸ”¥ åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®
      const markdownStore = useMarkdownStore()
      return markdownStore.openTabs.length > 0
    }
  })
}
```

### åœºæ™¯ 2: é¢æ¿ç»„ä»¶è®¿é—®å…¶ä»– Store

**åœ¨ Vue ç»„ä»¶ä¸­ç›´æ¥å¯¼å…¥**ï¼š

```vue
<template>
  <div class="outline-panel">
    <h3>{{ activeFile?.fileName || 'æ— æ‰“å¼€æ–‡ä»¶' }}</h3>
    <div v-for="heading in outlineItems" :key="heading.id">
      {{ heading.text }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useMarkdownStore } from '@stores/projectPage/Markdown'

// ğŸ”¥ ç›´æ¥è·å– Store
const markdownStore = useMarkdownStore()

// ğŸ”¥ ä½¿ç”¨ computed å“åº”å¼è®¿é—®çŠ¶æ€
const activeFile = computed(() => markdownStore.activeTab)
const outlineItems = computed(() => {
  const content = activeFile.value?.content || ''
  return extractHeadings(content)
})

function extractHeadings(content: string) {
  // æå–æ ‡é¢˜é€»è¾‘
  return []
}
</script>
```

### åœºæ™¯ 3: å‘½ä»¤æ’ä»¶è°ƒç”¨å¤šä¸ªæ¨¡å—

**å¯¼å…¥å¤šä¸ª Store æˆ– API**ï¼š

```typescript
import { commandApi } from '@service/CommandPanelRightSidebar/command.api'
import { rightSidebarApi } from '@service/CommandPanelRightSidebar/rightSidebar.api'
import { useMarkdownStore } from '@stores/projectPage/Markdown'

export function registerViewCommands() {
  commandApi.register({
    id: 'view.showOutlineIfFileOpen',
    label: 'æ˜¾ç¤ºå¤§çº²ï¼ˆå¦‚æœæœ‰æ‰“å¼€çš„æ–‡ä»¶ï¼‰',
    category: 'view',
    action: () => {
      const markdownStore = useMarkdownStore()
      
      if (markdownStore.openTabs.length === 0) {
        console.warn('æ²¡æœ‰æ‰“å¼€çš„æ–‡ä»¶')
        return
      }
      
      // åˆ‡æ¢åˆ°å¤§çº²é¢æ¿
      rightSidebarApi.switchTo('outline')
    }
  })
}
```

### åœºæ™¯ 4: Store ä¹‹é—´äº’ç›¸è®¿é—®

**ä¸€ä¸ª Store è®¿é—®å¦ä¸€ä¸ª Store**ï¼š

```typescript
import { defineStore } from 'pinia'
import { useMarkdownStore } from './markdown.store'

export const useOutlineStore = defineStore('outline', () => {
  const syncWithMarkdown = () => {
    // ğŸ”¥ ç›´æ¥è·å–å…¶ä»– Store
    const markdownStore = useMarkdownStore()
    
    const activeContent = markdownStore.activeTab?.content || ''
    // å¤„ç†å†…å®¹...
  }
  
  return { syncWithMarkdown }
})
```

### å…³é”®ç‚¹

- âœ… **ç›´æ¥å¯¼å…¥**: Pinia Store å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›´æ¥ `import` ä½¿ç”¨
- âœ… **å¤šçª—å£éš”ç¦»**: Electron çš„è¿›ç¨‹éš”ç¦»ä¿è¯æ¯ä¸ªçª—å£æœ‰ç‹¬ç«‹çš„ Store å®ä¾‹
- âœ… **ç±»å‹å®‰å…¨**: TypeScript å®Œæ•´æ”¯æŒï¼Œè‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€æŸ¥
- âœ… **æ— éœ€æ³¨å†Œ**: ä¸éœ€è¦é¢å¤–çš„æ³¨å†Œè¡¨æˆ–ä¸­é—´å±‚
- âœ… **å“åº”å¼**: åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨ `computed` æˆ– `watch` è‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **åœ¨ `action` å‡½æ•°å†…éƒ¨è°ƒç”¨ `useXxxStore()`**ï¼Œè€Œä¸æ˜¯åœ¨æ¨¡å—é¡¶å±‚ï¼š
   ```typescript
   // âŒ é”™è¯¯ï¼šæ¨¡å—é¡¶å±‚è°ƒç”¨
   const markdownStore = useMarkdownStore()
   export function registerCommands() { /* ... */ }
   
   // âœ… æ­£ç¡®ï¼šåœ¨å‡½æ•°å†…éƒ¨è°ƒç”¨
   export function registerCommands() {
     commandApi.register({
       action: () => {
         const markdownStore = useMarkdownStore()  // âœ…
       }
     })
   }
   ```

2. **ä½¿ç”¨ API è€Œä¸æ˜¯ç›´æ¥è®¿é—® Store**ï¼ˆå½“æœ‰ API å°è£…æ—¶ï¼‰ï¼š
   ```typescript
   // âœ… æ¨èï¼šé€šè¿‡ API
   rightSidebarApi.toggle()
   
   // âŒ ä¸æ¨èï¼šç»•è¿‡ API ç›´æ¥è®¿é—®
   const store = useRightSidebarStore()
   store.toggle()
   ```

---

## ğŸ”§ ä¿®æ”¹ç°æœ‰åŠŸèƒ½

### ä¿®æ”¹å‘½ä»¤

1. **æ‰¾åˆ°å¯¹åº”çš„æ’ä»¶æ–‡ä»¶**: åœ¨ `Client/Utils/Plugins/commands/` ä¸­æœç´¢
2. **ä¿®æ”¹ `action` å‡½æ•°æˆ–å…¶ä»–å­—æ®µ**
3. **é‡å¯åº”ç”¨æµ‹è¯•**

### ä¿®æ”¹é¢æ¿

1. **æ‰¾åˆ°é¢æ¿ç»„ä»¶**: åœ¨ `Client/GUI/components/ProjectPage.Shell/RightSidebar/panels/` ä¸­
2. **ç›´æ¥ä¿®æ”¹ Vue ç»„ä»¶**
3. **çƒ­é‡è½½ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ**

### ä¿®æ”¹ UI å®¹å™¨

**ä¸å»ºè®®**ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼Œé™¤ééœ€è¦æ”¹å˜æ ¸å¿ƒäº¤äº’é€»è¾‘ï¼š
- `CommandPalette.vue` / `CommandPalette.scss`
- `RightSidebar.vue` / `RightSidebar.scss`

### ä¿®æ”¹ API æˆ– Store

**æå°‘éœ€è¦**ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼Œé™¤éæ‰©å±•æ ¸å¿ƒåŠŸèƒ½ï¼š
- `command.api.ts` / `rightSidebar.api.ts`
- `commandPalette.store.ts` / `rightSidebar.store.ts`

---

## ğŸ“œ å¼€å‘è§„èŒƒ

### 1. å‘½åè§„èŒƒ

| ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| å‘½ä»¤ ID | `category.action` | `file.save`, `view.toggleSidebar` |
| é¢æ¿ ID | `kebab-case` | `outline`, `search-results` |
| æ’ä»¶æ–‡ä»¶ | `name-type.plugin.ts` | `view-commands.plugin.ts`, `outline-panel.plugin.ts` |
| é¢æ¿ç»„ä»¶ | `PascalCase.vue` | `OutlinePanel.vue`, `SearchPanel.vue` |

### 2. æ–‡ä»¶ç»„ç»‡

- **ä¸€ä¸ªæ’ä»¶æ–‡ä»¶åªè´Ÿè´£ä¸€ç±»åŠŸèƒ½**ï¼ˆä¾‹å¦‚ï¼šè§†å›¾å‘½ä»¤ã€æ–‡ä»¶å‘½ä»¤ï¼‰
- **é¢æ¿ç»„ä»¶æ”¾åœ¨ `RightSidebar/panels/` ä¸‹**
- **æ’ä»¶æ–‡ä»¶æ”¾åœ¨ `Utils/Plugins/commands/` æˆ– `Utils/Plugins/panels/` ä¸‹**

### 3. æ’ä»¶ç¼–å†™è§„èŒƒ

```typescript
/**
 * æ’ä»¶æè¿°
 * èŒè´£ï¼š...
 */

import { commandApi } from '@service/CommandPanelRightSidebar/command.api'
import type { Command } from '@stores/projectPage/commandPalette/types'

// ğŸ”¥ ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›å»ºå‘½ä»¤æ•°ç»„
const createMyCommands = (): Command[] => {
  return [
    // ...
  ]
}

/**
 * æ³¨å†Œæ’ä»¶ï¼ˆå¯¼å‡ºå‡½æ•°ï¼‰
 */
export function registerMyCommands() {
  commandApi.registerBatch(createMyCommands())
  console.log('[Plugin] My commands registered')
}
```

### 4. ç±»å‹å®‰å…¨

- **æ‰€æœ‰å‘½ä»¤å’Œé¢æ¿å®šä¹‰ä½¿ç”¨ TypeScript**
- **ä½¿ç”¨ `import type` å¯¼å…¥ç±»å‹**
- **é¢æ¿ç»„ä»¶ä½¿ç”¨ `<script setup lang="ts">`**

### 5. æ³¨é‡Šè§„èŒƒ

```typescript
/**
 * å‡½æ•°/ç±»/æ¥å£çš„æè¿°
 * @param param å‚æ•°è¯´æ˜
 * @returns è¿”å›å€¼è¯´æ˜
 */
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å‘½ä»¤é¢æ¿æ‰“ä¸å¼€ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. `ProjectMainLayout.vue` æ˜¯å¦æ­£ç¡®ç›‘å¬äº† `Ctrl+Shift+P`
2. `CommandPalette.vue` æ˜¯å¦æ­£ç¡®é›†æˆåˆ°å¸ƒå±€ä¸­
3. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### Q2: å‘½ä»¤æ³¨å†Œäº†ä½†ä¸æ˜¾ç¤ºï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. `when()` å‡½æ•°æ˜¯å¦è¿”å› `false`
2. æ’ä»¶æ˜¯å¦åœ¨ `registerAllCommandPlugins()` ä¸­è°ƒç”¨
3. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ `[Plugin] XXX registered` æ—¥å¿—

### Q3: é¢æ¿å…³é—­åå¦‚ä½•é‡æ–°æ‰“å¼€ï¼Ÿ

**A**: ä¸¤ç§æ–¹å¼ï¼š
1. é€šè¿‡å‘½ä»¤é¢æ¿æ‰§è¡Œå¯¹åº”çš„ `view.showXXX` å‘½ä»¤
2. è°ƒç”¨ `rightSidebarApi.switchTo('panel-id')`

### Q4: å¦‚ä½•è°ƒè¯•æ’ä»¶ï¼Ÿ

**A**: 
```typescript
export function registerMyCommands() {
  console.log('[Plugin] Registering my commands...')
  const commands = createMyCommands()
  console.log('Commands:', commands)  // ğŸ”¥ æ‰“å°å‘½ä»¤åˆ—è¡¨
  commandApi.registerBatch(commands)
  console.log('[Plugin] My commands registered')
}
```

### Q5: é¢æ¿ç»„ä»¶å¦‚ä½•è®¿é—® Pinia Store?

**A**: 
```vue
<script setup lang="ts">
import { useMarkdownStore } from '@stores/projectPage/Markdown'

const markdownStore = useMarkdownStore()
</script>
```

### Q6: å‘½ä»¤æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: å‘½ä»¤çš„ `action` å‡½æ•°åº”è¯¥å¤„ç†é”™è¯¯ï¼š
```typescript
action: async () => {
  try {
    await doSomething()
  } catch (error) {
    console.error('Command failed:', error)
    // å¯é€‰ï¼šæ˜¾ç¤ºé”™è¯¯æç¤º
  }
}
```

### Q7: å¦‚ä½•å®ç°å‘½ä»¤çš„å¿«æ·é”®ï¼Ÿ

**A**: 
- `shortcut` å­—æ®µ**ä»…ç”¨äºå±•ç¤º**ï¼Œä¸ä¼šè‡ªåŠ¨ç»‘å®šå¿«æ·é”®
- éœ€è¦åœ¨ `ProjectMainLayout.vue` æˆ–å…¶ä»–åœ°æ–¹æ‰‹åŠ¨ç›‘å¬é”®ç›˜äº‹ä»¶å¹¶è°ƒç”¨ `commandApi.execute()`

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä¿æŒæ’ä»¶çº¯å‡€

```typescript
// âœ… å¥½çš„åšæ³•ï¼šæ’ä»¶åªè´Ÿè´£æ³¨å†Œ
export function registerFileCommands() {
  commandApi.registerBatch(createFileCommands())
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šæ’ä»¶åŒ…å«ä¸šåŠ¡é€»è¾‘
export function registerFileCommands() {
  // ä¸è¦åœ¨è¿™é‡Œåˆå§‹åŒ–å…¶ä»–ä¸œè¥¿
  const fileManager = new FileManager()
  // ...
}
```

### 2. ä½¿ç”¨ `when()` å®ç°æ™ºèƒ½æ˜¾ç¤º

```typescript
{
  id: 'file.save',
  label: 'ä¿å­˜æ–‡ä»¶',
  category: 'file',
  action: () => { /* ... */ },
  when: () => {
    // åªåœ¨æœ‰æ‰“å¼€çš„æ–‡ä»¶æ—¶æ˜¾ç¤º
    const activeTab = stateRegistry.get('markdown:activeTab')
    return activeTab !== null
  }
}
```

### 3. é¢æ¿ç»„ä»¶åº”è¯¥è‡ªç»™è‡ªè¶³

```vue
<script setup lang="ts">
/**
 * OutlinePanel
 * èŒè´£ï¼šæ˜¾ç¤ºå½“å‰æ–‡æ¡£çš„å¤§çº²
 * ä¾èµ–ï¼šmarkdown store (é€šè¿‡ stateRegistry è®¿é—®)
 * æ³¨æ„ï¼šä¸è¦ä¾èµ–çˆ¶ç»„ä»¶ä¼ é€’çš„ props
 */

import { ref, watch } from 'vue'
import { stateRegistry } from '@service/StateRegistry'

// ğŸ”¥ ç›´æ¥è®¿é—®éœ€è¦çš„çŠ¶æ€
const activeTab = ref(stateRegistry.get('markdown:activeTab'))

watch(() => stateRegistry.get('markdown:activeTab'), (newTab) => {
  activeTab.value = newTab
  // æ›´æ–°å¤§çº²
})
</script>
```

### 4. ç»Ÿä¸€é”™è¯¯å¤„ç†

```typescript
const createSafeCommand = (command: Omit<Command, 'action'> & { 
  action: () => void | Promise<void> 
}): Command => {
  return {
    ...command,
    action: async () => {
      try {
        await command.action()
      } catch (error) {
        console.error(`Command "${command.id}" failed:`, error)
        // å¯é€‰ï¼šæ˜¾ç¤ºå…¨å±€é”™è¯¯æç¤º
      }
    }
  }
}

// ä½¿ç”¨
const createFileCommands = (): Command[] => {
  return [
    createSafeCommand({
      id: 'file.save',
      label: 'ä¿å­˜',
      category: 'file',
      action: async () => {
        // è¿™é‡Œçš„é”™è¯¯ä¼šè¢«è‡ªåŠ¨æ•è·
        await markdownStore.saveFile()
      }
    })
  ]
}
```

### 5. é¢æ¿ç»„ä»¶æ€§èƒ½ä¼˜åŒ–

```vue
<script setup lang="ts">
import { computed, defineAsyncComponent } from 'vue'

// ğŸ”¥ ä½¿ç”¨ computed ç¼“å­˜
const outlineItems = computed(() => {
  const content = stateRegistry.get<string>('markdown:content')
  return extractHeadings(content)  // åªåœ¨å†…å®¹å˜åŒ–æ—¶é‡æ–°è®¡ç®—
})

// ğŸ”¥ å¤§å‹å­ç»„ä»¶ä½¿ç”¨å¼‚æ­¥åŠ è½½
const HeavyComponent = defineAsyncComponent(() => 
  import('./HeavyComponent.vue')
)
</script>
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å‘½ä»¤é¢æ¿ä¸å³æ é‡æ„ Design](../../Design/å‘½ä»¤é¢æ¿ä¸å³æ é‡æ„/Design.md)
- [æ¶æ„è®¾è®¡æ€»è§ˆ](../../æ¶æ„è®¾è®¡/æ¶æ„è®¾è®¡æ€»è§ˆ.md)
- [å¼€å‘é€šç”¨å·¥ä½œæµ](./å¼€å‘é€šç”¨å·¥ä½œæµ.md)

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | å†…å®¹ |
|------|------|------|
| v1.0 | 2025-10-08 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„å¼€å‘æŒ‡å— |

---

**å¦‚æœ‰ç–‘é—®ï¼Œè¯·æŸ¥é˜…ä»£ç æ³¨é‡Šæˆ–è”ç³»æ¶æ„è´Ÿè´£äººã€‚**

