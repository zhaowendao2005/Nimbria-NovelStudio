# Nimbria LLMé…ç½®ç³»ç»Ÿæ‰©å±•ä¸ä¼˜åŒ–å®ç°æ€»ç»“

**å®ç°æ—¶é—´**: 2025å¹´10æœˆ12æ—¥12:00  
**é˜¶æ®µ**: Phase 2 æ‰©å±• - å‘å¯¼æ¨¡å¼ã€æ¨¡å‹é…ç½®ä¸çŠ¶æ€ä¼˜åŒ–  
**åŸºäº**: 2025å¹´10æœˆ11æ—¥åŸºç¡€å®ç°

---

## ä¸€ã€å®ç°æ¦‚è¿°

æœ¬æ¬¡è¿­ä»£åœ¨å·²æœ‰LLMé…ç½®ç³»ç»ŸåŸºç¡€ä¸Šï¼Œå®Œæˆäº†ä¸‰ä¸ªé‡è¦æ‰©å±•ï¼š

1. **å‘å¯¼å¼æä¾›å•†æ·»åŠ æµç¨‹** - å¤šæ­¥éª¤å¼•å¯¼ç”¨æˆ·æ·»åŠ LLMæä¾›å•†
2. **æ¨¡å‹çº§é…ç½®ç³»ç»Ÿ** - æ”¯æŒå•ä¸ªæ¨¡å‹çš„ç‹¬ç«‹é«˜çº§é…ç½®
3. **é…ç½®çŠ¶æ€å¯è§†åŒ–ä¼˜åŒ–** - ä¸‰æ€æ˜¾ç¤ºç³»ç»Ÿï¼ˆç»§æ‰¿/è‡ªå®šä¹‰/å¾…ä¿å­˜ï¼‰

è¿™äº›æ‰©å±•å¤§å¹…æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯é…ç½®ç»§æ‰¿å…³ç³»çš„å¯è§†åŒ–å’Œå³æ—¶åé¦ˆæœºåˆ¶ã€‚

---

## äºŒã€æ–°å¢åŠŸèƒ½æ¸…å•

### 2.1 å‘å¯¼å¼æ·»åŠ æä¾›å•†ï¼ˆPhase 2.1ï¼‰

#### åŠŸèƒ½æè¿°
å°†åŸæœ¬ç®€å•çš„"ç›´æ¥æ·»åŠ "è¡¨å•å‡çº§ä¸ºå¤šæ­¥éª¤å‘å¯¼æµç¨‹ï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆæä¾›å•†çš„å®Œæ•´é…ç½®ã€‚

#### å®ç°çš„æ­¥éª¤æµç¨‹

```
Step 1: åŸºç¡€ä¿¡æ¯
  â”œâ”€ è¾“å…¥ï¼šnameï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
  â”œâ”€ è¾“å…¥ï¼šdisplayNameï¼ˆæ˜¾ç¤ºåç§°ï¼‰
  â”œâ”€ è¾“å…¥ï¼šapiKeyï¼ˆAPIå¯†é’¥ï¼‰
  â””â”€ è¾“å…¥ï¼šbaseUrlï¼ˆAPIåœ°å€ï¼‰
       â†“
Step 2: æµ‹è¯•è¿æ¥
  â”œâ”€ ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
  â”œâ”€ æ˜¾ç¤ºloadingçŠ¶æ€ï¼ˆq-spinnerï¼‰
  â”œâ”€ è°ƒç”¨ llmStore.testNewProviderConnection()
  â””â”€ æ˜¾ç¤ºç»“æœï¼š
      â”œâ”€ æˆåŠŸï¼šå±•ç¤ºå‘ç°çš„æ¨¡å‹ç±»å‹å’Œæ•°é‡
      â””â”€ å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
       â†“
Step 3: é€‰æ‹©æ¨¡å‹
  â”œâ”€ æŒ‰ç±»å‹åˆ†ç»„å±•ç¤ºå‘ç°çš„æ¨¡å‹
  â”œâ”€ å¤šé€‰æ¨¡å¼ï¼ˆq-checkboxï¼‰
  â”œâ”€ æ¯ç»„æä¾›"å…¨é€‰"/"æ¸…ç©º"æŒ‰é’®
  â””â”€ æ˜¾ç¤ºå·²é€‰æ¨¡å‹æ€»æ•°
       â†“
Step 4: é«˜çº§é…ç½®
  â”œâ”€ é…ç½®æä¾›å•†çº§é»˜è®¤å‚æ•°ï¼š
  â”‚   â”œâ”€ contextLengthï¼ˆä¸Šä¸‹æ–‡é•¿åº¦ï¼‰
  â”‚   â”œâ”€ maxTokensï¼ˆæœ€å¤§è¾“å‡ºï¼‰
  â”‚   â””â”€ completionModeï¼ˆå®Œæˆæ¨¡å¼ï¼‰
  â””â”€ å¯é€‰"è·³è¿‡å¹¶å®Œæˆ"
       â†“
Step 5: å®Œæˆ
  â””â”€ è°ƒç”¨ llmStore.addProvider() ä¿å­˜
```

#### å…³é”®çŠ¶æ€è®¾è®¡

```typescript
// å‘å¯¼çŠ¶æ€
wizardStep = ref<1 | 2 | 3 | 4>(1)

// æµ‹è¯•è¿æ¥çŠ¶æ€
testStatus = ref<'idle' | 'testing' | 'success' | 'failed'>('idle')

// å‘ç°çš„æ¨¡å‹
discoveredModels = ref<DiscoveredModel[]>([])

// ç”¨æˆ·é€‰æ‹©çš„æ¨¡å‹
selectedModels = ref<Map<ModelType, Set<string>>>(new Map())

// è¡¨å•æ•°æ®
wizardForm = ref({
  name: '',
  displayName: '',
  apiKey: '',
  baseUrl: '',
  defaultConfig: { contextLength: 4096, maxTokens: 4096, ... }
})
```

#### UIç»„ä»¶ï¼ˆQuasarï¼‰

- `q-stepper` - å¤šæ­¥éª¤å®¹å™¨
- `q-step` - æ¯ä¸ªæ­¥éª¤
- `q-stepper-navigation` - å¯¼èˆªæŒ‰é’®åŒº
- `q-spinner-dots` - æµ‹è¯•è¿æ¥åŠ è½½åŠ¨ç”»
- `q-expansion-item` - æ¨¡å‹ç±»å‹åˆ†ç»„
- `q-checkbox` - æ¨¡å‹å¤šé€‰

#### æ–°å¢æ–¹æ³•

**Storeå±‚** (`settings.llm.store.ts`):
```typescript
async testNewProviderConnection(config: {
  baseUrl: string;
  apiKey: string;
}): Promise<ConnectionTestResult>
```

**DataSourceå±‚** (`DataSource.ts`):
```typescript
export async testNewProviderConnection(
  config: { baseUrl: string; apiKey: string }
): Promise<ConnectionTestResult>
```

#### Mockè¿”å›æ•°æ®ç»“æ„

```typescript
interface ConnectionTestResult {
  success: boolean;
  discoveredModels?: DiscoveredModel[];
  modelsCount?: number;
  error?: string;
}

interface DiscoveredModel {
  type: ModelType; // 'LLM' | 'TEXT_EMBEDDING' | ...
  models: Array<{
    name: string;
    isAvailable: boolean;
  }>;
}
```

---

### 2.2 æ¨¡å‹çº§é…ç½®ç³»ç»Ÿï¼ˆPhase 2.2ï¼‰

#### åŠŸèƒ½æè¿°
æ”¯æŒå¯¹å•ä¸ªæ¨¡å‹è¿›è¡Œç‹¬ç«‹çš„é«˜çº§é…ç½®ï¼Œé…ç½®å¯ä»¥è¦†ç›–æä¾›å•†çº§é»˜è®¤å€¼ï¼Œå½¢æˆ"ç»§æ‰¿+è¦†ç›–"çš„é…ç½®ä½“ç³»ã€‚

#### è§¦å‘å…¥å£
1. åœ¨ `ProviderCard` çš„æ¨¡å‹åˆ—è¡¨ä¸­ï¼Œå³é”®ç‚¹å‡»æ¨¡å‹chip
2. å¼¹å‡ºä¸Šä¸‹æ–‡èœå•ï¼Œé€‰æ‹©"é…ç½®æ¨¡å‹"
3. æ‰“å¼€ `ModelConfigModal`

#### é…ç½®ç•Œé¢ï¼ˆModelConfigModalï¼‰

**Tab 1: åŸºç¡€ä¿¡æ¯**
```
- æ¨¡å‹åç§°ï¼ˆåªè¯»ï¼‰
- æä¾›å•†ï¼ˆåªè¯»ï¼‰
- æ¨¡å‹ç±»å‹ï¼ˆåªè¯»ï¼‰
- æ˜¾ç¤ºåç§°ï¼ˆå¯ç¼–è¾‘ï¼‰
```

**Tab 2: é«˜çº§é…ç½®**
```
- [å¤é€‰æ¡†] ä½¿ç”¨æä¾›å•†é»˜è®¤é…ç½®
- contextLengthï¼ˆä¸Šä¸‹æ–‡é•¿åº¦ï¼‰       [å›¾æ ‡] [tooltip]
- maxTokensï¼ˆæœ€å¤§è¾“å‡ºtokenï¼‰        [å›¾æ ‡] [tooltip]
- completionModeï¼ˆå¯¹è¯/è¡¥å…¨ï¼‰       [å›¾æ ‡] [tooltip]
- agentThoughtï¼ˆæ”¯æŒ/ä¸æ”¯æŒï¼‰       [å›¾æ ‡] [tooltip]
- functionCallingï¼ˆæ”¯æŒ/ä¸æ”¯æŒï¼‰    [å›¾æ ‡] [tooltip]
- structuredOutputï¼ˆæ”¯æŒ/ä¸æ”¯æŒï¼‰   [å›¾æ ‡] [tooltip]
- systemPromptSeparatorï¼ˆåˆ†éš”ç¬¦ï¼‰   [å›¾æ ‡] [tooltip]
```

**Tab 3: ç»§æ‰¿è®¾ç½®**
```
è¡¨æ ¼å±•ç¤ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é…ç½®é¡¹   â”‚ çŠ¶æ€   â”‚ æä¾›å•†é»˜è®¤ â”‚ æ¨¡å‹è‡ªå®šä¹‰â”‚ æœ‰æ•ˆå€¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸Šä¸‹æ–‡é•¿åº¦â”‚ ğŸŸ¢ç»§æ‰¿ â”‚ 4096      â”‚ -        â”‚ 4096     â”‚
â”‚ æœ€å¤§è¾“å‡º  â”‚ ğŸ”µè‡ªå®šä¹‰â”‚ 4096      â”‚ 8192     â”‚ 8192     â”‚
â”‚ å®Œæˆæ¨¡å¼  â”‚ ğŸŸ å¾…ä¿å­˜â”‚ å¯¹è¯      â”‚ è¡¥å…¨     â”‚ è¡¥å…¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é…ç½®ç»§æ‰¿é€»è¾‘

```typescript
// è·å–æœ‰æ•ˆé…ç½®ï¼ˆåˆå¹¶æä¾›å•†é»˜è®¤ + æ¨¡å‹è‡ªå®šä¹‰ï¼‰
function getEffectiveModelConfig(
  providerId: string,
  modelType: string,
  modelName: string
): ModelConfig {
  const provider = providers.find(p => p.id === providerId)
  const modelGroup = provider.supportedModels.find(g => g.type === modelType)
  const model = modelGroup.models.find(m => m.name === modelName)
  
  // æä¾›å•†é»˜è®¤ + æ¨¡å‹è¦†ç›–
  return {
    ...provider.defaultConfig,
    ...(model.config || {})
  }
}
```

#### æ•°æ®ç»“æ„

**ModelDetail** æ‰©å±•:
```typescript
interface ModelDetail {
  name: string;
  displayName?: string; // ğŸ†• è‡ªå®šä¹‰æ˜¾ç¤ºåç§°
  config?: Partial<ModelConfig>; // ğŸ†• æ¨¡å‹çº§é…ç½®ï¼ˆè¦†ç›–æä¾›å•†é»˜è®¤ï¼‰
}
```

**ModelConfig** å®Œæ•´å­—æ®µ:
```typescript
interface ModelConfig {
  timeout: number;              // è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  maxRetries: number;           // æœ€å¤§é‡è¯•æ¬¡æ•°
  contextLength: number;        // ä¸Šä¸‹æ–‡é•¿åº¦
  maxTokens: number;            // æœ€å¤§è¾“å‡ºtoken
  completionMode: 'å¯¹è¯' | 'è¡¥å…¨';
  agentThought: 'æ”¯æŒ' | 'ä¸æ”¯æŒ';
  functionCalling: 'æ”¯æŒ' | 'ä¸æ”¯æŒ';
  structuredOutput: 'æ”¯æŒ' | 'ä¸æ”¯æŒ';
  systemPromptSeparator: string; // ç³»ç»Ÿæç¤ºåˆ†éš”ç¬¦
}
```

#### æ–°å¢Storeæ–¹æ³•

```typescript
// æ›´æ–°æ¨¡å‹é…ç½®
async updateModelConfig(
  providerId: string,
  modelType: string,
  modelName: string,
  config: Partial<ModelConfig>
): Promise<boolean>

// è·å–æœ‰æ•ˆé…ç½®
getEffectiveModelConfig(
  providerId: string,
  modelType: string,
  modelName: string
): ModelConfig

// è®¾ç½®æ¨¡å‹æ˜¾ç¤ºåç§°
async setModelDisplayName(
  providerId: string,
  modelName: string,
  displayName: string
): Promise<boolean>
```

---

### 2.3 é…ç½®çŠ¶æ€ä¸‰æ€å¯è§†åŒ–ï¼ˆPhase 2.3ï¼‰

#### é—®é¢˜èƒŒæ™¯
åœ¨Phase 2.2å®ç°åï¼Œç”¨æˆ·åé¦ˆï¼š
1. **ä¸çŸ¥é“å“ªäº›é…ç½®è¢«ä¿®æ”¹äº†**ï¼šæ‰€æœ‰å­—æ®µçœ‹èµ·æ¥éƒ½ä¸€æ ·
2. **ä¿®æ”¹åå¿˜è®°ä¿å­˜**ï¼šæ²¡æœ‰æ˜ç¡®çš„"æœªä¿å­˜"æç¤º
3. **åˆ†ä¸æ¸…ç»§æ‰¿å’Œè‡ªå®šä¹‰**ï¼šå³ä½¿å€¼ç›¸åŒï¼Œä¹Ÿæ˜¾ç¤º"è‡ªå®šä¹‰"

#### è§£å†³æ–¹æ¡ˆï¼šä¸‰æ€æ˜¾ç¤ºç³»ç»Ÿ

**ä¸‰ç§çŠ¶æ€å®šä¹‰**ï¼š

| çŠ¶æ€ | å«ä¹‰ | å›¾æ ‡ | é¢œè‰² | Tooltip |
|------|------|------|------|---------|
| **inherited** | ç»§æ‰¿è‡ªæä¾›å•†ï¼ˆæœªä¿®æ”¹ï¼‰ | `settings` âš™ï¸ | `positive` ğŸŸ¢ | "ç»§æ‰¿è‡ªæä¾›å•†ï¼ˆæœªä¿®æ”¹ï¼‰" |
| **customized** | æ¨¡å‹è‡ªå®šä¹‰é…ç½®ï¼ˆå·²ä¿å­˜ï¼‰ | `save` ğŸ’¾ | `primary` ğŸ”µ | "æ¨¡å‹è‡ªå®šä¹‰é…ç½®ï¼ˆå·²ä¿å­˜ï¼‰" |
| **modified** | å·²ä¿®æ”¹ï¼Œå¾…ä¿å­˜ | `edit_note` ğŸ“ | `warning` ğŸŸ  | "å·²ä¿®æ”¹ï¼Œä¿å­˜åç”Ÿæ•ˆ" |

#### å®ç°åŸç†

```typescript
// 1. ä¿å­˜åŸå§‹é…ç½®å¿«ç…§
const originalConfig = ref<FormData | null>(null)

// 2. åŠ è½½æ—¶ä¿å­˜å¿«ç…§
function loadModelConfig() {
  form.value = { /* åŠ è½½çš„é…ç½® */ }
  originalConfig.value = { ...form.value } // æ·±æ‹·è´
}

// 3. åˆ¤æ–­å­—æ®µæ˜¯å¦ä¿®æ”¹
function isFieldModified(field: string): boolean {
  return form.value[field] !== originalConfig.value[field]
}

// 4. åˆ¤æ–­å­—æ®µçŠ¶æ€
function getFieldState(field: string): 'inherited' | 'customized' | 'modified' {
  // ä¼˜å…ˆçº§1: æ£€æŸ¥æ˜¯å¦ä¿®æ”¹
  if (isFieldModified(field)) return 'modified'
  
  // ä¼˜å…ˆçº§2: æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„è‡ªå®šä¹‰ä¸”å€¼ä¸é»˜è®¤å€¼ä¸åŒ
  const modelConfig = model.config || {}
  const providerConfig = provider.defaultConfig
  
  if (!(field in modelConfig)) return 'inherited'
  
  const modelValue = modelConfig[field]
  const providerValue = providerConfig[field]
  
  // ğŸ”‘å…³é”®ï¼šåªæœ‰å€¼çœŸçš„ä¸åŒæ‰ç®—"è‡ªå®šä¹‰"
  return modelValue === providerValue ? 'inherited' : 'customized'
}
```

#### å…³é”®ä¿®å¤ç‚¹

**é—®é¢˜**: åªè¦ä¿®æ”¹ä¸€ä¸ªå­—æ®µä¿å­˜åï¼Œæ‰€æœ‰å­—æ®µéƒ½æ˜¾ç¤º"è‡ªå®šä¹‰"ã€‚

**åŸå› **: ä¿å­˜æ—¶æ•´ä¸ª `config` å¯¹è±¡è¢«ä¿å­˜äº†ï¼ŒåŒ…æ‹¬é‚£äº›å€¼ä¸é»˜è®¤å€¼ç›¸åŒçš„å­—æ®µã€‚

**è§£å†³**: æ¯”è¾ƒå€¼æ˜¯å¦çœŸçš„ä¸åŒï¼Œè€Œä¸ä»…ä»…æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨äº `model.config` ä¸­ã€‚

```typescript
// âŒ é”™è¯¯é€»è¾‘
return field in modelConfig ? 'customized' : 'inherited'

// âœ… æ­£ç¡®é€»è¾‘
if (!(field in modelConfig)) return 'inherited'
return modelConfig[field] === providerConfig[field] 
  ? 'inherited' 
  : 'customized'
```

#### UIæ•ˆæœ

**è¾“å…¥æ¡†åçš„çŠ¶æ€å›¾æ ‡**:
```vue
<q-input v-model="form.contextLength">
  <template v-slot:append>
    <q-icon 
      :name="getInheritIcon('contextLength')"
      :color="getInheritColor('contextLength')"
    >
      <q-tooltip>{{ getInheritTooltip('contextLength') }}</q-tooltip>
    </q-icon>
  </template>
</q-input>
```

**ç»§æ‰¿è®¾ç½®Tabçš„çŠ¶æ€åˆ—**:
```vue
<q-badge
  :color="getInheritColor(row.fieldKey)"
  :icon="getInheritIcon(row.fieldKey)"
>
  <template v-if="getFieldState(row.fieldKey) === 'modified'">
    å¾…ä¿å­˜
  </template>
  <template v-else-if="getFieldState(row.fieldKey) === 'customized'">
    è‡ªå®šä¹‰
  </template>
  <template v-else>
    ç»§æ‰¿
  </template>
</q-badge>
```

#### ä¿å­˜åçŠ¶æ€æ›´æ–°

```typescript
async function handleSubmit() {
  // ... ä¿å­˜é€»è¾‘
  
  // ğŸ†• ä¿å­˜æˆåŠŸåï¼Œæ›´æ–°åŸå§‹é…ç½®å¿«ç…§
  originalConfig.value = { ...form.value }
  
  // è¿™æ ·æ‰€æœ‰"å¾…ä¿å­˜"çŠ¶æ€ä¼šè‡ªåŠ¨å˜ä¸º"ç»§æ‰¿"æˆ–"è‡ªå®šä¹‰"
}
```

---

## ä¸‰ã€æ–‡ä»¶å˜æ›´æ¸…å•

### 3.1 æ–°å¢æ–‡ä»¶

æ— ï¼ˆæœ¬æ¬¡ä¸ºæ‰©å±•å·²æœ‰æ–‡ä»¶ï¼‰

### 3.2 ä¿®æ”¹æ–‡ä»¶

#### Storeå±‚

**`Nimbria/Client/stores/settings/types.ts`** (+35è¡Œ)
- æ–°å¢ `ConnectionTestResult` æ¥å£
- æ–°å¢ `DiscoveredModel` æ¥å£
- æ‰©å±• `ModelConfig` æ¥å£ï¼ˆæ–°å¢5ä¸ªå­—æ®µï¼‰
- ä¿®æ”¹ `parseModelId` / `createModelId` åˆ†éš”ç¬¦ï¼ˆ`.` â†’ `::`ï¼‰

**`Nimbria/Client/stores/settings/settings.llm.store.ts`** (+120è¡Œ)
- æ–°å¢ `testNewProviderConnection()` æ–¹æ³•
- æ–°å¢ `updateModelConfig()` æ–¹æ³•ï¼ˆä¸‰å‚æ•°ç‰ˆæœ¬ï¼‰
- æ–°å¢ `getEffectiveModelConfig()` æ–¹æ³•
- æ–°å¢ `setModelDisplayName()` æ–¹æ³•

**`Nimbria/Client/stores/settings/DataSource.ts`** (+80è¡Œ)
- æ–°å¢ `testNewProviderConnection()` mockå®ç°
- æ–°å¢ `updateModelConfig()` mockå®ç°ï¼ˆä¸‰å‚æ•°ç‰ˆæœ¬ï¼‰
- æ–°å¢ `setModelDisplayName()` mockå®ç°

#### GUIå±‚

**`Settings.LlmConfig.AddProviderModal.vue`** (+420è¡Œ)
- æ–°å¢"å‘å¯¼æ·»åŠ "Tab
- æ–°å¢5æ­¥å‘å¯¼æµç¨‹ï¼ˆq-stepperï¼‰
- æ–°å¢æµ‹è¯•è¿æ¥UIï¼ˆloading/success/failedçŠ¶æ€ï¼‰
- æ–°å¢æ¨¡å‹é€‰æ‹©UIï¼ˆåˆ†ç»„ã€å¤šé€‰ã€å…¨é€‰/æ¸…ç©ºï¼‰
- æ–°å¢é«˜çº§é…ç½®UI
- æ–°å¢å‘å¯¼çŠ¶æ€ç®¡ç†ï¼ˆwizardStepã€testStatusç­‰ï¼‰
- æ–°å¢å‘å¯¼æ–¹æ³•ï¼ˆhandleTestConnectionã€handleWizardCompleteç­‰ï¼‰

**`Settings.LlmConfig.ModelConfigModal.vue`** (+150è¡Œ, ä¿®æ”¹~60è¡Œ)
- æ‰©å±•ä¸ºä¸‰Tabå¸ƒå±€ï¼ˆåŸºç¡€ä¿¡æ¯/é«˜çº§é…ç½®/ç»§æ‰¿è®¾ç½®ï¼‰
- æ–°å¢é«˜çº§é…ç½®Tabï¼ˆ8ä¸ªé…ç½®é¡¹ï¼‰
- æ–°å¢ç»§æ‰¿è®¾ç½®Tabï¼ˆé…ç½®ç»§æ‰¿è¡¨æ ¼ï¼‰
- æ–°å¢ä¸‰æ€æ˜¾ç¤ºé€»è¾‘ï¼š
  - `originalConfig` refï¼ˆä¿å­˜åŸå§‹é…ç½®ï¼‰
  - `isFieldModified()` æ–¹æ³•
  - `getFieldState()` æ–¹æ³•ï¼ˆè¿”å›ä¸‰æ€ï¼‰
  - `getInheritIcon/Color/Tooltip()` æ–¹æ³•ï¼ˆåŸºäºä¸‰æ€ï¼‰
- ä¿®æ”¹ `loadModelConfig()` ä¿å­˜åŸå§‹å¿«ç…§
- ä¿®æ”¹ `handleSubmit()` æ›´æ–°åŸå§‹å¿«ç…§

**`Settings.LlmConfig.ConfigModal.vue`** (+80è¡Œ)
- æ‰©å±•ä¸ºä¸‰Tabå¸ƒå±€ï¼ˆåŸºç¡€é…ç½®/é«˜çº§é…ç½®/é»˜è®¤æ¨¡å‹é…ç½®ï¼‰
- æ–°å¢é«˜çº§é…ç½®Tabï¼ˆä¸ModelConfigModalç±»ä¼¼ï¼‰
- æ›´æ–° `form` åŒ…å«æ‰€æœ‰ `ModelConfig` å­—æ®µ
- æ›´æ–° `loadProviderConfig` / `handleSubmit`

**`Settings.LlmConfig.vue`** (+30è¡Œ)
- é›†æˆ `SettingsLlmConfigModelConfigModal`
- æ·»åŠ  `showModelConfigModal` / `currentModelName` ref
- æ›´æ–° `handleModelConfig` æ–¹æ³•
- æ·»åŠ  `handleModelConfigUpdated` å›è°ƒ

**`Settings/index.ts`** (+1è¡Œ)
- å¯¼å‡º `SettingsLlmConfigModelConfigModal`

---

## å››ã€API/æ¥å£/æ–¹æ³•æ±‡æ€»

### 4.1 Storeå±‚å…¬å¼€API

#### LLM Store (`settings.llm.store.ts`)

**æä¾›å•†ç®¡ç†**:
```typescript
addProvider(provider: ModelProvider): Promise<boolean>
removeProvider(providerId: string): Promise<boolean>
updateProvider(providerId: string, updates: Partial<ModelProvider>): Promise<boolean>
testNewProviderConnection(config: { baseUrl: string; apiKey: string }): Promise<ConnectionTestResult>
```

**æ¨¡å‹ç®¡ç†**:
```typescript
addModelToProvider(providerId: string, modelType: string, modelName: string): Promise<boolean>
removeModelFromProvider(providerId: string, modelName: string): Promise<boolean>
setModelDisplayName(providerId: string, modelName: string, displayName: string): Promise<boolean>
```

**æ´»åŠ¨æ¨¡å‹ç®¡ç†**:
```typescript
toggleModelSelection(providerId: string, modelType: string, modelName: string): void
setPreferredModel(providerId: string, modelType: string, modelName: string): void
isModelSelected(providerId: string, modelType: string, modelName: string): boolean
isPreferredModel(providerId: string, modelType: string, modelName: string): boolean
```

**é…ç½®ç®¡ç†**:
```typescript
updateProviderConfig(providerId: string, config: Partial<ModelConfig>): Promise<boolean>
updateModelConfig(providerId: string, modelType: string, modelName: string, config: Partial<ModelConfig>): Promise<boolean>
getEffectiveModelConfig(providerId: string, modelType: string, modelName: string): ModelConfig
```

**æŸ¥è¯¢**:
```typescript
getPreferredModelInfo(modelType: string): { provider: ModelProvider; modelName: string } | null
```

**å¯¼å…¥å¯¼å‡º**:
```typescript
exportConfig(): Promise<void>
importConfig(file: File): Promise<boolean>
```

### 4.2 DataSourceå±‚æ¥å£

æ‰€æœ‰Storeå±‚æ–¹æ³•åœ¨DataSourceä¸­éƒ½æœ‰å¯¹åº”çš„å®ç°ï¼ˆå½“å‰ä¸ºMockï¼Œé¢„ç•™çœŸå®åç«¯å¯¹æ¥ï¼‰ã€‚

**ç‰¹åˆ«æ³¨æ„**ï¼š
```typescript
// Mockå®ç°ä¼šè‡ªåŠ¨å»¶è¿Ÿ2ç§’æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
async function simulateDelay(ms: number = 2000): Promise<void> {
  await new Promise(resolve => setTimeout(resolve, ms))
}
```

### 4.3 IPCé€šé“ï¼ˆé¢„ç•™ï¼‰

å½“å‰ä½¿ç”¨Mockæ•°æ®ï¼Œæœªæ¥éœ€å¯¹æ¥IPCé€šé“ï¼š
```typescript
// é¢„æœŸIPCé€šé“
'llm:provider:add'
'llm:provider:update'
'llm:provider:remove'
'llm:provider:test-connection'
'llm:model:add'
'llm:model:remove'
'llm:model:update-config'
'llm:config:export'
'llm:config:import'
```

---

## äº”ã€é¡¹ç›®ä¹ æƒ¯ä¸è§„èŒƒ

### 5.1 æ–‡ä»¶ç»„ç»‡è§„èŒƒ

#### Storeæ–‡ä»¶å‘½å
```
settings.{domain}.store.ts  // åŠŸèƒ½åŸŸstore
settings.{domain}.mock.ts   // å¯¹åº”çš„mockæ•°æ®
```

ç¤ºä¾‹ï¼š
- `settings.llm.store.ts` / `llm.mock.ts`
- `settings.cache.store.ts` / ï¼ˆæ— mockï¼‰

#### ç»„ä»¶æ–‡ä»¶å‘½å
```
Settings.{Domain}.{Component}.vue
```

ç¤ºä¾‹ï¼š
- `Settings.LlmConfig.vue`ï¼ˆä¸»ç»„ä»¶ï¼‰
- `Settings.LlmConfig.ProviderCard.vue`ï¼ˆå­ç»„ä»¶ï¼‰
- `Settings.LlmConfig.AddProviderModal.vue`ï¼ˆæ¨¡æ€æ¡†ï¼‰

#### ç±»å‹å®šä¹‰ä½ç½®
- **å…¨å±€å…±äº«ç±»å‹**: `Client/Types/`
- **Storeä¸“å±ç±»å‹**: `Client/stores/{domain}/types.ts`
- **ç»„ä»¶ä¸“å±ç±»å‹**: ç»„ä»¶æ–‡ä»¶å†…éƒ¨å®šä¹‰

### 5.2 ä»£ç é£æ ¼è§„èŒƒ

#### Vueç»„ä»¶ç»“æ„é¡ºåº
```vue
<script setup lang="ts">
// 1. å¯¼å…¥
import { ... } from '...'

// 2. Propså®šä¹‰
const props = defineProps<{...}>()

// 3. Emitså®šä¹‰
const emit = defineEmits<{...}>()

// 4. Storeå¼•ç”¨
const xxxStore = useXxxStore()

// 5. RefsçŠ¶æ€
const xxx = ref(...)

// 6. Computedå±æ€§
const xxx = computed(() => ...)

// 7. Watchç›‘å¬
watch(...)

// 8. æ–¹æ³•å®šä¹‰
function handleXxx() {...}

// 9. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {...})
</script>

<template>
  <!-- UIæ¨¡æ¿ -->
</template>

<style lang="scss" scoped>
/* æ ·å¼ */
</style>
```

#### å¼‚æ­¥æ–¹æ³•å‘½å
```typescript
// âœ… æ¨è
async function loadProviders(): Promise<void>
async function handleSubmit(): Promise<void>

// âŒ ä¸æ¨è
function loadProviders(): Promise<void>  // ç¼ºå°‘async
async function submit()  // ç¼ºå°‘handleå‰ç¼€
```

#### æ—¥å¿—è§„èŒƒ
```typescript
// Storeå±‚ä½¿ç”¨emojiæ ‡è®°æ—¥å¿—
console.log('ğŸš€ [LLM Store] åˆå§‹åŒ–å¼€å§‹')
console.log('âœ… [LLM Store] æˆåŠŸåŠ è½½æä¾›å•†:', count)
console.error('âŒ [LLM Store] åŠ è½½å¤±è´¥:', error)
console.log('ğŸ”„ [LLM Store] å¼€å§‹åŠ è½½...')
```

### 5.3 ç±»å‹å®‰å…¨è§„èŒƒ

#### é¿å…anyçš„æ­£ç¡®æ–¹å¼
```typescript
// âŒ é¿å…
const config = (model as any).config

// âœ… ä½¿ç”¨ç±»å‹æ–­è¨€æˆ–ç±»å‹å®ˆå«
interface ModelWithConfig extends ModelDetail {
  config?: Partial<ModelConfig>;
}
const config = (model as ModelWithConfig).config

// æˆ–ä½¿ç”¨å¯é€‰é“¾
const config = model.config ?? {}
```

#### Computedå±æ€§ç±»å‹æ ‡æ³¨
```typescript
// âœ… æ˜ç¡®è¿”å›ç±»å‹
const providers = computed<ModelProvider[]>(() => llmStore.providers)

// âŒ éšå¼ç±»å‹
const providers = computed(() => llmStore.providers)
```

### 5.4 çŠ¶æ€ç®¡ç†è§„èŒƒ

#### StoreçŠ¶æ€è®¾è®¡åŸåˆ™
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªStoreåªç®¡ç†ä¸€ä¸ªåŠŸèƒ½åŸŸ
2. **æ‰å¹³åŒ–çŠ¶æ€**ï¼šé¿å…æ·±å±‚åµŒå¥—å¯¹è±¡
3. **Computedæ´¾ç”Ÿ**ï¼šåªè¯»æ•°æ®ç”¨computedï¼Œä¸é‡å¤å­˜å‚¨
4. **æ–¹æ³•åŒæ­¥æ€§**ï¼š
   - UIäº¤äº’æ–¹æ³•ï¼ˆå¦‚`toggleModelSelection`ï¼‰åŒæ­¥æ‰§è¡Œ
   - æ¶‰åŠæ•°æ®æºçš„æ–¹æ³•ï¼ˆå¦‚`addProvider`ï¼‰å¼‚æ­¥æ‰§è¡Œ

#### ç¤ºä¾‹
```typescript
// âœ… å¥½çš„è®¾è®¡
const providers = ref<ModelProvider[]>([])  // å”¯ä¸€æ•°æ®æº
const activeProviders = computed(() =>       // æ´¾ç”Ÿ
  providers.value.filter(p => p.status === 'active')
)

// âŒ ä¸å¥½çš„è®¾è®¡
const providers = ref<ModelProvider[]>([])
const activeProviders = ref<ModelProvider[]>([])  // é‡å¤æ•°æ®
```

---

## å…­ã€è¸©è¿‡çš„å‘ä¸ç»éªŒæ€»ç»“

### 6.1 æ¨¡å‹IDåˆ†éš”ç¬¦å†²çª

**é—®é¢˜æè¿°**:
```typescript
// é”™è¯¯ä»£ç 
function createModelId(providerId: string, modelName: string): string {
  return `${providerId}.${modelName}`  // âŒ ä½¿ç”¨ç‚¹å·
}

// å¤±è´¥æ¡ˆä¾‹
createModelId('openai', 'gpt-3.5-turbo')  // 'openai.gpt-3.5-turbo'
// é—®é¢˜ï¼šæ¨¡å‹åç§°æœ¬èº«åŒ…å«ç‚¹å·ï¼
```

**é”™è¯¯æ—¥å¿—**:
```
âŒ [LLM Store] è®¾ç½®æ´»åŠ¨æ¨¡å‹å¤±è´¥: 
Error: Provider ID and model name cannot contain dots
```

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ­£ç¡®ä»£ç 
function createModelId(providerId: string, modelName: string): string {
  return `${providerId}::${modelName}`  // âœ… ä½¿ç”¨åŒå†’å·
}

function parseModelId(modelId: string): { providerId: string; modelName: string } {
  const [providerId, modelName] = modelId.split('::')  // âœ…
  return { providerId, modelName }
}
```

**æ•™è®­**:
- é€‰æ‹©åˆ†éš”ç¬¦æ—¶è¦è€ƒè™‘æ•°æ®çš„å®é™…æ ¼å¼
- å¸¸è§çš„å®‰å…¨åˆ†éš”ç¬¦ï¼š`::`, `--`, `___`, `|`, `@`
- é¿å…ä½¿ç”¨ï¼š`.`, `-`, `_`ï¼ˆæ•°æ®ä¸­å¯èƒ½åŒ…å«ï¼‰

---

### 6.2 çŠ¶æ€ä¸‰æ€åˆ¤æ–­é€»è¾‘é”™è¯¯

**é—®é¢˜æè¿°**:
ç”¨æˆ·ä¿®æ”¹å¹¶ä¿å­˜ä¸€ä¸ªé…ç½®é¡¹åï¼Œ**æ‰€æœ‰é…ç½®é¡¹**éƒ½æ˜¾ç¤º"è‡ªå®šä¹‰"çŠ¶æ€ã€‚

**é”™è¯¯ä»£ç **:
```typescript
function getFieldState(field: string): 'inherited' | 'customized' | 'modified' {
  const modelConfig = model.config || {}
  
  // âŒ åªæ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
  return field in modelConfig ? 'customized' : 'inherited'
}

// é—®é¢˜ï¼šä¿å­˜æ—¶æ•´ä¸ªconfigå¯¹è±¡è¢«ä¿å­˜äº†
await updateModelConfig(providerId, modelType, modelName, {
  contextLength: 4096,
  maxTokens: 8192,  // åªæ”¹äº†è¿™ä¸ª
  completionMode: 'å¯¹è¯',
  agentThought: 'æ”¯æŒ',
  // ... æ‰€æœ‰å­—æ®µéƒ½ä¿å­˜äº†
})
```

**ç°è±¡**:
- ç”¨æˆ·åªä¿®æ”¹äº† `maxTokens`
- ä½†æ‰€æœ‰å­—æ®µéƒ½åœ¨ `model.config` ä¸­
- æ‰€ä»¥æ‰€æœ‰å­—æ®µéƒ½æ˜¾ç¤º"è‡ªå®šä¹‰"å›¾æ ‡

**æ­£ç¡®ä»£ç **:
```typescript
function getFieldState(field: string): 'inherited' | 'customized' | 'modified' {
  const modelConfig = model.config || {}
  const providerConfig = provider.defaultConfig
  
  if (!(field in modelConfig)) return 'inherited'
  
  // âœ… æ¯”è¾ƒå€¼æ˜¯å¦çœŸçš„ä¸åŒ
  const modelValue = modelConfig[field]
  const providerValue = providerConfig[field]
  
  return modelValue === providerValue ? 'inherited' : 'customized'
}
```

**æ•™è®­**:
- **"å­˜åœ¨" â‰  "è‡ªå®šä¹‰"**ï¼Œè¦æ£€æŸ¥**å€¼æ˜¯å¦ä¸åŒ**
- ä¿å­˜é…ç½®æ—¶å¯ä»¥è€ƒè™‘åªä¿å­˜ä¿®æ”¹çš„å­—æ®µï¼ˆä½†å½“å‰è®¾è®¡æ˜¯ä¿å­˜å…¨éƒ¨ï¼‰
- åˆ¤æ–­çŠ¶æ€æ—¶è¦ä»¥"æœ‰æ•ˆå·®å¼‚"ä¸ºå‡†ï¼Œè€Œé"å­—æ®µå­˜åœ¨æ€§"

---

### 6.3 åŸå§‹é…ç½®å¿«ç…§æ—¶æœºé”™è¯¯

**é—®é¢˜æè¿°**:
ä¿®æ”¹é…ç½®åï¼Œå³ä½¿ä¸ä¿å­˜å…³é—­å†æ‰“å¼€ï¼Œ"å¾…ä¿å­˜"çŠ¶æ€æ¶ˆå¤±äº†ã€‚

**é”™è¯¯ä»£ç **:
```typescript
// âŒ æ¯æ¬¡watchéƒ½æ›´æ–°å¿«ç…§
watch(() => props.modelName, () => {
  loadModelConfig()
})

function loadModelConfig() {
  form.value = { /* åŠ è½½é…ç½® */ }
  // âŒ æ²¡æœ‰ä¿å­˜å¿«ç…§
}

// é—®é¢˜ï¼šç”¨æˆ·ä¿®æ”¹ â†’ formæ”¹å˜ â†’ watchè§¦å‘ â†’ é‡æ–°åŠ è½½ â†’ å¿«ç…§ä¸¢å¤±
```

**æ­£ç¡®ä»£ç **:
```typescript
function loadModelConfig() {
  form.value = { /* åŠ è½½é…ç½® */ }
  
  // âœ… ç«‹å³ä¿å­˜å¿«ç…§
  originalConfig.value = { ...form.value }
}

async function handleSubmit() {
  // ... ä¿å­˜é€»è¾‘
  
  // âœ… ä¿å­˜æˆåŠŸåæ›´æ–°å¿«ç…§
  originalConfig.value = { ...form.value }
}
```

**æ•™è®­**:
- å¿«ç…§åº”è¯¥åœ¨**åŠ è½½æ—¶**å’Œ**ä¿å­˜æˆåŠŸå**æ›´æ–°
- ä¸åº”è¯¥åœ¨**watch**æˆ–**computed**ä¸­æ›´æ–°å¿«ç…§
- ä½¿ç”¨æ·±æ‹·è´ `{ ...form.value }` è€Œéå¼•ç”¨

---

### 6.4 å¼‚æ­¥æ–¹æ³•çš„loadingçŠ¶æ€ç®¡ç†

**é—®é¢˜æè¿°**:
æµ‹è¯•è¿æ¥æ—¶ï¼Œå¦‚æœç½‘ç»œå¾ˆå¿«ï¼ŒloadingçŠ¶æ€é—ªçƒï¼Œç”¨æˆ·çœ‹ä¸æ¸…ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```typescript
async function handleTestConnection() {
  testStatus.value = 'testing'
  
  try {
    // âœ… Mockä¸­å·²æœ‰2ç§’å»¶è¿Ÿï¼Œè¶³å¤Ÿå±•ç¤ºloading
    const result = await llmStore.testNewProviderConnection({
      baseUrl: wizardForm.value.baseUrl,
      apiKey: wizardForm.value.apiKey
    })
    
    // âœ… æ·»åŠ æœ€å°å±•ç¤ºæ—¶é—´
    await new Promise(resolve => setTimeout(resolve, 500))
    
    if (result.success) {
      testStatus.value = 'success'
      discoveredModels.value = result.discoveredModels || []
    } else {
      testStatus.value = 'failed'
      testError.value = result.error || 'è¿æ¥å¤±è´¥'
    }
  } catch (error) {
    testStatus.value = 'failed'
    testError.value = error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
  }
}
```

**æ•™è®­**:
- LoadingçŠ¶æ€åº”è¯¥è‡³å°‘å±•ç¤º500msï¼Œé¿å…é—ªçƒ
- é”™è¯¯å¤„ç†è¦åŒºåˆ†ç½‘ç»œé”™è¯¯ã€APIé”™è¯¯ã€ç¨‹åºé”™è¯¯
- ä½¿ç”¨çŠ¶æ€æœºæ¨¡å¼ç®¡ç†å¤æ‚å¼‚æ­¥æµç¨‹

---

### 6.5 Quasarç»„ä»¶çš„v-modelé™·é˜±

**é—®é¢˜æè¿°**:
```vue
<!-- âŒ é”™è¯¯ç”¨æ³• -->
<q-dialog v-model="isOpen">
  <q-card>
    <q-btn @click="isOpen = false" />  <!-- ç›´æ¥ä¿®æ”¹ -->
  </q-card>
</q-dialog>

<script setup>
const props = defineProps<{ modelValue: boolean }>()
const emit = defineEmits<{ 'update:modelValue': [boolean] }>()

const isOpen = ref(false)  // âŒ å†…éƒ¨çŠ¶æ€ï¼Œä¸åŒæ­¥

watch(() => props.modelValue, (val) => {
  isOpen.value = val  // å•å‘åŒæ­¥
})
</script>
```

**æ­£ç¡®ç”¨æ³•**:
```vue
<!-- âœ… ä½¿ç”¨computedåŒå‘ç»‘å®š -->
<q-dialog v-model="isOpen">
  <q-card>
    <q-btn @click="isOpen = false" />  <!-- é€šè¿‡computedè§¦å‘emit -->
  </q-card>
</q-dialog>

<script setup>
const props = defineProps<{ modelValue: boolean }>()
const emit = defineEmits<{ 'update:modelValue': [boolean] }>()

const isOpen = computed({
  get: () => props.modelValue,
  set: (value) => emit('update:modelValue', value)
})
</script>
```

**æ•™è®­**:
- æ¨¡æ€æ¡†çš„ `v-model` å¿…é¡»ä½¿ç”¨ `computed` getter/setter
- ä¸è¦ç”¨ `ref` + `watch` æ‰‹åŠ¨åŒæ­¥ï¼Œå®¹æ˜“æ¼æ‰
- çˆ¶ç»„ä»¶çš„ `v-model` ä¼šè‡ªåŠ¨å¤„ç† `update:modelValue` äº‹ä»¶

---

### 6.6 TypeScriptä¸­çš„ç´¢å¼•è®¿é—®ç±»å‹å®‰å…¨

**é—®é¢˜æè¿°**:
```typescript
// âŒ LintæŠ¥é”™ï¼šUnexpected any
const modelValue = (modelConfig as any)[field]
const providerValue = (providerConfig as any)[field]
```

**åŸå› **:
ESLintè§„åˆ™ `@typescript-eslint/no-explicit-any` ç¦æ­¢æ˜¾å¼ä½¿ç”¨ `any`ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼ˆå¤šç§ï¼‰:

**æ–¹æ¡ˆ1: ç±»å‹æ–­è¨€ä¸ºç´¢å¼•ç±»å‹**
```typescript
type ConfigKeys = keyof ModelConfig

function getFieldState(field: ConfigKeys) {
  const modelValue = modelConfig[field]  // âœ… ç±»å‹å®‰å…¨
  const providerValue = providerConfig[field]
}
```

**æ–¹æ¡ˆ2: ä½¿ç”¨Recordå·¥å…·ç±»å‹**
```typescript
function getFieldState(field: string) {
  const modelConfigRecord = modelConfig as Record<string, unknown>
  const providerConfigRecord = providerConfig as Record<string, unknown>
  
  const modelValue = modelConfigRecord[field]
  const providerValue = providerConfigRecord[field]
}
```

**æ–¹æ¡ˆ3: ç±»å‹å®ˆå«**
```typescript
function isValidConfigKey(key: string): key is keyof ModelConfig {
  return key in providerConfig
}

function getFieldState(field: string) {
  if (!isValidConfigKey(field)) return 'inherited'
  
  const modelValue = modelConfig[field]  // âœ… ç±»å‹æ”¶çª„
  const providerValue = providerConfig[field]
}
```

**æ•™è®­**:
- å°½é‡ä½¿ç”¨ `keyof` è€Œé `string` ä½œä¸ºå­—æ®µç±»å‹
- å¦‚æœå¿…é¡»ç”¨ `any`ï¼Œæ·»åŠ  `// eslint-disable-next-line` æ³¨é‡Šå¹¶è¯´æ˜åŸå› 
- ä¼˜å…ˆä½¿ç”¨ç±»å‹å®ˆå«å’Œç±»å‹æ”¶çª„

---

## ä¸ƒã€æ ‡å‡†å·¥ä½œæµç¨‹æ€»ç»“

åŸºäºæœ¬æ¬¡å®ç°ï¼Œæ€»ç»“å‡º**"æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—"çš„æ ‡å‡†æµç¨‹**ï¼Œå¯ç”¨äºæœªæ¥ç±»ä¼¼å·¥ä½œã€‚

### 7.1 éœ€æ±‚åˆ†æé˜¶æ®µ

#### Step 1: ç¡®å®šå‚è€ƒé¡¹ç›®
- âœ… æ˜ç¡®å‚è€ƒé¡¹ç›®è·¯å¾„ï¼ˆå¦‚ `JiuZhang-NovelStudio`ï¼‰
- âœ… ç†è§£å‚è€ƒé¡¹ç›®çš„å®ç°é€»è¾‘å’Œäº¤äº’è®¾è®¡
- âœ… è¯†åˆ«å¯å¤ç”¨çš„ä»£ç å’Œéœ€è¦è°ƒæ•´çš„éƒ¨åˆ†

#### Step 2: è®¾è®¡æ–‡æ¡£ç¼–å†™
- âœ… åˆ›å»º `Design.md` æˆ– `Design-extension.md`
- âœ… åŒ…å«å†…å®¹ï¼š
  - åŠŸèƒ½æ¦‚è¿°
  - çŠ¶æ€è®¾è®¡ï¼ˆJSONç»“æ„ï¼‰
  - æ–‡ä»¶æ¶æ„ä¿®æ”¹æ ‘
  - æ¥å£/APIè®¾è®¡
  - UIäº¤äº’æµç¨‹å›¾

#### Step 3: ç¡®è®¤Mockç­–ç•¥
- âœ… ç¡®å®šå“ªäº›æ¥å£éœ€è¦Mock
- âœ… è®¾è®¡Mockæ•°æ®ç»“æ„
- âœ… ç¡®å®šMockæ–‡ä»¶å‘½åè§„èŒƒï¼ˆ`{domain}.mock.ts`ï¼‰

---

### 7.2 ç±»å‹å®šä¹‰é˜¶æ®µ

#### Step 1: å®šä¹‰æ ¸å¿ƒç±»å‹
æ–‡ä»¶ï¼š`Client/stores/{domain}/types.ts`

```typescript
// 1. å®šä¹‰å®ä½“ç±»å‹
export interface Entity { ... }

// 2. å®šä¹‰é…ç½®ç±»å‹
export interface Config { ... }

// 3. å®šä¹‰è¯·æ±‚/å“åº”ç±»å‹
export interface ApiRequest { ... }
export interface ApiResponse { ... }

// 4. å®šä¹‰æšä¸¾ç±»å‹
export type Status = 'active' | 'inactive'

// 5. å®šä¹‰å·¥å…·å‡½æ•°
export function createId(...): string { ... }
export function parseId(...): { ... } { ... }
```

#### Step 2: éªŒè¯ç±»å‹å®Œæ•´æ€§
- âœ… æ‰€æœ‰æ¥å£éƒ½æœ‰æ˜ç¡®çš„å­—æ®µç±»å‹
- âœ… å¿…å¡«/å¯é€‰å­—æ®µæ ‡è®°æ¸…æ™°ï¼ˆ`?:`ï¼‰
- âœ… æšä¸¾ç±»å‹ä½¿ç”¨è”åˆç±»å‹è€Œé `enum`
- âœ… å¯¼å‡ºæ‰€æœ‰å¯èƒ½è¢«å¤–éƒ¨å¼•ç”¨çš„ç±»å‹

---

### 7.3 æ•°æ®å±‚å®ç°é˜¶æ®µ

#### Step 1: åˆ›å»ºMockæ•°æ®
æ–‡ä»¶ï¼š`Client/stores/{domain}/{domain}.mock.ts`

```typescript
import type { Entity } from './types'

export const entityMock: Entity[] = [
  { id: 'xxx', name: 'xxx', ... },
  // ... è‡³å°‘3ä¸ªå®Œæ•´ç¤ºä¾‹
]

// æ¨¡æ‹Ÿå»¶è¿Ÿ
async function simulateDelay(ms = 2000) {
  await new Promise(resolve => setTimeout(resolve, ms))
}
```

#### Step 2: åˆ›å»ºDataSourceå±‚
æ–‡ä»¶ï¼š`Client/stores/{domain}/DataSource.ts`

```typescript
import { entityMock } from './{domain}.mock'

export const useMockSource = ref(true)  // å¼€å…³

export async function fetchEntities(): Promise<Entity[]> {
  await simulateDelay()
  if (useMockSource.value) {
    return entityMock
  }
  // TODO: å¯¹æ¥çœŸå®åç«¯
  throw new Error('Real API not implemented')
}

export async function createEntity(data: CreateData): Promise<Entity> {
  await simulateDelay()
  if (useMockSource.value) {
    const newEntity = { id: generateId(), ...data }
    entityMock.push(newEntity)
    return newEntity
  }
  throw new Error('Real API not implemented')
}

// ... å…¶ä»–CRUDæ–¹æ³•
```

#### Step 3: é¢„ç•™IPCé€šé“ï¼ˆæ³¨é‡Šï¼‰
```typescript
// TODO: å¯¹æ¥IPCé€šé“
// const result = await window.electron.invoke('domain:action', payload)
```

---

### 7.4 Storeå±‚å®ç°é˜¶æ®µ

#### Step 1: å®šä¹‰Store
æ–‡ä»¶ï¼š`Client/stores/{domain}/{domain}.store.ts`

```typescript
import { defineStore } from 'pinia'
import * as DataSource from './DataSource'
import type { Entity } from './types'

export const useDomainStore = defineStore('domain', () => {
  // 1. çŠ¶æ€å®šä¹‰
  const entities = ref<Entity[]>([])
  const loading = ref(false)
  
  // 2. Computedæ´¾ç”Ÿ
  const activeEntities = computed(() => 
    entities.value.filter(e => e.status === 'active')
  )
  
  // 3. åŠ è½½æ–¹æ³•ï¼ˆå¼‚æ­¥ï¼‰
  async function loadEntities() {
    console.log('ğŸ”„ [Domain Store] å¼€å§‹åŠ è½½')
    loading.value = true
    try {
      entities.value = await DataSource.fetchEntities()
      console.log('âœ… [Domain Store] åŠ è½½æˆåŠŸ:', entities.value.length)
    } catch (error) {
      console.error('âŒ [Domain Store] åŠ è½½å¤±è´¥:', error)
      throw error
    } finally {
      loading.value = false
    }
  }
  
  // 4. åˆå§‹åŒ–æ–¹æ³•
  async function initialize() {
    console.log('ğŸš€ [Domain Store] åˆå§‹åŒ–å¼€å§‹')
    await loadEntities()
    console.log('âœ… [Domain Store] åˆå§‹åŒ–å®Œæˆ')
  }
  
  // 5. CRUDæ–¹æ³•
  async function createEntity(data: CreateData): Promise<boolean> {
    try {
      const newEntity = await DataSource.createEntity(data)
      entities.value.push(newEntity)
      console.log('âœ… [Domain Store] å®ä½“å·²åˆ›å»º:', newEntity.id)
      return true
    } catch (error) {
      console.error('âŒ [Domain Store] åˆ›å»ºå¤±è´¥:', error)
      return false
    }
  }
  
  // ... å…¶ä»–æ–¹æ³•
  
  // 6. è¿”å›å…¬å¼€æ¥å£
  return {
    // çŠ¶æ€
    entities: readonly(entities),
    loading: readonly(loading),
    
    // Computed
    activeEntities,
    
    // æ–¹æ³•
    initialize,
    loadEntities,
    createEntity,
    // ...
  }
})
```

#### Step 2: åˆ›å»ºç»Ÿä¸€å¯¼å‡º
æ–‡ä»¶ï¼š`Client/stores/{domain}/index.ts`

```typescript
export { useDomainStore } from './{domain}.store'
export * from './types'
```

---

### 7.5 ç»„ä»¶å±‚å®ç°é˜¶æ®µ

#### Step 1: åˆ›å»ºç»„ä»¶å±‚çº§ç»“æ„
```
Components/{Feature}/
â”œâ”€â”€ {Feature}.vue                    # ä¸»ç»„ä»¶
â”œâ”€â”€ {Feature}.List.vue               # åˆ—è¡¨ç»„ä»¶
â”œâ”€â”€ {Feature}.Card.vue               # å¡ç‰‡ç»„ä»¶
â”œâ”€â”€ {Feature}.Detail.vue             # è¯¦æƒ…ç»„ä»¶
â”œâ”€â”€ {Feature}.AddModal.vue           # æ·»åŠ æ¨¡æ€æ¡†
â””â”€â”€ {Feature}.ConfigModal.vue        # é…ç½®æ¨¡æ€æ¡†
```

#### Step 2: ä¸»ç»„ä»¶éª¨æ¶
```vue
<script setup lang="ts">
import { useDomainStore } from 'stores/{domain}'

const domainStore = useDomainStore()

// çŠ¶æ€
const showAddModal = ref(false)
const currentEntity = ref<Entity | null>(null)

// æ–¹æ³•
function handleAdd() {
  showAddModal.value = true
}

function handleEntityClick(entity: Entity) {
  currentEntity.value = entity
}

// åˆå§‹åŒ–
onMounted(() => {
  domainStore.initialize()
})
</script>

<template>
  <div class="feature-container">
    <!-- å·¥å…·æ  -->
    <div class="toolbar">
      <q-btn @click="handleAdd">æ·»åŠ </q-btn>
    </div>
    
    <!-- åˆ—è¡¨ -->
    <FeatureList 
      :entities="domainStore.entities"
      @entity-click="handleEntityClick"
    />
    
    <!-- æ·»åŠ æ¨¡æ€æ¡† -->
    <FeatureAddModal 
      v-model="showAddModal"
      @added="domainStore.loadEntities"
    />
  </div>
</template>
```

#### Step 3: å­ç»„ä»¶å®ç°
```vue
<!-- List.vue -->
<script setup lang="ts">
const props = defineProps<{
  entities: Entity[]
}>()

const emit = defineEmits<{
  'entity-click': [Entity]
}>()
</script>

<template>
  <div class="list">
    <FeatureCard
      v-for="entity in entities"
      :key="entity.id"
      :entity="entity"
      @click="emit('entity-click', entity)"
    />
  </div>
</template>
```

---

### 7.6 é›†æˆä¸æµ‹è¯•é˜¶æ®µ

#### Step 1: åœ¨çˆ¶ç»„ä»¶ä¸­é›†æˆ
```vue
<!-- ä¾‹å¦‚åœ¨ SettingsDialog.vue ä¸­ -->
<template>
  <q-tabs>
    <q-tab name="feature" label="åŠŸèƒ½åç§°" />
  </q-tabs>
  
  <q-tab-panels>
    <q-tab-panel name="feature">
      <Feature />
    </q-tab-panel>
  </q-tab-panels>
</template>
```

#### Step 2: æµ‹è¯•æ¸…å•
- âœ… Storeåˆå§‹åŒ–æˆåŠŸ
- âœ… Mockæ•°æ®åŠ è½½æ­£å¸¸
- âœ… CRUDæ“ä½œå“åº”æ­£ç¡®
- âœ… LoadingçŠ¶æ€æ˜¾ç¤º
- âœ… é”™è¯¯å¤„ç†å’Œæç¤º
- âœ… UIäº¤äº’æµç•…
- âœ… æ— Linté”™è¯¯

#### Step 3: æ§åˆ¶å°æ—¥å¿—éªŒè¯
```
ğŸš€ [Domain Store] åˆå§‹åŒ–å¼€å§‹
ğŸ”„ [Domain Store] å¼€å§‹åŠ è½½
âœ… [Domain Store] åŠ è½½æˆåŠŸ: 3 ä¸ª
âœ… [Domain Store] åˆå§‹åŒ–å®Œæˆ
```

---

### 7.7 æ–‡æ¡£ç¼–å†™é˜¶æ®µ

#### Step 1: æ›´æ–°è®¾è®¡æ–‡æ¡£
- âœ… æ ‡è®°å·²å®ç°çš„åŠŸèƒ½
- âœ… è®°å½•å®é™…å®ç°ä¸è®¾è®¡çš„å·®å¼‚
- âœ… æ·»åŠ å®ç°ç»†èŠ‚å’Œæ³¨æ„äº‹é¡¹

#### Step 2: ç¼–å†™æ€»ç»“æŠ¥å‘Š
æ–‡ä»¶ï¼š`Document/æ€»ç»“/{Feature}å®ç°æ€»ç»“_{æ—¥æœŸ}.md`

åŒ…å«ç« èŠ‚ï¼š
1. å®ç°æ¦‚è¿°
2. æ–°å¢åŠŸèƒ½æ¸…å•
3. æ–‡ä»¶å˜æ›´æ¸…å•
4. API/æ¥å£/æ–¹æ³•æ±‡æ€»
5. é¡¹ç›®ä¹ æƒ¯ä¸è§„èŒƒ
6. è¸©è¿‡çš„å‘ä¸ç»éªŒæ€»ç»“
7. æ ‡å‡†å·¥ä½œæµç¨‹æ€»ç»“
8. æœªæ¥ä¼˜åŒ–æ–¹å‘

---

## å…«ã€æœªæ¥ä¼˜åŒ–æ–¹å‘

### 8.1 åŠŸèƒ½æ‰©å±•

#### 1. æä¾›å•†æ¨¡æ¿å¸‚åœº
- é¢„ç½®å¸¸è§LLMæä¾›å•†é…ç½®ï¼ˆOpenAIã€Claudeã€Geminiç­‰ï¼‰
- ä¸€é”®å¯¼å…¥æ¨¡æ¿ï¼Œè‡ªåŠ¨å¡«å……APIåœ°å€å’Œæ¨¡å‹åˆ—è¡¨

#### 2. æ¨¡å‹æ€§èƒ½ç›‘æ§
- è®°å½•æ¯ä¸ªæ¨¡å‹çš„è°ƒç”¨æ¬¡æ•°ã€å¹³å‡å“åº”æ—¶é—´ã€é”™è¯¯ç‡
- åœ¨ProviderCardä¸Šå±•ç¤ºæ€§èƒ½æŒ‡æ ‡
- æ ¹æ®æ€§èƒ½è‡ªåŠ¨æ¨è"æœ€ä½³æ¨¡å‹"

#### 3. é…ç½®ç‰ˆæœ¬ç®¡ç†
- æ”¯æŒé…ç½®å¿«ç…§ï¼ˆSnapshotï¼‰
- æ”¯æŒå›æ»šåˆ°å†å²é…ç½®
- é…ç½®å¯¹æ¯”åŠŸèƒ½ï¼ˆDiff Viewï¼‰

#### 4. æ‰¹é‡æ“ä½œ
- æ‰¹é‡åˆ é™¤æ¨¡å‹
- æ‰¹é‡ä¿®æ”¹é…ç½®ï¼ˆä¾‹å¦‚ç»Ÿä¸€è°ƒæ•´æ‰€æœ‰æ¨¡å‹çš„maxTokensï¼‰
- æ‰¹é‡å¯¼å…¥/å¯¼å‡ºæä¾›å•†

### 8.2 æŠ€æœ¯ä¼˜åŒ–

#### 1. çœŸå®åç«¯å¯¹æ¥
```typescript
// å½“å‰
const useMockSource = ref(true)

// æœªæ¥
const useMockSource = ref(import.meta.env.DEV)  // å¼€å‘ç¯å¢ƒç”¨Mockï¼Œç”Ÿäº§ç”¨çœŸå®API

// DataSource.ts
export async function fetchProviders(): Promise<ModelProvider[]> {
  if (useMockSource.value) {
    return providersMock
  }
  
  // âœ… å¯¹æ¥IPC
  const result = await window.electron.invoke('llm:providers:list')
  return result.data
}
```

#### 2. é…ç½®æŒä¹…åŒ–
- å°†é…ç½®ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼ˆJSON/YAMLï¼‰
- æ”¯æŒäº‘ç«¯åŒæ­¥ï¼ˆå¯é€‰ï¼‰
- è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

#### 3. æ€§èƒ½ä¼˜åŒ–
- å¤§é‡æ¨¡å‹æ—¶ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆ`q-virtual-scroll`ï¼‰
- é…ç½®å˜æ›´é˜²æŠ–ï¼ˆDebounceï¼‰
- Computedå±æ€§ç¼“å­˜ä¼˜åŒ–

#### 4. é”™è¯¯å¤„ç†å¢å¼º
```typescript
// å½“å‰
try {
  await someAction()
} catch (error) {
  console.error(error)
  Notify.create({ type: 'negative', message: 'æ“ä½œå¤±è´¥' })
}

// æœªæ¥
try {
  await someAction()
} catch (error) {
  // âœ… åˆ†ç±»é”™è¯¯å¤„ç†
  if (error instanceof NetworkError) {
    showRetryDialog()
  } else if (error instanceof ValidationError) {
    highlightInvalidFields(error.fields)
  } else {
    reportErrorToSentry(error)
  }
}
```

### 8.3 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 1. å¼•å¯¼å¼é…ç½®å‘å¯¼
- é¦–æ¬¡ä½¿ç”¨æ—¶å±•ç¤ºäº¤äº’å¼æ•™ç¨‹
- é«˜äº®å…³é”®æ“ä½œæ­¥éª¤
- æä¾›"è·³è¿‡æ•™ç¨‹"é€‰é¡¹

#### 2. æœç´¢ä¸è¿‡æ»¤
- åœ¨ProviderListä¸­æ·»åŠ æœç´¢æ¡†
- æŒ‰çŠ¶æ€ã€ç±»å‹è¿‡æ»¤æä¾›å•†
- æ¨¡ç³ŠåŒ¹é…æ¨¡å‹åç§°

#### 3. å¿«æ·æ“ä½œ
- é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆå¦‚ Ctrl+N æ·»åŠ æä¾›å•†ï¼‰
- å³é”®èœå•æ‰©å±•ï¼ˆå¤åˆ¶é…ç½®ã€å¯¼å‡ºå•ä¸ªæä¾›å•†ï¼‰
- æ‹–æ‹½æ’åºæä¾›å•†ä¼˜å…ˆçº§

#### 4. è§†è§‰åé¦ˆå¢å¼º
- é…ç½®ä¿å­˜æ—¶çš„æˆåŠŸåŠ¨ç”»
- åˆ é™¤æ“ä½œçš„ç¡®è®¤å¯¹è¯æ¡†
- é•¿æ—¶é—´æ“ä½œçš„è¿›åº¦æ¡ï¼ˆå¦‚æµ‹è¯•è¿æ¥ï¼‰

---

## ä¹ã€ç›¸å…³æ–‡æ¡£ç´¢å¼•

### è®¾è®¡æ–‡æ¡£
- `Document/Design/LLmé…ç½®ç³»ç»Ÿ/Design-extension.md` - æ‰©å±•è®¾è®¡æ–‡æ¡£
- `Document/Design/LLmé…ç½®ç³»ç»Ÿ/llm-config-system.plan1.md` - åˆå§‹è®¡åˆ’ï¼ˆå·²åˆ é™¤ï¼‰

### æ€»ç»“æ–‡æ¡£
- `Document/æ€»ç»“/LLMé…ç½®ç³»ç»Ÿå®ç°æ€»ç»“_2025å¹´10æœˆ11æ—¥.md` - åŸºç¡€å®ç°æ€»ç»“
- `Document/æ€»ç»“/JiuZhang-LLMé…ç½®äº¤äº’è®¾è®¡åˆ†æ.md` - å‚è€ƒé¡¹ç›®åˆ†æ

### å‚è€ƒé¡¹ç›®
- `JiuZhang-NovelStudio/JiuZhang NovelStudio/Client/GUI/PagesLayout/SettingsPage.vue`
- `JiuZhang-NovelStudio/JiuZhang NovelStudio/Client/stores/settings.ts`

---

## åã€æ€»ç»“

æœ¬æ¬¡è¿­ä»£æˆåŠŸå®Œæˆäº†LLMé…ç½®ç³»ç»Ÿçš„æ ¸å¿ƒæ‰©å±•ï¼Œä¸»è¦äº®ç‚¹åŒ…æ‹¬ï¼š

1. âœ… **å‘å¯¼å¼æ·»åŠ æµç¨‹** - 5æ­¥å¼•å¯¼ï¼ŒåŒ…å«è¿æ¥æµ‹è¯•å’Œæ¨¡å‹é€‰æ‹©
2. âœ… **æ¨¡å‹çº§é…ç½®ç³»ç»Ÿ** - æ”¯æŒç»§æ‰¿+è¦†ç›–çš„é…ç½®ä½“ç³»
3. âœ… **ä¸‰æ€å¯è§†åŒ–** - æ¸…æ™°å±•ç¤ºé…ç½®çš„ç»§æ‰¿/è‡ªå®šä¹‰/å¾…ä¿å­˜çŠ¶æ€
4. âœ… **å®Œå–„çš„Mockç³»ç»Ÿ** - æ‰€æœ‰APIéƒ½æœ‰å¯ç”¨çš„Mockå®ç°
5. âœ… **ç±»å‹å®‰å…¨** - å…¨ç¨‹TypeScriptç±»å‹è¦†ç›–

é€šè¿‡æœ¬æ¬¡å®ç°ï¼Œç§¯ç´¯äº†ä»¥ä¸‹ç»éªŒï¼š

- ğŸ¯ **åˆ†éš”ç¬¦é€‰æ‹©** - é¿å…ä½¿ç”¨æ•°æ®ä¸­å¯èƒ½å‡ºç°çš„å­—ç¬¦
- ğŸ¯ **çŠ¶æ€åˆ¤æ–­** - åŸºäº"å€¼å·®å¼‚"è€Œé"å­—æ®µå­˜åœ¨"
- ğŸ¯ **å¿«ç…§æ—¶æœº** - åœ¨åŠ è½½å’Œä¿å­˜æˆåŠŸæ—¶æ›´æ–°ï¼Œè€Œéwatch
- ğŸ¯ **å¼‚æ­¥åé¦ˆ** - æœ€å°loadingå±•ç¤ºæ—¶é—´ï¼Œé¿å…é—ªçƒ
- ğŸ¯ **ç±»å‹å®‰å…¨** - ä¼˜å…ˆä½¿ç”¨`keyof`å’Œç±»å‹å®ˆå«ï¼Œé¿å…`any`

è¿™å¥—å®ç°ä¸ºæœªæ¥çš„ç±»ä¼¼åŠŸèƒ½å¼€å‘æä¾›äº†æ ‡å‡†åŒ–çš„å·¥ä½œæµç¨‹å’Œå¯å¤ç”¨çš„ä»£ç æ¨¡å¼ã€‚

---

**Bossï¼ŒæŠ¥å‘Šå®Œæˆï¼** ğŸ‰

ä¸‹ä¸€é˜¶æ®µå¯ä»¥è€ƒè™‘ï¼š
1. å¯¹æ¥çœŸå®åç«¯IPCé€šé“
2. å®ç°é…ç½®æŒä¹…åŒ–
3. æ·»åŠ æ€§èƒ½ç›‘æ§å’Œé”™è¯¯ä¸ŠæŠ¥
4. ä¼˜åŒ–å¤§æ•°æ®é‡ä¸‹çš„æ¸²æŸ“æ€§èƒ½

æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è°ƒæ•´çš„åœ°æ–¹è¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼

