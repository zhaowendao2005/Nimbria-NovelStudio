# StarChart ç³»ç»Ÿåˆå§‹å®ç°æ€»ç»“

**å®Œæˆæ—¶é—´**: 2025å¹´10æœˆ17æ—¥ 00:18:35ï¼ˆä¸œå…«åŒºæ—¶é—´ï¼‰  
**é˜¶æ®µ**: ç¬¬ä¸€é˜¶æ®µ - åŸºç¡€è®¾ç½®  
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æˆåŠŸå®ç°äº†åŸºäº Gun.js çš„å°è¯´è®¾å®šå›¾æ•°æ®åº“ **StarChart** çš„ç¬¬ä¸€é˜¶æ®µã€‚è¯¥ç³»ç»Ÿé‡‡ç”¨**æ—¶é—´ç»´åº¦å¿«ç…§æ¶æ„**ï¼Œæ”¯æŒé¡¹ç›®çº§åˆ«çš„å¤šçª—å£éš”ç¦»ï¼Œä¸ºåç»­çš„è®¾å®šèŠ‚ç‚¹å’Œå…³ç³»ç®¡ç†å¥ å®šåŸºç¡€ã€‚

---

## ğŸ¯ å·²å®ç°çš„åŠŸèƒ½

### 1. **Core æœåŠ¡å±‚** âœ…
- `StarChartService` - äº‹ä»¶é©±åŠ¨çš„ä¸»æœåŠ¡ç±»ï¼ˆç»§æ‰¿ EventEmitterï¼‰
- `StarChartManager` - Gun.js å®ä¾‹å’Œé¡¹ç›®çº§åˆ«çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å®Œæ•´çš„ç±»å‹å®šä¹‰ç³»ç»Ÿ (`types/index.ts`)

### 2. **IPC é€šä¿¡å±‚** âœ…
- `star-chart-handlers.ts` - äº‹ä»¶ç›‘å¬å™¨ + IPC å¤„ç†å™¨
- æ”¯æŒå¤šçª—å£äº‹ä»¶å¹¿æ’­
- å¼‚æ­¥æ“ä½œç«‹å³è¿”å› IDï¼Œé€šè¿‡äº‹ä»¶åé¦ˆçŠ¶æ€

### 3. **å‰ç«¯ API å±‚** âœ…
- `project-preload.ts` ä¸­çš„ `starChart` API
- è‡ªåŠ¨ä½¿ç”¨ `currentProjectPath`ï¼ˆæ— éœ€æ‰‹åŠ¨ä¼ é€’ï¼‰
- äº‹ä»¶ç›‘å¬æ¥å£å®Œæ•´

### 4. **ç±»å‹å®šä¹‰** âœ…
- `Client/types/core/window.d.ts` ä¸­å®Œæ•´çš„ TypeScript ç±»å‹
- åŒ…å«æ‰€æœ‰ API æ–¹æ³•å’Œäº‹ä»¶ç±»å‹

### 5. **UI é›†æˆ** âœ…
- `SettingsPanel.vue` æ·»åŠ åˆå§‹åŒ–å’Œæµ‹è¯•æŒ‰é’®
- æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼ˆåˆ›å»ºæ—¶é—´ã€ç‰ˆæœ¬å·ï¼‰
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

### 6. **é…ç½®ä¼˜åŒ–** âœ…
- `quasar.config.ts` ä¸­æ·»åŠ  Gun.js å¤–éƒ¨ä¾èµ–
- `package.json` ä¸­æ·»åŠ  Gun.js ä¾èµ–

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### **å¤šçª—å£éš”ç¦»æ¶æ„**
```
é¡¹ç›®çª—å£ 1                    é¡¹ç›®çª—å£ 2
    â†“                              â†“
StarChart Instance 1      StarChart Instance 2
    â†“                              â†“
.Database/StarChart/      .Database/StarChart/
(starchart-1)             (starchart-2)
```

### **æ—¶é—´ç»´åº¦å¿«ç…§è®¾è®¡**
```
StarChart/
â”œâ”€â”€ T0: { characters: {...}, organizations: {...} }  // åˆå§‹å¿«ç…§
â”œâ”€â”€ T1: { characters: {...}, organizations: {...} }  // ç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹
â”œâ”€â”€ T2: { characters: {...}, organizations: {...} }  // ç¬¬äºŒä¸ªæ—¶é—´ç‚¹
â””â”€â”€ ... æ›´å¤šæ—¶é—´å¿«ç…§
```

### **äº‹ä»¶é©±åŠ¨æµç¨‹**
```
å‰ç«¯æŒ‰é’®ç‚¹å‡» â†’ IPC invoke(ç«‹å³è¿”å›ID) 
                    â†“
            åç«¯å¼‚æ­¥å¤„ç†(setImmediate)
                    â†“
            emitäº‹ä»¶(all windows)
                    â†“
            å‰ç«¯ç›‘å¬äº‹ä»¶æ›´æ–°UI
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„ä¸ä½ç½®

### **åç«¯æ–‡ä»¶** (Electron Main Process)
```
Nimbria/src-electron/
â”œâ”€â”€ services/star-chart-service/
â”‚   â”œâ”€â”€ types/index.ts                    # âœ… åˆ›å»º
â”‚   â”œâ”€â”€ star-chart-service.ts             # âœ… åˆ›å»º
â”‚   â”œâ”€â”€ star-chart-manager.ts             # âœ… åˆ›å»º
â”œâ”€â”€ ipc/main-renderer/
â”‚   â”œâ”€â”€ star-chart-handlers.ts            # âœ… åˆ›å»º
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ app-manager.ts                    # âœ… ä¿®æ”¹
â”‚   â”œâ”€â”€ project-preload.ts                # âœ… ä¿®æ”¹
â”œâ”€â”€ quasar.config.ts                      # âœ… ä¿®æ”¹
```

### **å‰ç«¯æ–‡ä»¶** (Vue 3 + Quasar)
```
Nimbria/Client/
â”œâ”€â”€ types/core/
â”‚   â”œâ”€â”€ window.d.ts                       # âœ… ä¿®æ”¹
â”œâ”€â”€ GUI/components/ProjectPage.Shell/Navbar.content/Settings/
â”‚   â”œâ”€â”€ SettingsPanel.vue                 # âœ… ä¿®æ”¹
```

### **é…ç½®æ–‡ä»¶**
```
Nimbria/
â”œâ”€â”€ package.json                          # âœ… ä¿®æ”¹
â”œâ”€â”€ quasar.config.ts                      # âœ… ä¿®æ”¹
```

### **æ•°æ®å­˜å‚¨ä½ç½®**ï¼ˆé¡¹ç›®çº§åˆ«ï¼‰
```
é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ .Database/
    â””â”€â”€ StarChart/
        â”œâ”€â”€ 1          # Gun.js Radisk å—æ–‡ä»¶
        â”œâ”€â”€ 961C       # Gun.js Radisk å—æ–‡ä»¶
        â””â”€â”€ ... (æ›´å¤šå—æ–‡ä»¶)
```

---

## ğŸ”Œ API æ¥å£æ€»ç»“

### **åç«¯ IPC å¤„ç†å™¨**
```typescript
// å…¨å±€åˆå§‹åŒ–ï¼ˆåªéœ€è°ƒç”¨ä¸€æ¬¡ï¼‰
ipcMain.handle('starchart:initialize', async () => {})

// é¡¹ç›®çº§åˆ›å»º
ipcMain.handle('starchart:create-project', async (_event, { projectPath }) => {})

// å…ƒæ•°æ®è¯»å–
ipcMain.handle('starchart:get-metadata', async (_event, { projectPath }) => {})
```

### **å‰ç«¯ API**
```typescript
window.nimbria.starChart.initialize()              // å…¨å±€åˆå§‹åŒ–
window.nimbria.starChart.createProject()           // åˆ›å»ºé¡¹ç›® StarChart
window.nimbria.starChart.getMetadata()             // è¯»å–å…ƒæ•°æ®

// äº‹ä»¶ç›‘å¬
window.nimbria.starChart.onInitStart((data) => {})
window.nimbria.starChart.onInitComplete((data) => {})
window.nimbria.starChart.onProjectCreated((data) => {})
window.nimbria.starChart.onProjectError((data) => {})
```

---

## âš ï¸ è¸©è¿‡çš„å‘ä¸ç»éªŒæ€»ç»“

### **å‘ 1ï¼šGun.js ä¾èµ–é…ç½®** ğŸ”´
**é—®é¢˜**ï¼šç¼–è¯‘æ—¶æŠ¥é”™ `Cannot find package 'gun'`  
**æ ¹å› **ï¼šGun.js è™½ç„¶å·²å®‰è£…åˆ° `/Nimbria/node_modules`ï¼Œä½† Quasar çš„ Esbuild æ²¡æœ‰æ ‡è®°ä¸ºå¤–éƒ¨ä¾èµ–  
**è§£å†³**ï¼šåœ¨ `quasar.config.ts` ä¸­æ·»åŠ  `esbuildConf.external.push('gun')`  
**ç»éªŒ**ï¼šéœ€è¦åŒæ—¶ä¿®æ”¹ `package.json` å’Œ `quasar.config.ts`

### **å‘ 2ï¼šå¤šçª—å£ API æš´éœ²ä½ç½®** ğŸŸ¡
**é—®é¢˜**ï¼šæœ€åˆè®¾è®¡ API æ”¾åœ¨ `main-preload.ts`ï¼Œä½† SettingsPanel.vue åœ¨é¡¹ç›®çª—å£ä¸­è¿è¡Œ  
**è§£å†³**ï¼šAPI å¿…é¡»æ”¾åœ¨ `project-preload.ts` ä¸­  
**ç»éªŒ**ï¼šç†è§£å¤šçª—å£æ¶æ„ï¼šä¸»çª—å£ vs é¡¹ç›®çª—å£

### **å‘ 3ï¼šGun.js æ–‡ä»¶æ ¼å¼ç†è§£** ğŸŸ¢
**é—®é¢˜**ï¼šçœ‹åˆ°é¡¹ç›®ç›®å½•ä¸‹æœ‰å¤šä¸ªæ— åç¼€çš„äºŒè¿›åˆ¶æ–‡ä»¶  
**è§£å†³**ï¼šæŸ¥é˜… Gun.js æ–‡æ¡£ï¼Œç¡®è®¤ Radisk é€‚é…å™¨å°±æ˜¯è¿™æ ·è®¾è®¡çš„  
**ç»éªŒ**ï¼šGun.js ä½¿ç”¨ LevelDB å…¼å®¹çš„å—æ–‡ä»¶æ ¼å¼ï¼Œåˆ†å—å­˜å‚¨æé«˜æ€§èƒ½

---

## ğŸ”„ æ ‡å‡†åç«¯åŠŸèƒ½å®ç°æµç¨‹æ€»ç»“

### **æ·»åŠ æ–°åç«¯æ¨¡å—çš„æ ‡å‡†æµç¨‹**ï¼ˆçº¦ 2-3 å°æ—¶ï¼‰

1. **å®šä¹‰ç±»å‹** (10 min) â†’ `src-electron/services/{module}/types/index.ts`
2. **å®ç°ç®¡ç†å™¨** (15 min) â†’ `src-electron/services/{module}/{module}-manager.ts`
3. **å®ç°æœåŠ¡** (20 min) â†’ `src-electron/services/{module}/{module}-service.ts`
4. **IPC å¤„ç†å™¨** (15 min) â†’ `src-electron/ipc/main-renderer/{module}-handlers.ts`
5. **ä¸»è¿›ç¨‹é›†æˆ** (10 min) â†’ ä¿®æ”¹ `app-manager.ts`
6. **å‰ç«¯ API** (10 min) â†’ ä¿®æ”¹ `project-preload.ts` æˆ– `main-preload.ts`
7. **ç±»å‹å®šä¹‰** (10 min) â†’ ä¿®æ”¹ `Client/types/core/window.d.ts`
8. **UI é›†æˆ** (15 min) â†’ åˆ›å»º/ä¿®æ”¹å‰ç«¯ç»„ä»¶
9. **é…ç½®ä¼˜åŒ–** (5 min) â†’ ä¿®æ”¹ `quasar.config.ts`
10. **ä¾èµ–ç®¡ç†** (5 min) â†’ ä¿®æ”¹ `package.json`

**å…³é”®è¦ç‚¹**:
- ä»ä¸‹åˆ°ä¸Šé€å±‚æ„å»º
- ä¿æŒäº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸€è‡´
- ç±»å‹å®‰å…¨è´¯ç©¿å…¨æ ˆ
- å¤šçª—å£éš”ç¦»å¿…é¡»è€ƒè™‘

---

## ğŸ‰ æ€»ç»“

ç¬¬ä¸€é˜¶æ®µé¡ºåˆ©å®Œæˆï¼StarChart ç³»ç»Ÿçš„åŸºç¡€æ¶æ„å·²å»ºç«‹ï¼Œäº‹ä»¶é©±åŠ¨é€šä¿¡ä½“ç³»å·²éªŒè¯å¯è¡Œï¼ŒGun.js æŒä¹…åŒ–å­˜å‚¨æ­£å¸¸å·¥ä½œï¼Œå¤šçª—å£éš”ç¦»è®¾è®¡å¾—åˆ°éªŒè¯ã€‚

---

**æŠ¥å‘Šæ—¥æœŸ**: 2025å¹´10æœˆ17æ—¥ 00:18:35
