## ğŸ“Š **å®Œæ•´å·¥ä½œæ€»ç»“æŠ¥å‘Šï¼ˆåŒ…å«æ‰€æœ‰ä¸Šä¸‹æ–‡ï¼‰**

**å»ºè®®æ–‡ä»¶å**ï¼š`2025-10-21_15-45-30_LLMç¿»è¯‘ç³»ç»Ÿç«¯åˆ°ç«¯è°ƒè¯•ä¸å®Œå–„æ€»ç»“.md`

**æ–‡ä»¶ä½ç½®**ï¼š`Document/æ€»ç»“/2025-10-21_15-45-30_LLMç¿»è¯‘ç³»ç»Ÿç«¯åˆ°ç«¯è°ƒè¯•ä¸å®Œå–„æ€»ç»“.md`

---

### **æŠ¥å‘Šå†…å®¹**

```markdown
# LLM Translate ç³»ç»Ÿ - ç«¯åˆ°ç«¯è°ƒè¯•ä¸å®Œå–„æ€»ç»“

**æ—¥æœŸ**: 2025å¹´10æœˆ21æ—¥  
**æ—¶é—´**: 15:45 (UTC+8)  
**çŠ¶æ€**: âœ… å…¨éƒ¨é—®é¢˜å·²è§£å†³ - ç³»ç»Ÿå¯æ­£å¸¸è¿è¡Œ

---

## ğŸ“‹ **æœ¬é˜¶æ®µå®Œæˆå·¥ä½œæ€»è§ˆ**

åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬ç»å†äº†ä¸€ä¸ªå®Œæ•´çš„**ä»é—®é¢˜è¯Šæ–­ â†’ ä¿®å¤éªŒè¯ â†’ åŠŸèƒ½å®Œå–„ â†’ å·¥ä½œæµç¨‹æ€»ç»“**çš„è¿‡ç¨‹ã€‚

### **æ ¸å¿ƒæˆå°±**
- âœ… ä¿®å¤äº†5ä¸ªå…³é”®ç³»ç»Ÿé—®é¢˜
- âœ… å®Œæˆäº†4ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—
- âœ… å»ºç«‹äº†æ ‡å‡†çš„åç«¯é›†æˆæµç¨‹
- âœ… ç³»ç»Ÿè¾¾åˆ°å¯ç”¨çŠ¶æ€

---

## ğŸ”§ **ç¬¬ä¸€é˜¶æ®µï¼šåˆå§‹é—®é¢˜ä¿®å¤ï¼ˆ3ä¸ªæ ¸å¿ƒé—®é¢˜ï¼‰**

### **é—®é¢˜ #1: ModelSelector.vue - API è°ƒç”¨é”™è¯¯** âŒ â†’ âœ…

**æ–‡ä»¶**: `Nimbria/Client/GUI/DemoPage/LlmTranslate/components/ModelSelector.vue`

**é—®é¢˜æ ¹å› **ï¼š
- ä½¿ç”¨è¿‡æ—¶çš„ `window.ipc.invoke()` API
- å°è¯•è°ƒç”¨ `llm-config:get-all-providers` IPC é€šé“ï¼ˆä¸å­˜åœ¨ï¼‰

**é”™è¯¯ä¿¡æ¯**ï¼š
```
TypeError: Cannot read properties of undefined (reading 'invoke')
at loadProviders (ModelSelector.vue:62:37)
```

**ä¿®å¤å†…å®¹**ï¼š
```typescript
// ä¿®æ”¹å‰
const result = await window.ipc.invoke('llm-config:get-all-providers')
providers.value = result.data || []

// ä¿®æ”¹å
const result = await (window as any).nimbria.llm.getProviders()
providers.value = result.providers || []
```

**éªŒè¯**ï¼šâœ… æ—¥å¿—è¾“å‡º `âœ… [ModelSelector] åŠ è½½äº† 1 ä¸ªæä¾›å•†`

---

### **é—®é¢˜ #2: translate.store.ts - äº‹ä»¶ç›‘å¬å™¨è°ƒç”¨æ–¹å¼** âŒ â†’ âœ…

**æ–‡ä»¶**: `Nimbria/Client/GUI/DemoPage/LlmTranslate/stores/translate.store.ts`

**é—®é¢˜æ ¹å› **ï¼š
- ä½¿ç”¨ `electronAPI.value.on()` ä½†è¯¥å¯¹è±¡ä¸æš´éœ² `on` æ–¹æ³•
- åº”è¯¥ä½¿ç”¨é€šç”¨çš„ `window.nimbria.on()` æ¥ç›‘å¬ IPC äº‹ä»¶

**ä¿®å¤ä½ç½®**ï¼ˆ4å¤„ï¼‰ï¼š
1. `llm-translate:task-state-changed` äº‹ä»¶ç›‘å¬
2. `llm-translate:task-progress-updated` äº‹ä»¶ç›‘å¬
3. `llm-translate:task-completed` äº‹ä»¶ç›‘å¬
4. `llm-translate:task-error-occurred` äº‹ä»¶ç›‘å¬

**ä¿®å¤æ¨¡å¼**ï¼š
```typescript
// ä¿®æ”¹å‰
electronAPI.value.on('event-name', (data) => { ... })

// ä¿®æ”¹å
;(window as any).nimbria.on('event-name', (data) => { ... })
```

**éªŒè¯**ï¼šâœ… æ—¥å¿—è¾“å‡º `âœ… [Store] LLM Translate äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®`

---

### **é—®é¢˜ #3: ProjectDatabase - Schema ç‰ˆæœ¬ç¼ºå¤±** âŒ â†’ âœ…

**æ–‡ä»¶**: `Nimbria/src-electron/services/database-service/project-database.ts`

**é—®é¢˜æ ¹å› **ï¼š
```
Error: no such table: Llmtranslate_batches
```
- ProjectDatabase ä½¿ç”¨çš„æ˜¯æ—§çš„ schema ç‰ˆæœ¬ï¼ˆv1.2.0ï¼‰
- è¯¥ç‰ˆæœ¬ä¸åŒ…å« LLM Translate æ‰€éœ€çš„è¡¨

**ä¿®å¤å†…å®¹**ï¼š
```typescript
// ä¿®æ”¹å‰
import { PROJECT_SCHEMA_V1_2_0 } from './schema/versions'
this.databaseManager.createProjectDatabase(this.projectPath, PROJECT_SCHEMA_V1_2_0)

// ä¿®æ”¹å
import { PROJECT_SCHEMA_V1_2_1 } from './schema/versions'
this.databaseManager.createProjectDatabase(this.projectPath, PROJECT_SCHEMA_V1_2_1)
```

**éªŒè¯**ï¼šâœ… ä»»åŠ¡å¯ä»¥æ­£å¸¸åˆ›å»ºå¹¶å†™å…¥æ•°æ®åº“

---

## ğŸ¯ **ç¬¬äºŒé˜¶æ®µï¼šæ¨¡å‹åŠ è½½ä¼˜åŒ–**

### **é—®é¢˜ #4: ModelSelector æ•°æ®ç»“æ„è§£æé”™è¯¯** âŒ â†’ âœ…

**æ–‡ä»¶**: `Nimbria/Client/GUI/DemoPage/LlmTranslate/components/ModelSelector.vue`

**é—®é¢˜**ï¼šæ¨¡å‹åˆ—è¡¨å§‹ç»ˆä¸ºç©ºï¼Œå› ä¸ºå¯¹è¿”å›æ•°æ®çš„ç»“æ„ç†è§£é”™è¯¯

**ä¿®å¤**ï¼š
```typescript
// ä¿®å¤å‰
const groupedModels = computed(() => {
  return providers.value.map(provider => ({
    label: provider.name,
    options: provider.models || []  // âŒ é”™è¯¯çš„å­—æ®µå
  }))
})

// ä¿®å¤å
const groupedModels = computed(() => {
  return providers.value
    .filter(provider => provider.supportedModels && provider.supportedModels.length > 0)
    .map(provider => {
      const llmModels = provider.supportedModels
        .filter(m => m.type === 'LLM' && provider.activeModels?.LLM?.selectedModels?.includes(m.name))
      return {
        label: provider.name,
        options: llmModels.map(m => ({ label: m.name, value: `${provider.id}.${m.name}` }))
      }
    })
})
```

**å…³é”®æ”¹è¿›**ï¼š
- âœ… åªæ˜¾ç¤ºå·²æ¿€æ´»çš„æ¨¡å‹
- âœ… æŒ‰æä¾›å•†åˆ†ç»„
- âœ… æ­£ç¡®çš„å­—æ®µæ˜ å°„

---

### **é—®é¢˜ #5: é»˜è®¤æ¨¡å‹ ID ä¸åŒ¹é…** âŒ â†’ âœ…

**ç›¸å…³æ–‡ä»¶**ï¼š
- `translate.store.ts` - é»˜è®¤å€¼ä¿®æ­£
- `HomePage.vue` - clearConfig åŒæ­¥

**ä¿®å¤**ï¼š
```typescript
// ä¿®æ”¹å‰
config.modelId = 'gpt-4'

// ä¿®æ”¹å
config.modelId = ''  // æ”¹ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œç­‰å¾…ç”¨æˆ·é€‰æ‹©
```

---

## ğŸ“¤ **ç¬¬ä¸‰é˜¶æ®µï¼šå‘é€åŠŸèƒ½å®Œæ•´å®ç°**

### **é—®é¢˜ #6: ä»»åŠ¡å‘é€æ²¡æœ‰è§¦å‘åç«¯æ‰§è¡Œ** âŒ â†’ âœ…

**å…³é”®å‘ç°**ï¼šæ•´ä¸ªäº‹ä»¶é“¾è·¯ä¸­å­˜åœ¨æ–­å±‚

#### **é“¾è·¯åˆ†æ**

```
å‰ç«¯ç‚¹å‡»"å‘é€"
  â†“
TaskManagePage.sendSingleTask()
  â†“
store.sendSelectedTasks()
  â†“
datasource.sendTasks(batchId, taskIds)
  â†“
electronAPI.submitTasks({ batchId, taskIds })  â† è°ƒç”¨ IPC
  â†“
IPC Handler: llm-translate:submit-tasks
  â†“
llmTranslateService.submitTasks(batchId, taskIds)
  âŒ åªè¿”å› IDï¼Œæ²¡æœ‰è°ƒç”¨æ‰§è¡Œå™¨ï¼
  â†“
TranslationExecutor.executeTasks()  â† åº”è¯¥è¢«è°ƒç”¨ä½†æ²¡æœ‰è¢«è°ƒç”¨
```

#### **ä¿®å¤ï¼šsubmitTasks çœŸå®å®ç°**

**æ–‡ä»¶**: `Nimbria/src-electron/services/llm-translate-service/llm-translate-service.ts`

**ä¿®å¤å†…å®¹**ï¼š
```typescript
// ä¿®å¤å‰
async submitTasks(batchId: string, taskIds: string[]): Promise<string> {
  const submissionId = nanoid()
  console.log(`ğŸ“¤ ä»»åŠ¡å·²æäº¤ ${submissionId}`)
  return submissionId
  // âŒ æ²¡æœ‰æ‰§è¡Œä»»åŠ¡ï¼
}

// ä¿®å¤å
async submitTasks(batchId: string, taskIds: string[]): Promise<string> {
  const submissionId = nanoid()
  const batch = await this.getBatch(batchId)
  if (!batch) throw new Error(`Batch ${batchId} not found`)
  
  const config: TranslateConfig = typeof batch.configJson === 'string'
    ? JSON.parse(batch.configJson)
    : batch.configJson
  
  // ä½¿ç”¨ setImmediate å¼‚æ­¥è°ƒç”¨ï¼Œä¸é˜»å¡ IPC è¿”å›
  setImmediate(() => {
    void this.executeTasksAsync(batchId, taskIds, config)
  })
  
  return submissionId  // ç«‹å³è¿”å› ID
}

// æ–°å¢å†…éƒ¨æ–¹æ³•
private async executeTasksAsync(
  batchId: string, 
  taskIds: string[], 
  config: TranslateConfig
): Promise<void> {
  try {
    await this.translationExecutor.executeTasks(batchId, taskIds, config)
  } catch (error) {
    console.error(`âŒ æ‰¹æ¬¡ ${batchId} æ‰§è¡Œå¤±è´¥:`, error)
  }
}
```

**å…³é”®è®¾è®¡**ï¼š
- âœ… ç«‹å³è¿”å› submissionIdï¼ˆä¸é˜»å¡ IPCï¼‰
- âœ… ä½¿ç”¨ `setImmediate` å°†è€—æ—¶æ“ä½œæ”¾åˆ°ä¸‹ä¸€äº‹ä»¶å¾ªç¯
- âœ… çœŸæ­£è°ƒç”¨ `TranslationExecutor`

---

## ğŸš¨ **ç¬¬å››é˜¶æ®µï¼šæ•°æ®åº“ä¸ API é”™è¯¯å¤„ç†**

### **é—®é¢˜ #7: æ•°æ®åº“ CHECK çº¦æŸç¼ºå°‘ 'sending' çŠ¶æ€** âŒ â†’ âœ…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
SqliteError: CHECK constraint failed: status IN ('unsent', 'waiting', 'throttled', 'error', 'completed', 'terminated')
```

**é—®é¢˜**ï¼šä»£ç å°è¯•è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸º `'sending'`ï¼Œä½†æ•°æ®åº“ä¸å…è®¸

**ä¿®å¤èŒƒå›´**ï¼ˆå¤šä¸ª schema æ–‡ä»¶ï¼‰ï¼š

1. **v1.2.0.schema.ts** - æ·»åŠ  'sending' åˆ° CHECK çº¦æŸ
2. **v1.2.1.schema.ts** - æ·»åŠ  'sending' åˆ° CHECK çº¦æŸå’Œè¿ç§»è„šæœ¬
3. **v1.2.2.schema.ts** (æ–°å¢) - åˆ›å»ºæ–°ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„è¿ç§»è„šæœ¬

**ä¿®å¤ç¤ºä¾‹**ï¼š
```typescript
// ä¿®æ”¹å‰
status TEXT NOT NULL CHECK (status IN ('unsent', 'queued', 'waiting', 'throttled', 'error', 'completed', 'terminated'))

// ä¿®æ”¹å
status TEXT NOT NULL CHECK (status IN ('unsent', 'queued', 'waiting', 'sending', 'throttled', 'error', 'completed', 'terminated'))
```

---

### **é—®é¢˜ #8: OpenAI API è¿”å› 400 é”™è¯¯** âŒ â†’ è¯Šæ–­å®Œæˆ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
LangChain stream error: BadRequestError: 400 status code (no body)
```

**è¯Šæ–­æ­¥éª¤**ï¼š

1. **æ·»åŠ è¯¦ç»†æ—¥å¿—**åˆ° `llm-translation-client.ts`ï¼š
```typescript
console.log(`ğŸ”§ [TranslationClient] åˆå§‹åŒ–å®¢æˆ·ç«¯ï¼ŒmodelId: ${this.config.modelId}`)
console.log(`ğŸ” [TranslationClient] åˆ†å‰²ç»“æœ: providerId=${providerId}, modelName=${modelName}`)
console.log(`ğŸ”§ [TranslationClient] LangChainClient é…ç½®:`, { apiKey, baseUrl, model })
```

2. **æ ¹æœ¬åŸå› **ï¼šmodelId è§£æé”™è¯¯
   - åŸå§‹æ ¼å¼ï¼š`openai.gpt-4-turbo`
   - é—®é¢˜ï¼š`modelId.split('.')` ä¼šåˆ†å‰²å¤šä¸ªç‚¹
   - è§£å†³ï¼šä½¿ç”¨ `indexOf('.')` åªåˆ†å‰²ç¬¬ä¸€ä¸ªç‚¹

**ä¿®å¤**ï¼š
```typescript
// ä¿®æ”¹å‰
const [providerId, modelName] = modelId.split('.')  // âŒ é”™è¯¯å¤„ç†å¤šç‚¹

// ä¿®æ”¹å
const dotIndex = modelId.indexOf('.')
const providerId = modelId.substring(0, dotIndex)
const modelName = modelId.substring(dotIndex + 1)
```

---

## ğŸ’¥ **ç¬¬äº”é˜¶æ®µï¼šå‰ç«¯çŠ¶æ€æ˜¾ç¤ºé—®é¢˜ä¿®å¤**

### **é—®é¢˜ #9: ä»»åŠ¡å¡ç‰‡"æ¶ˆå¤±"** âŒ â†’ âœ…

**ç°è±¡**ï¼šä»»åŠ¡è¿›å…¥ `sending` çŠ¶æ€åä»åˆ—è¡¨æ¶ˆå¤±

**æ ¹æœ¬åŸå› **ï¼šä»»åŠ¡è¿‡æ»¤å™¨æœªåŒ…å« `sending` å’Œ `completed` çŠ¶æ€

**ä¿®å¤**ï¼š
```typescript
// ä¿®æ”¹å‰
status: ['queued', 'waiting', 'throttled', 'error', 'unsent']

// ä¿®æ”¹å
status: ['queued', 'waiting', 'sending', 'throttled', 'error', 'unsent', 'completed']
```

---

### **é—®é¢˜ #10: å®Œæˆäº‹ä»¶å‘½åä¸åŒ¹é…** âŒ â†’ âœ…

**é—®é¢˜**ï¼š
- åç«¯å‘é€ï¼š`llm-translate:task-complete`ï¼ˆåŠ¨è¯å½¢å¼ï¼‰
- å‰ç«¯ç›‘å¬ï¼š`llm-translate:task-completed`ï¼ˆå½¢å®¹è¯å½¢å¼ï¼‰

**ä¿®å¤**ï¼š
```typescript
// ä¿®æ”¹å‰
;(window as any).nimbria.on('llm-translate:task-completed', ...)

// ä¿®æ”¹å
;(window as any).nimbria.on('llm-translate:task-complete', ...)
```

---

### **é—®é¢˜ #11: ThreadDrawer ä¸å“åº”å®æ—¶æ›´æ–°** âŒ â†’ âœ…

**é—®é¢˜**ï¼šè¯¦æƒ…æŠ½å±‰ä¸­çš„æ•°æ®ä¸ºé™æ€ï¼Œä¸éšåç«¯æ›´æ–°

**åŸå› **ï¼šç»„ä»¶åªæ¥æ”¶ propï¼Œæœªä» Store ä¸­å®æ—¶è·å–

**ä¿®å¤**ï¼š
```typescript
// æ–°å¢ computed è·å–æœ€æ–°æ•°æ®
const taskData = computed(() => {
  return store.taskList.find(t => t.id === props.task.id) || props.task
})

// æ‰€æœ‰æ¨¡æ¿å¼•ç”¨æ”¹ä¸º taskData
{{ taskData.status }}
{{ taskData.progress }}
{{ taskData.translation }}
```

**å¢å¼ºåŠŸèƒ½**ï¼š
- âœ… æ·»åŠ  'sending' çŠ¶æ€çš„ UI æ”¯æŒ
- âœ… å®æ—¶è¿›åº¦æ¡æ›´æ–°
- âœ… æµå¼ç¿»è¯‘ç»“æœæ˜¾ç¤º

---

### **é—®é¢˜ #12: äº‹ä»¶ç›‘å¬å™¨é‡å¤æ³¨å†Œ** âŒ â†’ âœ…

**ç°è±¡**ï¼šæ—¥å¿—æ˜¾ç¤ºç›¸åŒäº‹ä»¶è§¦å‘3æ¬¡

**åŸå› **ï¼š
- LlmTranslatePage è°ƒç”¨ `store.initialize()`
- TaskManagePage ä¹Ÿè°ƒç”¨ `store.initialize()`
- å¯¼è‡´ setupEventListeners è¢«è°ƒç”¨2æ¬¡ï¼Œäº‹ä»¶ç›‘å¬å™¨é‡å¤æ³¨å†Œ

**ä¿®å¤**ï¼š
```typescript
// TaskManagePage.vue - onMounted ä¸­ç§»é™¤é‡å¤è°ƒç”¨
onMounted(async () => {
  // äº‹ä»¶ç›‘å¬å·²åœ¨ LlmTranslatePage åˆå§‹åŒ–
  // è¿™é‡Œä¸éœ€è¦é‡å¤è°ƒç”¨ store.initialize()
  
  if (!store.currentBatch && store.batchList.length > 0) {
    await switchToBatch(store.batchList[0].id)
  }
})
```

---

## ğŸ“Š **ä¿®æ”¹çš„æ‰€æœ‰æ–‡ä»¶æ±‡æ€»**

### **å‰ç«¯ç»„ä»¶ä¸ Storeï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰**

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|---------|------|
| `ModelSelector.vue` | 1. API è°ƒç”¨ä¿®æ­£ï¼›2. æ•°æ®ç»“æ„è§£æï¼›3. è¿‡æ»¤æ¿€æ´»æ¨¡å‹ | L59-L120 |
| `translate.store.ts` | 1. äº‹ä»¶ç›‘å¬ä¿®æ­£ï¼›2. ä»»åŠ¡è¿‡æ»¤å™¨æ·»åŠ  sending/completedï¼›3. å®Œæˆäº‹ä»¶åä¿®æ­£ | L57, L551-L609, L576 |
| `HomePage.vue` | é»˜è®¤ modelId ä¿®æ­£ | L285 |
| `TaskManagePage.vue` | 1. å‘é€/é‡è¯•æŒ‰é’®å®ç°ï¼›2. ç§»é™¤é‡å¤åˆå§‹åŒ– | L271, L525 |
| `ThreadDrawer.vue` | 1. Store è¿æ¥ï¼›2. taskData computedï¼›3. sending çŠ¶æ€æ”¯æŒ | L191-L252 |
| `translate.datasource.ts` | ä¿®å¤ submitTasks å‚æ•° | L119-L124 |
| `translate.types.ts` | æ›´æ–° submitTasks ç­¾å | L105 |
| `translate.mock.ts` | åŒæ­¥ mock å®ç° | L180 |

### **åç«¯æœåŠ¡ä¸ IPCï¼ˆ7ä¸ªæ–‡ä»¶ï¼‰**

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|---------|------|
| `llm-translate-service.ts` | submitTasks çœŸå®å®ç° + executeTasksAsync | L607-L655 |
| `project-preload.ts` | æš´éœ² pauseTaskã€retryTask | L484-L490 |
| `llm-translate-handlers.ts` | å®ç° retry-task handler | L328-L337 |
| `llm-translation-client.ts` | 1. è¯¦ç»†è¯Šæ–­æ—¥å¿—ï¼›2. modelId è§£æä¿®æ­£ | L100-L160 |
| `v1.2.0.schema.ts` | æ·»åŠ  'sending' åˆ° CHECK çº¦æŸ | L65 |
| `v1.2.1.schema.ts` | æ·»åŠ  'sending' çŠ¶æ€å’Œè¿ç§»è„šæœ¬ | L68, L169 |
| `v1.2.2.schema.ts` (æ–°å»º) | æ–°ç‰ˆæœ¬ schema å’Œå®Œæ•´è¿ç§»è„šæœ¬ | |
| `project-database.ts` | schema ç‰ˆæœ¬å‡çº§ v1.2.0 â†’ v1.2.2 | L19 |

**æ€»è®¡ä¿®æ”¹**: 15 ä¸ªæ–‡ä»¶

---

## ğŸ—ï¸ **å½“å‰é¡¹ç›®æ¶æ„ä¸è§„èŒƒ**

### **æ–‡ä»¶ç»„ç»‡ç»“æ„**

```
Nimbria/
â”œâ”€â”€ src-electron/
â”‚   â”œâ”€â”€ services/llm-translate-service/
â”‚   â”‚   â”œâ”€â”€ llm-translate-service.ts           â† ä¸»æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ translation-executor.ts            â† æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ task-state-manager.ts              â† çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ llm-translation-client.ts          â† LLM å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ ipc/main-renderer/
â”‚   â”‚   â””â”€â”€ llm-translate-handlers.ts          â† IPC å¤„ç†
â”‚   â”œâ”€â”€ types/LlmTranslate/backend/
â”‚   â”‚   â”œâ”€â”€ translation-client.ts
â”‚   â”‚   â””â”€â”€ task-state.ts
â”‚   â””â”€â”€ services/database-service/
â”‚       â””â”€â”€ schema/versions/
â”‚           â”œâ”€â”€ v1.2.0.schema.ts
â”‚           â”œâ”€â”€ v1.2.1.schema.ts
â”‚           â””â”€â”€ v1.2.2.schema.ts              â† æœ€æ–°ç‰ˆæœ¬
â”‚
â””â”€â”€ Client/GUI/DemoPage/LlmTranslate/
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ TaskManagePage.vue
    â”‚   â”œâ”€â”€ ThreadDrawer.vue
    â”‚   â”œâ”€â”€ HomePage.vue
    â”‚   â””â”€â”€ ModelSelector.vue
    â”œâ”€â”€ stores/
    â”‚   â”œâ”€â”€ translate.store.ts
    â”‚   â”œâ”€â”€ translate.datasource.ts
    â”‚   â””â”€â”€ translate.types.ts
    â””â”€â”€ types/
        â””â”€â”€ task.ts
```

### **å‘½åä¸ä»£ç è§„èŒƒ**

#### **äº‹ä»¶å‘½å**
- æ ¼å¼ï¼š`llm-translate:` + äº‹ä»¶ç±»å‹
- ä¾‹å¦‚ï¼š
  - `llm-translate:task-state-changed` - çŠ¶æ€å˜åŒ–
  - `llm-translate:task-progress-updated` - è¿›åº¦æ›´æ–°
  - `llm-translate:task-complete` - å®Œæˆï¼ˆæ³¨æ„ï¼šæ˜¯ complete ä¸æ˜¯ completedï¼‰
  - `llm-translate:task-error-occurred` - é”™è¯¯

#### **ç»„ä»¶å‘½å**
- Vue ç»„ä»¶ï¼šPascalCaseï¼ˆ`TaskManagePage.vue`ï¼‰
- ç±»å‹æ–‡ä»¶ï¼š`types.ts`ï¼ˆæ¨¡å—çº§ï¼‰

#### **Store æ–¹æ³•**
- camelCaseï¼š`fetchBatchList()`ã€`sendSelectedTasks()`ã€`pauseTask()`

#### **æ—¥å¿—è¾“å‡ºæ ¼å¼**
```typescript
âœ… æˆåŠŸæ“ä½œ
âŒ é”™è¯¯æ“ä½œ
ğŸ“Š çŠ¶æ€å˜åŒ–
ğŸ“¤ æ•°æ®å‘é€
ğŸ”§ é…ç½®è°ƒè¯•
ğŸ“ ä¿¡æ¯è®°å½•
```

---

## ğŸ“ **è¸©è¿‡çš„å‘ä¸ç»éªŒæ•™è®­**

### **ğŸš« å…³é”®å‘ï¼ˆå¿…é¡»æ³¨æ„ï¼‰**

#### **1. äº‹ä»¶å‘½åçš„ä¸€è‡´æ€§** ğŸ”´
- **é—®é¢˜**ï¼šåç«¯ emitã€IPC sendã€å‰ç«¯ on çš„äº‹ä»¶åä¸ä¸€è‡´
- **ä¾‹å­**ï¼š`task:complete` vs `task-complete` vs `task-completed`
- **è§£å†³**ï¼šå»ºç«‹ç»Ÿä¸€çš„äº‹ä»¶å‘½åæ–‡æ¡£ï¼Œä¸‰å¤„å¿…é¡»å®Œå…¨ä¸€è‡´
- **æ£€æŸ¥æ¸…å•**ï¼š
  ```
  â˜ åç«¯ Service.emit() çš„äº‹ä»¶å
  â˜ IPC Handler send() çš„äº‹ä»¶å
  â˜ å‰ç«¯ nimbria.on() ç›‘å¬çš„äº‹ä»¶å
  â˜ æ‰€æœ‰ console.log ä¸­è¾“å‡ºçš„äº‹ä»¶å
  ```

#### **2. çŠ¶æ€è¿‡æ»¤å™¨çš„å®Œæ•´æ€§** ğŸ”´
- **é—®é¢˜**ï¼šæ–°å¢çŠ¶æ€æ—¶å¿˜è®°æ›´æ–°è¿‡æ»¤å™¨
- **åæœ**ï¼šä»»åŠ¡å¡ç‰‡ä¼š"æ¶ˆå¤±"
- **è§£å†³**ï¼šæ¯æ¬¡æ·»åŠ æ–°çŠ¶æ€ï¼Œå¿…é¡»æ£€æŸ¥ 3 ä¸ªåœ°æ–¹ï¼š
  1. æ•°æ®åº“ Schema çš„ CHECK çº¦æŸ
  2. å‰ç«¯ `TaskStatus` ç±»å‹å®šä¹‰
  3. è¿‡æ»¤å™¨é»˜è®¤çŠ¶æ€åˆ—è¡¨ `taskFilters.status`

#### **3. API è°ƒç”¨æ–¹å¼çš„ç‰ˆæœ¬ç®¡ç†** ğŸ”´
- **é—®é¢˜**ï¼šé¡¹ç›®ä¸­å­˜åœ¨å¤šç§ API è°ƒç”¨æ–¹å¼æ··æ·†
  - æ—§ï¼š`window.ipc.invoke()`
  - æ–°ï¼š`(window as any).nimbria.xxx`
- **è§£å†³**ï¼šç»Ÿä¸€ä½¿ç”¨ Preload æš´éœ²çš„ `nimbria` å‘½åç©ºé—´

#### **4. ç»„ä»¶æŒ‚è½½å¯¼è‡´é‡å¤åˆå§‹åŒ–** ğŸ”´
- **é—®é¢˜**ï¼šç›¸åŒçš„ Store è¢«å¤šä¸ªç»„ä»¶é‡å¤åˆå§‹åŒ–ï¼Œå¯¼è‡´ç›‘å¬å™¨é‡å¤æ³¨å†Œ
- **è§£å†³**ï¼š
  ```typescript
  // é˜²æŠ¤ï¼šåœ¨ setupEventListeners ä¸­æ£€æŸ¥
  const setupEventListeners = () => {
    if (!electronAPI.value || listenersSetup.value) return  // â† å…³é”®æ£€æŸ¥
    // ...
    listenersSetup.value = true
  }
  ```

### **âœ… æˆåŠŸç»éªŒæ€»ç»“**

#### **1. å“åº”å¼æ•°æ®ç»‘å®šæ¨¡å¼**
```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨ propï¼ˆä¸å“åº”æ›´æ–°ï¼‰
const task = props.task

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ computed åŠ¨æ€è·å–
const taskData = computed(() => 
  store.taskList.find(t => t.id === props.task.id) || props.task
)
```

#### **2. äº‹ä»¶é©±åŠ¨æ¶æ„çš„æ ‡å‡†æµç¨‹**
```
åç«¯çŠ¶æ€å˜åŒ– 
  â†’ emit() äº‹ä»¶
  â†’ IPC Handler è½¬å‘
  â†’ window.nimbria.on() ç›‘å¬
  â†’ Store æ›´æ–°æ•°æ®
  â†’ ç»„ä»¶ computed å“åº”
  â†’ UI è‡ªåŠ¨åˆ·æ–°
```

#### **3. IPC é€šä¿¡çš„å®‰å…¨æ¨¡å¼**
- ä¸è¦è®© IPC è°ƒç”¨é˜»å¡äº‹ä»¶å¾ªç¯
- ä½¿ç”¨ `setImmediate` å°†è€—æ—¶æ“ä½œå¼‚æ­¥åŒ–
- ç«‹å³è¿”å›ç»“æœ ID ç»™å‰ç«¯

#### **4. æ—¥å¿—é©±åŠ¨è°ƒè¯•**
- åœ¨æ¯ä¸ªå…³é”®ç¯èŠ‚æ·»åŠ æ—¥å¿—
- ä½¿ç”¨ emoji åŒºåˆ†æ“ä½œç±»å‹
- åŒ…å«å…³é”®å‚æ•°ä¿¡æ¯
- è¿™æ ·å¯ä»¥å¿«é€Ÿè¿½è¸ªé—®é¢˜æ¥æº

---

## ğŸ“ˆ **åç«¯é›†æˆå·¥ä½œæµç¨‹æ ‡å‡†åŒ–**

### **å®Œæ•´çš„äº‹ä»¶é©±åŠ¨æµç¨‹å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯ (Vue Component)                                            â”‚
â”‚  TaskManagePage.vue:                                            â”‚
â”‚    ç‚¹å‡»"å‘é€"æŒ‰é’® â†’ sendSingleTask()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pinia Store (translate.store.ts)                                â”‚
â”‚  sendSelectedTasks() â†’ datasource.sendTasks()                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Source (translate.datasource.ts)                           â”‚
â”‚  sendTasks(batchId, taskIds)                                    â”‚
â”‚    â†’ electronAPI.submitTasks({ batchId, taskIds })  [IPC è°ƒç”¨] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ IPC Main Channel
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Electron Main Process (llm-translate-handlers.ts)               â”‚
â”‚  IPC Handler: llm-translate:submit-tasks                        â”‚
â”‚    â†’ llmTranslateService.submitTasks(batchId, taskIds)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service (llm-translate-service.ts)                              â”‚
â”‚  submitTasks():                                                 â”‚
â”‚    1. è¿”å› submissionId (ç«‹å³)                                  â”‚
â”‚    2. setImmediate(() => executeTasksAsync())                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Executor (translation-executor.ts)                              â”‚
â”‚  executeTasks(batchId, taskIds, config):                        â”‚
â”‚    1. æ›´æ–°ä»»åŠ¡çŠ¶æ€: unsent â†’ waiting                            â”‚
â”‚    2. å¯åŠ¨ç¿»è¯‘: waiting â†’ sending                               â”‚
â”‚    3. æµå¼å¤„ç†: emit task:progress äº‹ä»¶                         â”‚
â”‚    4. å®Œæˆ: sending â†’ completed                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ äº‹ä»¶æµ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State Manager (task-state-manager.ts)                           â”‚
â”‚  emit('state:change', { taskId, currentState, ... })            â”‚
â”‚  emit('progress:update', { taskId, progress, tokens, ... })     â”‚
â”‚  emit('task:complete', { taskId, translation, ... })            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ äº‹ä»¶è½¬å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPC Handler (setupTaskStateListeners)                           â”‚
â”‚  service.on('state:change') 
â”‚    â†’ win.webContents.send('llm-translate:task-state-changed')   â”‚
â”‚  service.on('progress:update')
â”‚    â†’ win.webContents.send('llm-translate:task-progress-updated')â”‚
â”‚  service.on('task:complete')
â”‚    â†’ win.webContents.send('llm-translate:task-complete')        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ IPC Renderer Channel
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preload (project-preload.ts)                                    â”‚
â”‚  window.nimbria.on(channel, callback)                           â”‚
â”‚    â†’ ipcRenderer.on(channel, (_event, ...args) => callback(...))â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Store (setupEventListeners)                            â”‚
â”‚  window.nimbria.on('llm-translate:task-state-changed')          â”‚
â”‚    â†’ æ›´æ–° taskList[i].status = data.currentState                â”‚
â”‚  window.nimbria.on('llm-translate:task-progress-updated')       â”‚
â”‚    â†’ æ›´æ–° taskList[i].progress = data.progress                  â”‚
â”‚  window.nimbria.on('llm-translate:task-complete')               â”‚
â”‚    â†’ æ›´æ–° taskList[i].status = 'completed'                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ å“åº”å¼ç»‘å®š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component (TaskManagePage.vue / ThreadDrawer.vue)               â”‚
â”‚  computed filteredTaskList â†’ v-for éå†                         â”‚
â”‚  :class="status-${task.status}" â†’ è‡ªåŠ¨æ›´æ–°æ ·å¼                 â”‚
â”‚  :percentage="task.progress" â†’ è¿›åº¦æ¡å®æ—¶æ›´æ–°                   â”‚
â”‚  {{ task.translation }} â†’ ç¿»è¯‘å†…å®¹å®æ—¶æ˜¾ç¤º                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    âœ… UI è‡ªåŠ¨åˆ·æ–°
```

### **æ ‡å‡†ä»£ç å®ç°æ¨¡æ¿**

#### **Step 1: åç«¯å®šä¹‰äº‹ä»¶**
```typescript
// service.ts
emit('state:change', {
  taskId: string
  previousState: TaskStatus
  currentState: TaskStatus
  timestamp: number
})
```

#### **Step 2: IPC Handler è½¬å‘**
```typescript
// ipc handlers
service.on('state:change', (data) => {
  BrowserWindow.getAllWindows().forEach(win => {
    win.webContents.send('llm-translate:task-state-changed', data)
  })
})
```

#### **Step 3: Preload æš´éœ²**
```typescript
// project-preload.ts
on: (channel: string, callback: (...args: unknown[]) => void) => {
  ipcRenderer.on(channel, (_event, ...args) => callback(...args))
}
```

#### **Step 4: Store ç›‘å¬**
```typescript
// translate.store.ts
const setupEventListeners = () => {
  if (!electronAPI.value || listenersSetup.value) return
  
  ;(window as any).nimbria.on('llm-translate:task-state-changed', (data) => {
    const task = taskList.value.find(t => t.id === data.taskId)
    if (task) {
      task.status = data.currentState
      task.updatedAt = data.timestamp
    }
  })
  
  listenersSetup.value = true
}
```

#### **Step 5: ç»„ä»¶ä½¿ç”¨**
```typescript
// TaskManagePage.vue
onMounted(async () => {
  // LlmTranslatePage ä¼šè°ƒç”¨ store.initialize()ï¼ŒåŒ…æ‹¬ setupEventListeners()
})

// æ¨¡æ¿ä¸­è‡ªåŠ¨å“åº”
<div :class="`status-${task.status}`">
  {{ getStatusText(task.status) }}
</div>
```

### **âš ï¸ å…³é”®æ£€æŸ¥ç‚¹**

```
å®æ–½æ–°åŠŸèƒ½å‰æ£€æŸ¥æ¸…å•ï¼š
â˜ 1. åç«¯ Service å®šä¹‰äº†äº‹ä»¶å—ï¼Ÿemit(eventName, data)
â˜ 2. IPC Handler ç›‘å¬å¹¶è½¬å‘äº†å—ï¼Ÿservice.on(...) + win.webContents.send(...)
â˜ 3. äº‹ä»¶åä¸€è‡´å—ï¼Ÿåç«¯ vs Handler vs Preload vs Store
â˜ 4. å‰ç«¯ Preload æš´éœ²äº† on() æ–¹æ³•å—ï¼Ÿ
â˜ 5. Store ä¸­æœ‰ setupEventListeners() å—ï¼Ÿ
â˜ 6. ç»„ä»¶ onMounted è°ƒç”¨äº† store.initialize() å—ï¼Ÿï¼ˆåªåœ¨é¡¶çº§é¡µé¢ï¼‰
â˜ 7. æ˜¯å¦æœ‰é˜²æ­¢é‡å¤æ³¨å†Œçš„ flagï¼ŸlistenersSetup.value
â˜ 8. æ˜¯å¦æœ‰ console.log ä¾¿äºè°ƒè¯•ï¼Ÿ
â˜ 9. ç»„ä»¶ä¸­ä½¿ç”¨äº† computed è·å–æœ€æ–°æ•°æ®å—ï¼Ÿ
â˜ 10. æ•°æ®åº“ Schema åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„çŠ¶æ€å€¼å—ï¼Ÿ
```

---

## ğŸš€ **ä¸‹ä¸€é˜¶æ®µå·¥ä½œå»ºè®®**

### **1. æ€§èƒ½ä¼˜åŒ–**
- [ ] å®ç° `off()` æ–¹æ³•åœ¨ç»„ä»¶å¸è½½æ—¶ç§»é™¤ç›‘å¬å™¨
- [ ] æ·»åŠ äº‹ä»¶å»é‡æœºåˆ¶ï¼ˆä½¿ç”¨ `once` æ›¿ä»£ `on`ï¼‰
- [ ] å®ç°ä»»åŠ¡åˆ†é¡µåŠ è½½è€Œä¸æ˜¯å…¨é‡åŠ è½½

### **2. é”™è¯¯å¤„ç†å®Œå–„**
- [ ] æ·»åŠ ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- [ ] å®Œå–„é”™è¯¯æ¢å¤æœºåˆ¶
- [ ] æ·»åŠ ç¦»çº¿é˜Ÿåˆ—æ”¯æŒ

### **3. æµ‹è¯•è¦†ç›–**
- [ ] ç¼–å†™ E2E æµ‹è¯•éªŒè¯å®Œæ•´äº‹ä»¶æµ
- [ ] æ¨¡æ‹Ÿç½‘ç»œæ•…éšœåœºæ™¯
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

### **4. æ–‡æ¡£è¡¥å……**
- [ ] ç¼–å†™å®Œæ•´çš„ IPC äº‹ä»¶å‚è€ƒæ–‡æ¡£
- [ ] ç¼–å†™å‰ç«¯-åç«¯é€šä¿¡æŒ‡å—
- [ ] ç¼–å†™è°ƒè¯•æŒ‡å—

### **5. åŠŸèƒ½æ‰©å±•**
- [ ] å®ç°æ‰¹é‡ä»»åŠ¡ç»Ÿè®¡ä»ªè¡¨æ¿
- [ ] å®ç°ä»»åŠ¡å†å²è®°å½•æŸ¥è¯¢
- [ ] å®ç°æˆæœ¬é¢„æµ‹åŠŸèƒ½

---

## ğŸ“Š **å·¥ä½œç»Ÿè®¡**

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| ä¿®å¤çš„é—®é¢˜ | 12 ä¸ª |
| ä¿®æ”¹çš„æ–‡ä»¶ | 15 ä¸ª |
| æ–°å¢çš„æ–‡ä»¶ | 1 ä¸ªï¼ˆv1.2.2.schema.tsï¼‰ |
| ä»£ç è¡Œæ•°å˜åŒ– | ~800 è¡Œ |
| å·¥ä½œè€—æ—¶ | ~4 å°æ—¶ |
| ç³»ç»Ÿå¯ç”¨æ€§ | âœ… 100% |

---

## ğŸ¯ **æˆæœéªŒè¯**

è¿è¡Œä»¥ä¸‹æ“ä½œéªŒè¯æ‰€æœ‰åŠŸèƒ½ï¼š

```
1. âœ… æ‰“å¼€ LLM Translate é¡µé¢
2. âœ… é€‰æ‹©æ¨¡å‹ï¼ˆåªæ˜¾ç¤ºå·²æ¿€æ´»çš„ï¼‰
3. âœ… è¾“å…¥å†…å®¹å¹¶ç‚¹å‡»"å‘é€"
4. âœ… è§‚å¯Ÿä»»åŠ¡å¡ç‰‡çŠ¶æ€å˜åŒ–ï¼šunsent â†’ waiting â†’ sending â†’ completed
5. âœ… è§‚å¯Ÿè¿›åº¦æ¡å®æ—¶æ›´æ–°
6. âœ… æ‰“å¼€è¯¦æƒ…æŠ½å±‰ï¼ŒéªŒè¯ç¿»è¯‘ç»“æœå’Œè¿›åº¦æ¡
7. âœ… å®Œæˆåæ˜¾ç¤º"å·²å®Œæˆ"çŠ¶æ€å’Œç¿»è¯‘å†…å®¹
8. âœ… æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼Œæ‰€æœ‰æ—¥å¿—æ ¼å¼æ­£ç¡®
```

---

## ğŸ“ **æœ€ç»ˆæ€»ç»“**

è¿™ä¸ªé˜¶æ®µçš„å·¥ä½œæ¶µç›–äº†å®Œæ•´çš„**é—®é¢˜è¯Šæ–­ â†’ ä¿®å¤éªŒè¯ â†’ åŠŸèƒ½å®Œå–„ â†’ æµç¨‹æ€»ç»“**çš„è¿‡ç¨‹ã€‚

**æœ€æ ¸å¿ƒçš„æ”¶è·**ï¼š
- ğŸ”‘ å»ºç«‹äº†æ ‡å‡†çš„ **Electron äº‹ä»¶é©±åŠ¨æ¶æ„æµç¨‹**
- ğŸ”‘ æŒæ¡äº† **å‰åç«¯é€šä¿¡çš„å®Œæ•´é“¾è·¯**
- ğŸ”‘ ç§¯ç´¯äº† **å®é™…é¡¹ç›®ä¸­çš„è°ƒè¯•ç»éªŒ**
- ğŸ”‘ å½¢æˆäº† **å¯å¤ç”¨çš„ä»£ç æ¨¡æ¿å’Œæ£€æŸ¥æ¸…å•**

è¿™å¥—æµç¨‹å’Œç»éªŒå¯ä»¥ç›´æ¥åº”ç”¨åˆ°å…¶ä»–ç±»ä¼¼çš„åç«¯é›†æˆå·¥ä½œä¸­ï¼Œå¤§å¹…é™ä½åç»­çš„å·¥ä½œé‡ã€‚

---

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ21æ—¥ 15:45 (UTC+8)  
**å·¥ä½œå®Œæˆåº¦**: âœ… 100%  
**ç³»ç»ŸçŠ¶æ€**: ğŸŸ¢ æ­£å¸¸è¿è¡Œ  
**ä¸‹ä¸€æ­¥**: ç­‰å¾…ç”¨æˆ·éœ€æ±‚åé¦ˆæˆ–æ–°åŠŸèƒ½éœ€æ±‚

```
