# Nimbria æ¶æ„è®¾è®¡æ€»è§ˆ (v2.0 - 2025-10-11)

æœ¬æ–‡æ¡£æ—¨åœ¨æä¾› Nimbria é¡¹ç›®å½“å‰æŠ€æœ¯æ¶æ„çš„å¿«ç…§ï¼Œåæ˜ æˆªè‡³ `2025-10-11` çš„å®é™…ä»£ç ç»„ç»‡æƒ…å†µã€‚

## ğŸ—ï¸ Client/ å‰ç«¯æ¶æ„

### ğŸ“ ç›®å½•ç»“æ„

```
Client/
â”œâ”€â”€ GUI/                                    # ç•Œé¢å±‚ (Vue Components)
â”‚   â”œâ”€â”€ components/                         # ä¸šåŠ¡ç»„ä»¶ (æŒ‰é¡µé¢/åŠŸèƒ½ç»„ç»‡)
â”‚   â”‚   â”œâ”€â”€ HomeDashboardPage/              # ä¸»é¡µç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ProjectManagement/              # é¡¹ç›®ç®¡ç†å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ ProjectPage.MainPanel/          # é¡¹ç›®é¡µ - ä¸»é¢æ¿ç»„ä»¶ (Markdown, Pane)
â”‚   â”‚   â”œâ”€â”€ ProjectPage.Shell/              # é¡¹ç›®é¡µ - å¤–å£³ç»„ä»¶ (æ–‡ä»¶æ ‘, å³ä¾§æ , å‘½ä»¤é¢æ¿)
â”‚   â”‚   â””â”€â”€ Shared/                         # è·¨é¡µé¢å…±äº«ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ PagesLayout/                        # é¡µé¢çº§ç»„ä»¶ (è´Ÿè´£è§†è§‰æ ·å¼å’Œå¸ƒå±€)
â”‚   â”‚   â”œâ”€â”€ HomeDashboardPage.vue
â”‚   â”‚   â”œâ”€â”€ ProjectPage.MainPanel.vue
â”‚   â”‚   â”œâ”€â”€ ProjectPage.Shell.vue
â”‚   â”‚   â””â”€â”€ ProjectPage.DetachedPage.vue    # æ‹†åˆ†å‡ºçš„ç‹¬ç«‹çª—å£é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/                            # é¡¶å±‚å¸ƒå±€ (è´Ÿè´£Flexç»“æ„å’Œè·¯ç”±è§†å›¾)
â”‚   â”‚   â”œâ”€â”€ MainLayout.vue                  # ä¸»çª—å£å¸ƒå±€
â”‚   â”‚   â””â”€â”€ ProjectMainLayout.vue           # é¡¹ç›®çª—å£å¸ƒå±€
â”‚   â”‚
â”‚   â”œâ”€â”€ Index/                              # ç³»ç»Ÿå…¥å£ (ä¸åŒçª—å£ç¯å¢ƒçš„æ ¹ç»„ä»¶)
â”‚   â”‚   â”œâ”€â”€ HomeSystem.vue
â”‚   â”‚   â””â”€â”€ ProjectPageSystem.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                             # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ assets/                             # å…¨å±€é™æ€èµ„æº
â”‚   â””â”€â”€ App.vue                             # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ Service/                                # æœåŠ¡ API å±‚ (å°è£…é«˜çº§åŠŸèƒ½è°ƒç”¨)
â”‚   â”œâ”€â”€ CommandPanelRightSidebar/           # å‘½ä»¤é¢æ¿ä¸å³ä¾§æ  API
â”‚   â”‚   â”œâ”€â”€ command.api.ts
â”‚   â”‚   â””â”€â”€ rightSidebar.api.ts
â”‚   â””â”€â”€ ProjectManagement/                  # é¡¹ç›®ç®¡ç†æœåŠ¡
â”‚       â””â”€â”€ ProjectService.ts
â”‚
â”œâ”€â”€ stores/                                 # çŠ¶æ€ç®¡ç† (Pinia)
â”‚   â”œâ”€â”€ home/                               # ä¸»é¡µçŠ¶æ€
â”‚   â”œâ”€â”€ project/                            # é¡¹ç›®çš„åˆ›å»ºã€æ‰“å¼€ã€éªŒè¯å’Œæœ€è¿‘é¡¹ç›®åˆ—è¡¨
â”‚   â”œâ”€â”€ projectPage/                        # â­ é¡¹ç›®é¡µæ ¸å¿ƒçŠ¶æ€æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ commandPalette/                 #   - å‘½ä»¤é¢æ¿
â”‚   â”‚   â”œâ”€â”€ Markdown/                       #   - Markdown ç¼–è¾‘ä¸æ–‡ä»¶æ ‘
â”‚   â”‚   â”œâ”€â”€ paneLayout/                     #   - Pane åˆ†å±å¸ƒå±€
â”‚   â”‚   â””â”€â”€ rightSidebar/                   #   - å³ä¾§æ 
â”‚   â”œâ”€â”€ settings/                           # è®¾ç½®çŠ¶æ€
â”‚   â””â”€â”€ index.ts                            # Store å…¥å£
â”‚
â”œâ”€â”€ Utils/                                  # å·¥å…·å‡½æ•°ä¸æ’ä»¶
â”‚   â””â”€â”€ Plugins/                            # æ’ä»¶åŒ–ç³»ç»Ÿ
â”‚       â”œâ”€â”€ commands/                       #   - å‘½ä»¤æ’ä»¶
â”‚       â””â”€â”€ panels/                         #   - å³ä¾§æ é¢æ¿æ’ä»¶
â”‚
â””â”€â”€ boot/                                   # Quasar å¯åŠ¨æ–‡ä»¶
```

### ğŸ—‚ï¸ stores/ çŠ¶æ€ç®¡ç†æ¨¡å—

| æ¨¡å—              | ä¸»è¦èŒè´£                                       |
| ----------------- | ---------------------------------------------- |
| `home`            | ä¸»çª—å£ä»ªè¡¨ç›˜çš„æ•°æ®ä¸çŠ¶æ€                       |
| `project`         | é¡¹ç›®çš„åˆ›å»ºã€æ‰“å¼€ã€éªŒè¯å’Œæœ€è¿‘é¡¹ç›®åˆ—è¡¨           |
| `projectPage`     | **é¡¹ç›®çª—å£çš„æ ¸å¿ƒçŠ¶æ€**                         |
| â”œ `commandPalette` | å‘½ä»¤é¢æ¿çš„çŠ¶æ€ã€å‘½ä»¤æ³¨å†Œä¸è¿‡æ»¤                 |
| â”œ `Markdown`      | æ–‡ä»¶æ ‘ã€æ‰“å¼€çš„æ ‡ç­¾é¡µã€è‡ªåŠ¨ä¿å­˜ã€æ–‡ä»¶æ“ä½œ         |
| â”œ `paneLayout`    | Pane åˆ†å±çš„æ ‘çŠ¶ç»“æ„ã€ç„¦ç‚¹ç®¡ç†ã€åˆ†å±æ“ä½œ        |
| â”œ `rightSidebar`  | å³ä¾§æ çš„é¢æ¿æ³¨å†Œã€æ¿€æ´»çŠ¶æ€ã€å¯è§æ€§             |
| `settings`        | è®¾ç½®å¯¹è¯æ¡†çŠ¶æ€ï¼Œç¼“å­˜ç®¡ç†                       |

### ğŸ“ Service/ æœåŠ¡ API å±‚

| æ¨¡å—                       | ä¸»è¦èŒè´£                                                     |
| -------------------------- | ------------------------------------------------------------ |
| `CommandPanelRightSidebar` | æä¾› `commandApi` å’Œ `rightSidebarApi`ï¼Œå°è£…å¯¹ Store çš„å¤æ‚æ“ä½œï¼Œä¾›æ’ä»¶ç³»ç»Ÿè°ƒç”¨ã€‚ |
| `ProjectManagement`        | å°è£…é¡¹ç›®åˆ›å»ºã€æ‰“å¼€ç­‰æµç¨‹ï¼Œå¤„ç†ä¸åç«¯ `project-service` çš„ IPC é€šä¿¡ã€‚ |

## âš™ï¸ src-electron/ ä¸»è¿›ç¨‹æ¶æ„

### ğŸ“ ç›®å½•ç»“æ„

```
src-electron/
â”œâ”€â”€ core/                           # æ ¸å¿ƒä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ app-manager.ts              # âœ… åº”ç”¨æ ¸å¿ƒç®¡ç†å™¨ (ç”Ÿå‘½å‘¨æœŸ, IPCæ³¨å†Œä¸­å¿ƒ)
â”‚   â”œâ”€â”€ electron-main.ts            # ä¸»è¿›ç¨‹å…¥å£
â”‚   â”œâ”€â”€ main-preload.ts             # ä¸»çª—å£é¢„åŠ è½½è„šæœ¬
â”‚   â””â”€â”€ project-preload.ts          # é¡¹ç›®çª—å£é¢„åŠ è½½è„šæœ¬
â”‚
â”œâ”€â”€ services/                       # æŒç»­è¿è¡Œçš„æœåŠ¡
â”‚   â”œâ”€â”€ file-service/               # âœ… æ–‡ä»¶ç³»ç»ŸæœåŠ¡ (è¯»ã€å†™ã€ç›‘å¬)
â”‚   â”œâ”€â”€ markdown-service/           # âœ… Markdownä¸“é¡¹æœåŠ¡ (æ‰«æ, è¯»å†™é˜Ÿåˆ—, å¤‡ä»½)
â”‚   â”œâ”€â”€ project-service/            # âœ… é¡¹ç›®ç®¡ç†æœåŠ¡ (åˆ›å»º, éªŒè¯, åˆå§‹åŒ–)
â”‚   â””â”€â”€ window-service/             # âœ… çª—å£ç®¡ç†æœåŠ¡ (å¤šçª—å£/è¿›ç¨‹ç®¡ç†)
â”‚
â”œâ”€â”€ ipc/                            # è¿›ç¨‹é—´é€šä¿¡
â”‚   â””â”€â”€ main-renderer/              # ä¸»è¿›ç¨‹-æ¸²æŸ“è¿›ç¨‹é€šä¿¡
â”‚       â”œâ”€â”€ channel-definitions.ts  # IPC é€šé“ç±»å‹å®šä¹‰ (åºŸå¼ƒ, è§ types/ipc.ts)
â”‚       â”œâ”€â”€ file-handlers.ts        # æ–‡ä»¶æ“ä½œ IPC å¤„ç†å™¨
â”‚       â”œâ”€â”€ markdown-handlers.ts    # Markdown æ“ä½œ IPC å¤„ç†å™¨
â”‚       â””â”€â”€ ipc-handlers.ts         # å…¶ä»– IPC å¤„ç†å™¨
â”‚
â”œâ”€â”€ store/                          # æŒä¹…åŒ–å­˜å‚¨
â”‚   â””â”€â”€ recent-projects-store.ts    # `electron-store` å°è£…
â”‚
â”œâ”€â”€ types/                          # ä¸»è¿›ç¨‹ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ipc.ts                      # âœ… å…¨å±€ IPC é€šé“ç±»å‹æ˜ å°„
â”‚   â”œâ”€â”€ process.ts                  # è¿›ç¨‹ã€çª—å£ç›¸å…³ç±»å‹
â”‚   â””â”€â”€ window.ts                   # çª—å£æ¨¡æ¿ã€é…ç½®ç±»å‹
â”‚
â””â”€â”€ utils/                          # å·¥å…·å‡½æ•°
```

### ğŸ”§æ ¸å¿ƒæœåŠ¡æ¨¡å—

| æœåŠ¡æ¨¡å—           | ä¸»è¦èŒè´£                                                     |
| ------------------ | ------------------------------------------------------------ |
| `file-service`     | é€šç”¨çš„æ–‡ä»¶æ“ä½œï¼ˆè¯»å†™ã€åˆ›å»ºã€åˆ é™¤ã€ç›‘å¬ï¼‰ï¼Œç®¡ç† `FileWatcher`ã€‚ |
| `markdown-service` | é’ˆå¯¹ Markdown æ–‡ä»¶çš„ç‰¹åŒ–æœåŠ¡ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®æ‰«æã€å¸¦é˜Ÿåˆ—çš„è¯»å†™æ“ä½œã€æ–‡ä»¶å¤‡ä»½ç­‰ã€‚ |
| `project-service`  | è´Ÿè´£é¡¹ç›®çš„åˆ›å»ºï¼ˆæ¨¡æ¿åŒ–ï¼‰ã€éªŒè¯é¡¹ç›®ç»“æ„ã€åˆå§‹åŒ–é…ç½®æ–‡ä»¶ã€‚   |
| `window-service`   | ç®¡ç† `BrowserWindow` å®ä¾‹å’Œæ¸²æŸ“è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯å¤šçª—å£æ¶æ„çš„æ ¸å¿ƒã€‚ |

## ğŸ”Œ æ’ä»¶åŒ–ç³»ç»Ÿ (Client/Utils/Plugins/)

Nimbria çš„å‘½ä»¤é¢æ¿å’Œå³ä¾§æ åŠŸèƒ½æ˜¯åŸºäºæ’ä»¶åŒ–æ¨¡å¼æ„å»ºçš„ã€‚

- **å‘½ä»¤æ’ä»¶** (`commands/`): æ¯ä¸ª `*.plugin.ts` æ–‡ä»¶æ³¨å†Œä¸€ç»„ç›¸å…³çš„å‘½ä»¤ã€‚
- **é¢æ¿æ’ä»¶** (`panels/`): æ¯ä¸ª `*.plugin.ts` æ–‡ä»¶æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªå³ä¾§æ é¢æ¿ã€‚

è¿™ç§æ¨¡å¼ä½¿å¾—æ·»åŠ æ–°å‘½ä»¤æˆ–æ–°é¢æ¿æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼Œåªéœ€åˆ›å»ºå¹¶æ³¨å†Œæ–°çš„æ’ä»¶æ–‡ä»¶å³å¯ã€‚

## âš™ï¸ é…ç½®ä¿®æ”¹é¡¹

### quasar.config.ts è·¯å¾„åˆ«å

```typescript
// Client/ å†…éƒ¨åˆ«å
{ find: '@', replacement: 'Client' },
{ find: '@types', replacement: 'Client/types' },
{ find: '@components', replacement: 'Client/GUI/components' },
{ find: '@layouts', replacement: 'Client/GUI/layouts' },
{ find: '@pages', replacement: 'Client/GUI/PagesLayout' },
{ find: '@stores', replacement: 'Client/stores' },
{ find: '@index', replacement: 'Client/GUI/Index' },
{ find: '@service', replacement: 'Client/Service' },
{ find: '@utils', replacement: 'Client/Utils' },
```

