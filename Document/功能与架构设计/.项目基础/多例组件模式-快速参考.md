# å¤šä¾‹ç»„ä»¶æ¨¡å¼ - å¿«é€Ÿå‚è€ƒå¡

## ğŸš€ 3åˆ†é’Ÿå¿«é€Ÿå®ç°

### Step 1: æ·»åŠ `:key` (ç»„ä»¶å±‚)

```vue
<!-- PaneContent.vue -->
<YourComponent
  v-if="condition"
  :key="`component-${uniqueId}`"
  :tab-id="uniqueId"
/>
```

### Step 2: åˆ›å»ºStore (çŠ¶æ€å±‚)

```typescript
// yourComponent.store.ts
import { defineStore } from 'pinia'

interface State {
  tabId: string
  // ä½ çš„çŠ¶æ€...
}

export const useYourComponentStore = defineStore('yourComponent', () => {
  const instances = ref<Map<string, State>>(new Map())
  
  const initInstance = (tabId: string): State => {
    if (instances.value.has(tabId)) {
      return instances.value.get(tabId)!
    }
    const newInstance = { tabId /* åˆå§‹çŠ¶æ€ */ }
    instances.value.set(tabId, newInstance)
    return newInstance
  }
  
  const updateInstance = (tabId: string, updates: Partial<State>) => {
    const instance = instances.value.get(tabId)
    if (instance) Object.assign(instance, updates)
  }
  
  const removeInstance = (tabId: string) => {
    instances.value.delete(tabId)
  }
  
  return { instances, initInstance, updateInstance, removeInstance }
})
```

### Step 3: ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ (ç»„ä»¶å±‚)

```vue
<script setup lang="ts">
const props = defineProps<{ tabId: string }>()
const store = useYourComponentStore()

// æœ¬åœ°çŠ¶æ€
const localState = ref('')

// æŒ‚è½½ï¼šæ¢å¤çŠ¶æ€
onMounted(() => {
  const state = store.initInstance(props.tabId)
  localState.value = state.xxx
})

// å¸è½½ï¼šä¿å­˜çŠ¶æ€
onUnmounted(() => {
  store.updateInstance(props.tabId, {
    xxx: localState.value
  })
})
</script>
```

---

## âš ï¸ å¸¸è§é”™è¯¯é€ŸæŸ¥

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| çŠ¶æ€æ··ä¹± | ç¼ºå°‘`:key` | æ·»åŠ `:key="\`type-${id}\`"` |
| Linté”™è¯¯ | keyä¸å”¯ä¸€ | ä½¿ç”¨ç»„åˆkeyï¼š`type-${id}` |
| å­ç»„ä»¶ä¸æ›´æ–° | å­ç»„ä»¶ç”¨ref | ç”¨computedåŒæ­¥props |
| å†…å­˜æ³„æ¼ | æœªæ¸…ç†èµ„æº | onUnmountedä¸­æ¸…ç† |
| çŠ¶æ€ä¸¢å¤± | æœªæŒä¹…åŒ– | onUnmountedä¿å­˜åˆ°store |

---

## ğŸ“‹ æ¯æ¬¡å¼€å‘æ£€æŸ¥æ¸…å•

ç»„ä»¶æ–‡ä»¶ (`.vue`):
- [ ] æ·»åŠ `:key`å±æ€§
- [ ] æ·»åŠ `:tab-id` prop
- [ ] onMountedæ¢å¤çŠ¶æ€
- [ ] onUnmountedä¿å­˜çŠ¶æ€
- [ ] æ¸…ç†èµ„æºï¼ˆlisteners, observersç­‰ï¼‰

Storeæ–‡ä»¶ (`.store.ts`):
- [ ] ä½¿ç”¨`Map<string, State>`
- [ ] å®ç°`initInstance`
- [ ] å®ç°`updateInstance`
- [ ] å®ç°`removeInstance`

è°ƒè¯•:
- [ ] æŒ‚è½½æ—¶æ‰“å°æ—¥å¿—
- [ ] å¸è½½æ—¶æ‰“å°æ—¥å¿—
- [ ] éªŒè¯æ¯ä¸ªå®ä¾‹ç‹¬ç«‹

---

## ğŸ” è°ƒè¯•æ¨¡æ¿

```typescript
onMounted(() => {
  console.log(`[YourComponent ${props.tabId}] Mounted`, {
    state: storeState
  })
})

onUnmounted(() => {
  console.log(`[YourComponent ${props.tabId}] Unmounted`, {
    savedState: { /* ... */ }
  })
})
```

æœŸæœ›æ—¥å¿—ï¼š
```
âœ… [Component tab-1] Mounted
âœ… [Component tab-2] Mounted
âœ… [Component tab-2] Unmounted  // åˆ‡æ¢æ ‡ç­¾é¡µ
âœ… [Component tab-1] Mounted (é‡æ–°æŒ‚è½½)
```

âŒ å¦‚æœçœ‹ä¸åˆ°é‡æ–°Mountedï¼Œè¯´æ˜keyæœ‰é—®é¢˜ï¼

---

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š[å¤šä¾‹ç»„ä»¶æ¨¡å¼æŒ‡å—.md](./å¤šä¾‹ç»„ä»¶æ¨¡å¼æŒ‡å—.md)

