# StarChart ç³»ç»Ÿ - é‡æ„åå®Œæ•´æ¶æ„

**é‡æ„æ—¥æœŸ**ï¼š2025å¹´10æœˆ21æ—¥  
**ç‰ˆæœ¬**ï¼šv2.0ï¼ˆé‡æ„ç‰ˆï¼‰

---

## ğŸ“ å®Œæ•´æ–‡ä»¶æ¶æ„æ ‘

```
Nimbria/Client/Service/StarChart/
â”œâ”€â”€ Engine/                                    # æ¸²æŸ“å¼•æ“æ ¸å¿ƒï¼ˆé€šç”¨ï¼‰
â”‚   â”œâ”€â”€ EngineCore.ts [æ–°å¢]                   # ç»Ÿä¸€å¯¼å‡ºå’Œåˆå§‹åŒ–ç®¡ç†
â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šç®¡ç†æ‰€æœ‰ Engine æ¨¡å—çš„åˆå§‹åŒ–é¡ºåº
â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šæä¾›ç»Ÿä¸€çš„ API æ¥å£
â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šç¡®ä¿ä¾èµ–å…³ç³»æ­£ç¡®ï¼ˆSigmaManager â†’ DataManager â†’ å…¶ä»–ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ SigmaManager/ [å®Œå…¨é‡å†™]
â”‚   â”‚   â”œâ”€â”€ SigmaManager.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå®Œæ•´å®ç° Sigma + Graphology åˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå®ç° nodeReducer å’Œ edgeReducer æ”¯æŒ
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šCamera API è®¿é—®æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šä¸¥æ ¼ç±»å‹ï¼ˆimport Sigma, Graphï¼‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ DataManager/ [æ–°å¢æ¨¡å—]
â”‚   â”‚   â”œâ”€â”€ DataManager.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šåˆ†å—æ•°æ®åŠ è½½å™¨ï¼ˆChunk-basedï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå†…å­˜æ•°æ®ç®¡ç†ï¼ˆHot/Warm/Coldï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šæ‰¹é‡æ·»åŠ /ç§»é™¤èŠ‚ç‚¹åˆ° Graphology
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå†…å­˜ç»Ÿè®¡å’Œç›‘æ§
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ RenderScheduler/ [å®Œå…¨é‡å†™]
â”‚   â”‚   â”œâ”€â”€ RenderScheduler.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šç›´æ¥æ“ä½œ Graphology (graph.setNodeAttribute)
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šæ™ºèƒ½åˆ¤æ–­ skipIndexation
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šä½¿ç”¨ requestAnimationFrame é˜²æŠ–
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šè°ƒç”¨ sigma.refresh() è€Œéè‡ªå®šä¹‰æ¸²æŸ“
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ ViewportManager/ [å®Œå…¨é‡å†™]
â”‚   â”‚   â”œâ”€â”€ ViewportManager.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šä½¿ç”¨ Sigma Camera API
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šcamera.graphToViewport() åæ ‡è½¬æ¢
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šcamera.viewportToGraph() é€†è½¬æ¢
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šç›‘å¬ Sigma çš„ afterRender äº‹ä»¶
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ EventBus/ [å®Œå…¨é‡å†™]
â”‚   â”‚   â”œâ”€â”€ EventBus.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šæ¡¥æ¥ Sigma.js åŸç”Ÿäº‹ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šsigma.on('clickNode') â†’ eventBus.emit('node:click')
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šè‡ªåŠ¨è§£ç»‘äº‹ä»¶é˜²æ­¢å†…å­˜æ³„æ¼
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ AsyncTaskManager/ [ä¿®æ”¹]
â”‚   â”‚   â”œâ”€â”€ AsyncTaskManager.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šä¿®æ­£ Worker æ¶ˆæ¯åè®®
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šä¸¥æ ¼çš„æ¶ˆæ¯ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ SpatialIndex/ [ä¿ç•™]
â”‚   â”‚   â”œâ”€â”€ SpatialIndex.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå››å‰æ ‘ç©ºé—´ç´¢å¼•
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ PerformanceMonitor/ [ä¿ç•™]
â”‚   â”‚   â”œâ”€â”€ PerformanceMonitor.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ MemoryManager/ [ä¿ç•™]
â”‚   â”‚   â”œâ”€â”€ MemoryManager.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ Logger/ [ä¿ç•™]
â”‚   â”‚   â”œâ”€â”€ Logger.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ ConfigManager/ [ä¿ç•™]
â”‚   â”‚   â”œâ”€â”€ ConfigManager.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ LayerManager/ [ä¿ç•™]
â”‚   â”‚   â”œâ”€â”€ LayerManager.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ index.ts [ä¿®æ”¹]
â”‚       â””â”€â”€ å¯¼å‡ºæ‰€æœ‰ Engine æ¨¡å—
â”‚
â”œâ”€â”€ Graphs/ [æ–°å¢ç›®å½•]                         # å…·ä½“å›¾å®ç°ï¼ˆä¸šåŠ¡ï¼‰
â”‚   â”œâ”€â”€ BaseGraph.ts [æ–°å¢]
â”‚   â”‚   â””â”€â”€ æŠ½è±¡åŸºç±»ï¼šå®šä¹‰å›¾çš„ç”Ÿå‘½å‘¨æœŸ
â”‚   â”‚   â””â”€â”€ æä¾› Engine API è®¿é—®
â”‚   â”‚   â””â”€â”€ å®šä¹‰æ•°æ®åŠ è½½ã€å¸ƒå±€ã€äº¤äº’çš„æŠ½è±¡æ–¹æ³•
â”‚   â”‚
â”‚   â”œâ”€â”€ RecipeGraph/ [æ–°å¢]
â”‚   â”‚   â”œâ”€â”€ RecipeGraph.ts
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šMC é…æ–¹å›¾å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šèŠ‚ç‚¹å±•å¼€/æ”¶èµ·é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå…­è¾¹å½¢åˆ†åŒºï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå¼§å½¢å¸ƒå±€ç®—æ³•
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ index.ts [æ–°å¢]
â”‚
â”œâ”€â”€ Workers/                                   # Web Worker æ¨¡å—
â”‚   â”œâ”€â”€ LayoutWorker/
â”‚   â”‚   â”œâ”€â”€ layout.worker.ts [ä¿®æ”¹]
â”‚   â”‚   â”‚   â””â”€â”€ å†…éƒ¨æ¨¡å—ï¼šå®Œå–„æ¶ˆæ¯åè®®
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ SpatialWorker/
â”‚   â”‚   â”œâ”€â”€ spatial.worker.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ index.ts [å®Œå…¨é‡å†™]
â”‚   â””â”€â”€ å¯¼å‡º Engine + Graphs + ç±»å‹
â”‚
â”œâ”€â”€ visualizationService.ts [ä¿ç•™]
â”‚
â”œâ”€â”€ starChart.service.types.ts [ä¿ç•™]
â”‚
â””â”€â”€ README.md [æ–°å¢]
    â””â”€â”€ å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹
```

---

## ğŸ”„ ç±»å‹ç³»ç»Ÿæ¶æ„

```
Client/types/Business/StarChart/
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ public.ts [å®Œå…¨é‡å†™]
â”‚   â”‚   â”œâ”€â”€ å¯¼å…¥ Sigma.js å®˜æ–¹ç±»å‹ï¼ˆSigma, Camera, NodeDisplayData ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ å¯¼å…¥ Graphology å®˜æ–¹ç±»å‹ï¼ˆGraph, Attributesï¼‰
â”‚   â”‚   â”œâ”€â”€ StarChartEngineAPIï¼ˆç»Ÿä¸€ APIï¼‰
â”‚   â”‚   â”œâ”€â”€ NodeData/EdgeDataï¼ˆæ·»åŠ  size, color ç­‰å¿…éœ€å±æ€§ï¼‰
â”‚   â”‚   â”œâ”€â”€ NodeReducer/EdgeReducerï¼ˆåŠ¨æ€æ ·å¼ç±»å‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ DataManagerAPIï¼ˆæ¸è¿›å¼åŠ è½½ APIï¼‰
â”‚   â”‚   â””â”€â”€ æ‰€æœ‰ API æ¥å£ä¸¥æ ¼ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ internal.ts [ä¿®æ”¹]
â”‚   â”‚   â””â”€â”€ ç§»é™¤ any ç±»å‹
â”‚   â”‚   â””â”€â”€ ä¸¥æ ¼å®šä¹‰ Worker æ¶ˆæ¯åè®®
â”‚   â”‚
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ public.ts
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ Renderer/
â”‚   â”œâ”€â”€ public.ts
â”‚   â””â”€â”€ index.ts
â”‚
â””â”€â”€ index.ts [ä¿®æ”¹]
    â””â”€â”€ å¯¼å‡ºæ‰€æœ‰ç±»å‹
```

---

## ğŸ”€ æ•°æ®æµæ¶æ„

### å®Œæ•´çš„æ•°æ®æµï¼ˆä¿®æ­£åï¼‰

```
ç”¨æˆ·äº¤äº’
    â†“
Graph å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
    â†“
Engine API è°ƒç”¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Engine æ ¸å¿ƒ                         â”‚
â”‚                                     â”‚
â”‚  DataManager.loadChunk()            â”‚
â”‚    â†“                                â”‚
â”‚  graph.addNode() (Graphology)      â”‚
â”‚    â†“                                â”‚
â”‚  Sigma.js è‡ªåŠ¨ç›‘å¬                  â”‚
â”‚    â†“                                â”‚
â”‚  Sigma.js è‡ªåŠ¨ refresh()            â”‚
â”‚    â†“                                â”‚
â”‚  WebGL/Canvas æ¸²æŸ“                  â”‚
â”‚                                     â”‚
â”‚  æˆ–è€…ï¼š                             â”‚
â”‚                                     â”‚
â”‚  RenderScheduler.scheduleUpdate()  â”‚
â”‚    â†“                                â”‚
â”‚  graph.setNodeAttribute()          â”‚
â”‚    â†“                                â”‚
â”‚  sigma.refresh({ skipIndexation }) â”‚
â”‚    â†“                                â”‚
â”‚  å¢é‡æ¸²æŸ“                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Worker åå°è®¡ç®—æµç¨‹

```
Graph.computeLayout()
    â†“
AsyncTaskManager.computeLayout()
    â†“
LayoutWorkerï¼ˆåå°è®¡ç®—ï¼‰
    â†“
Worker è¿”å› positions: { nodeId: { x, y } }
    â†“
Graph å±‚å¤„ç†ç»“æœï¼š
  for (const [nodeId, pos] of Object.entries(positions)) {
    graph.setNodeAttribute(nodeId, 'x', pos.x)
    graph.setNodeAttribute(nodeId, 'y', pos.y)
  }
    â†“
Sigma.js è‡ªåŠ¨ç›‘å¬ â†’ è‡ªåŠ¨åˆ·æ–°
```

---

## ğŸ¯ å…³é”®è®¾è®¡åŸåˆ™

### 1. èŒè´£åˆ†ç¦»

| å±‚çº§ | èŒè´£ | ä¸è´Ÿè´£ |
|------|------|--------|
| **Graphology** | æ•°æ®å­˜å‚¨ | æ¸²æŸ“ã€å¸ƒå±€ |
| **Sigma.js** | æ¸²æŸ“ã€äº¤äº’ | æ•°æ®ç®¡ç†ã€ä¸šåŠ¡é€»è¾‘ |
| **Engine** | åè°ƒã€API æä¾› | ä¸šåŠ¡é€»è¾‘ |
| **Graph** | ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åŠ è½½ç­–ç•¥ | åº•å±‚æ¸²æŸ“ |

### 2. æ•°æ®å”¯ä¸€æ€§

- **å”¯ä¸€æ•°æ®æº**ï¼šGraphology Graph å®ä¾‹
- **åªè¯»è§†å›¾**ï¼šReducer æä¾›åŠ¨æ€è§†å›¾ï¼Œä¸ä¿®æ”¹åŸå§‹æ•°æ®
- **å†™æ“ä½œ**ï¼šæ‰€æœ‰ä¿®æ”¹éƒ½é€šè¿‡ `graph.setNodeAttribute()` ç­‰ API

### 3. äº‹ä»¶é©±åŠ¨

- **Sigma.js äº‹ä»¶** â†’ EventBus ç»Ÿä¸€åˆ†å‘
- **Engine äº‹ä»¶** â†’ Graph å±‚å“åº”
- **Graph äº‹ä»¶** â†’ GUI å±‚å“åº”

### 4. ç±»å‹å®‰å…¨

- **å¯¼å…¥å®˜æ–¹ç±»å‹**ï¼š`Sigma`, `Graph`, `Camera` ç­‰
- **é›¶ any ç±»å‹**ï¼šæ‰€æœ‰æ¥å£ä¸¥æ ¼ç±»å‹
- **ç¼–è¯‘æ—¶æ£€æŸ¥**ï¼šTypeScript strict æ¨¡å¼

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [StarChart ç³»ç»Ÿä»‹ç»](./StarChartç³»ç»Ÿ-æ¸²æŸ“å¼•æ“ä»‹ç»1.md)
- [Sigma.js å…¼å®¹æ€§ Review](./StarChartç³»ç»Ÿ-æ¸²æŸ“å¼•æ“ä»‹ç»1.md#æ·±åº¦-review)
- [å›¾æ•°æ®å¯è§†åŒ–è§†å£è®¾è®¡](../../../Design/æ•°æ®åº“ç³»ç»Ÿ/å›¾æ•°æ®å¯è§†åŒ–è§†å£.md)
- [é‡æ„å®Œæˆæ€»ç»“](../../æ€»ç»“/StarChartæ¸²æŸ“å¼•æ“é‡æ„å®Œæˆ_2025-10-21.md)

---

**é‡æ„å®Œæˆæ ‡å¿—**ï¼šâœ… æ‰€æœ‰æ ¸å¿ƒé—®é¢˜å·²ä¿®å¤ï¼Œç³»ç»Ÿå·²å¯ç”¨ï¼

