{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "multi-region",
  "title": "解剖学题库完整解析Schema",
  "description": "解析题目答案分离的解剖学题库，通过章节、题型、题号三级匹配关联数据",
  
  "regions": [
    {
      "name": "questions",
      "description": "题目内容区域（第1-51158行）",
      "range": {
        "start": 1,
        "end": 51158
      },
      "schema": {
        "type": "array",
        "title": "题目列表",
        "description": "包含所有章节的所有题目",
        "items": {
          "type": "object",
          "properties": {
            "chapterNumber": {
              "type": "string",
              "description": "章节号（第一章、第二章...第十七章）",
              "x-parse": {
                "pattern": "^#\\s*第([一二三四五六七八九十]+)章",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              },
              "x-export": {
                "type": "column",
                "columnName": "章节号",
                "columnOrder": 1,
                "columnWidth": 10
              }
            },
            "chapterName": {
              "type": "string",
              "description": "章节名称",
              "x-parse": {
                "pattern": "^#\\s*第[一二三四五六七八九十]+章\\s+(.+)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              },
              "x-export": {
                "type": "column",
                "columnName": "章节名称",
                "columnOrder": 2,
                "columnWidth": 20
              }
            },
            "questionType": {
              "type": "string",
              "description": "题型（A1型题、B1型题、X型题、A2型题、名词解释、问答题）",
              "x-parse": {
                "pattern": "^#\\s*[一二三四五六]、(.+)$",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              },
              "x-export": {
                "type": "column",
                "columnName": "题型",
                "columnOrder": 3,
                "columnWidth": 25
              }
            },
            "questionNumber": {
              "type": "string",
              "description": "题号",
              "x-parse": {
                "pattern": "^(\\d+)[.、]",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              },
              "x-export": {
                "type": "column",
                "columnName": "题号",
                "columnOrder": 4,
                "columnWidth": 8
              }
            },
            "questionContent": {
              "type": "string",
              "description": "题目主干内容",
              "x-parse": {
                "pattern": "(?<=^\\d+[.、]\\s*)(.+?)(?=\\n[A-E][.、]|\\n\\d+[.、]|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "题目内容",
                "columnOrder": 5,
                "columnWidth": 60
              }
            },
            "optionA": {
              "type": "string",
              "description": "选项A（仅选择题有）",
              "x-parse": {
                "pattern": "A[.、]\\s*(.+?)(?=\\n[B-E][.、]|\\n\\d+[.、]|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "A选项",
                "columnOrder": 6,
                "columnWidth": 30
              }
            },
            "optionB": {
              "type": "string",
              "description": "选项B",
              "x-parse": {
                "pattern": "B[.、]\\s*(.+?)(?=\\n[C-E][.、]|\\n\\d+[.、]|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "B选项",
                "columnOrder": 7,
                "columnWidth": 30
              }
            },
            "optionC": {
              "type": "string",
              "description": "选项C",
              "x-parse": {
                "pattern": "C[.、]\\s*(.+?)(?=\\n[D-E][.、]|\\n\\d+[.、]|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "C选项",
                "columnOrder": 8,
                "columnWidth": 30
              }
            },
            "optionD": {
              "type": "string",
              "description": "选项D",
              "x-parse": {
                "pattern": "D[.、]\\s*(.+?)(?=\\nE[.、]|\\n\\d+[.、]|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "D选项",
                "columnOrder": 9,
                "columnWidth": 30
              }
            },
            "optionE": {
              "type": "string",
              "description": "选项E",
              "x-parse": {
                "pattern": "E[.、]\\s*(.+?)(?=\\n\\d+[.、]|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "E选项",
                "columnOrder": 10,
                "columnWidth": 30
              }
            },
            "matchKey": {
              "type": "string",
              "description": "匹配键（章节号-题型-题号，用于关联答案）",
              "x-parse": {
                "pattern": ".*",
                "mode": "extract",
                "flags": "s"
              },
              "x-export": {
                "type": "ignore"
              }
            }
          },
          "required": ["chapterNumber", "questionType", "questionNumber", "questionContent"]
        }
      }
    },
    {
      "name": "answers",
      "description": "答案区域（从'附录 参考答案'开始到文档末尾）",
      "marker": {
        "start": "# 附录 参考答案"
      },
      "schema": {
        "type": "array",
        "title": "答案列表",
        "description": "包含所有章节的所有题目答案",
        "items": {
          "type": "object",
          "properties": {
            "chapterNumber": {
              "type": "string",
              "description": "章节号",
              "x-parse": {
                "pattern": "^#\\s*第([一二三四五六七八九十]+)章",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              }
            },
            "chapterName": {
              "type": "string",
              "description": "章节名称",
              "x-parse": {
                "pattern": "^#\\s*第[一二三四五六七八九十]+章\\s+(.+)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              }
            },
            "questionType": {
              "type": "string",
              "description": "题型",
              "x-parse": {
                "pattern": "^#\\s*[一二三四五六]、(.+)$",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              }
            },
            "questionNumber": {
              "type": "string",
              "description": "题号",
              "x-parse": {
                "pattern": "^(\\d+)[.、]",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "m"
              }
            },
            "answerContent": {
              "type": "string",
              "description": "答案内容（可能是单个字母、多个字母、文本描述）",
              "x-parse": {
                "pattern": "(?<=^\\d+[.、]\\s*)(.+?)(?=\\n\\d+[.、]|\\n#|$)",
                "mode": "extract",
                "captureGroups": [1],
                "flags": "ms"
              },
              "x-export": {
                "type": "column",
                "columnName": "答案",
                "columnOrder": 11,
                "columnWidth": 50,
                "format": {
                  "bold": true,
                  "alignment": "left"
                }
              }
            },
            "matchKey": {
              "type": "string",
              "description": "匹配键（章节号-题型-题号）",
              "x-parse": {
                "pattern": ".*",
                "mode": "extract",
                "flags": "s"
              },
              "x-export": {
                "type": "ignore"
              }
            }
          },
          "required": ["chapterNumber", "questionType", "questionNumber", "answerContent"]
        }
      }
    }
  ],
  
  "postProcessors": [
    {
      "type": "merge-lookup",
      "name": "关联题目和答案",
      "description": "通过章节号、题型、题号三级匹配关联题目和答案",
      "sourceRegion": "questions",
      "lookupRegion": "answers",
      "matchFields": {
        "source": "matchKey",
        "lookup": "matchKey"
      },
      "strategy": "exact",
      "mergeMode": "extend",
      "matchLogic": {
        "description": "matchKey = chapterNumber + '-' + questionType + '-' + questionNumber",
        "example": "第一章-A1型题（单句型最佳选择题）-1"
      }
    }
  ],
  
  "metadata": {
    "version": "1.0.0",
    "createdAt": "2025-10-13",
    "documentInfo": {
      "totalLines": 53053,
      "questionLines": "1-51158",
      "answerLines": "51159-53053",
      "chapters": 17,
      "questionTypes": [
        "A1型题（单句型最佳选择题）",
        "B1型题（标准配伍题）",
        "X型题（多项选择题）",
        "A2型题（病例摘要型最佳选择题）",
        "名词解释",
        "问答题"
      ]
    },
    "notes": [
      "章节号使用中文数字（一、二、三...十七）",
      "题型固定为6种，每章都有这6种题型",
      "题号是连续的阿拉伯数字",
      "选择题有A-E五个选项",
      "名词解释和问答题没有选项",
      "答案格式多样：单选答案为单个字母，多选为多个字母，名词解释和问答题为文本描述",
      "匹配策略：exact精确匹配，基于章节号+题型+题号组合键"
    ],
    "knownIssues": [
      {
        "issue": "答案区域第十章缺少'二、B1型题'",
        "line": "51940行附近",
        "workaround": "手工补充或在后处理中标记为缺失"
      },
      {
        "issue": "部分问答题答案包含子问题编号",
        "example": "1. 描述... 2. 描述...",
        "solution": "使用更复杂的正则提取完整答案内容"
      }
    ]
  },
  
  "exportConfig": {
    "filename": "解剖学题库_完整版.xlsx",
    "sheetName": "题库",
    "headers": true,
    "autoFilter": true,
    "freezePane": {
      "row": 1,
      "col": 0
    },
    "columnGroups": [
      {
        "name": "基本信息",
        "columns": ["章节号", "章节名称", "题型", "题号"]
      },
      {
        "name": "题目内容",
        "columns": ["题目内容", "A选项", "B选项", "C选项", "D选项", "E选项"]
      },
      {
        "name": "答案",
        "columns": ["答案"]
      }
    ]
  }
}

