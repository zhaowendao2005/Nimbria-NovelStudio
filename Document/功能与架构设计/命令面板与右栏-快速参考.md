# å‘½ä»¤é¢æ¿ä¸å³æ ç³»ç»Ÿ - å¿«é€Ÿå‚è€ƒ

> å¿«é€ŸæŸ¥é˜…æ‰‹å†Œï¼Œè¯¦ç»†æŒ‡å—è¯·å‚è€ƒ [å®Œæ•´å¼€å‘æŒ‡å—](..\Workflow\å‘½ä»¤é¢æ¿ä¸å³æ ç³»ç»Ÿå¼€å‘æŒ‡å—.md)

---

## ğŸš€ 5åˆ†é’Ÿä¸Šæ‰‹

### æ·»åŠ æ–°å‘½ä»¤

1. **åˆ›å»ºæ’ä»¶æ–‡ä»¶** `Client/Utils/Plugins/commands/my-commands.plugin.ts`:
   ```typescript
   import { commandApi } from '@service/CommandPanelRightSidebar/command.api'
   
   export function registerMyCommands() {
     commandApi.register({
       id: 'my.action',
       label: 'æˆ‘çš„æ“ä½œ',
       category: 'custom',
       action: () => { console.log('æ‰§è¡Œ!') }
     })
   }
   ```

2. **æ³¨å†Œæ’ä»¶** `Client/Utils/Plugins/commands/index.ts`:
   ```typescript
   import { registerMyCommands } from './my-commands.plugin'
   
   export function registerAllCommandPlugins() {
     // ...
     registerMyCommands()  // æ·»åŠ è¿™ä¸€è¡Œ
   }
   ```

3. **æµ‹è¯•**: `Ctrl+Shift+P` â†’ æœç´¢ "æˆ‘çš„æ“ä½œ"

---

### æ·»åŠ æ–°é¢æ¿

1. **åˆ›å»ºç»„ä»¶** `Client/GUI/components/ProjectPage.Shell/RightSidebar/panels/MyPanel.vue`:
   ```vue
   <template>
     <div class="my-panel">
       <h3>æˆ‘çš„é¢æ¿</h3>
     </div>
   </template>
   
   <script setup lang="ts">
   // ä½ çš„é€»è¾‘
   </script>
   
   <style scoped>
   .my-panel { padding: 16px; }
   </style>
   ```

2. **åˆ›å»ºæ’ä»¶** `Client/Utils/Plugins/panels/my-panel.plugin.ts`:
   ```typescript
   import { rightSidebarApi } from '@service/CommandPanelRightSidebar/rightSidebar.api'
   import { defineAsyncComponent } from 'vue'
   
   export function registerMyPanel() {
     rightSidebarApi.register({
       id: 'my-panel',
       label: 'æˆ‘çš„é¢æ¿',
       component: defineAsyncComponent(() => 
         import('@components/ProjectPage.Shell/RightSidebar/panels/MyPanel.vue')
       )
     })
   }
   ```

3. **æ³¨å†Œæ’ä»¶** `Client/Utils/Plugins/panels/index.ts`:
   ```typescript
   import { registerMyPanel } from './my-panel.plugin'
   
   export function registerAllPanelPlugins() {
     // ...
     registerMyPanel()  // æ·»åŠ è¿™ä¸€è¡Œ
   }
   ```

---

## ğŸ“ å‘½ä»¤å®šä¹‰é€ŸæŸ¥

```typescript
interface Command {
  id: string                           // 'category.action' (å¿…éœ€)
  label: string                        // 'æ˜¾ç¤ºæ–‡æœ¬' (å¿…éœ€)
  category: CommandCategory            // 'view'|'file'|'edit'|'navigate'|'tools'|'custom' (å¿…éœ€)
  action: () => void | Promise<void>   // æ‰§è¡Œå‡½æ•° (å¿…éœ€)
  icon?: string                        // Element Plus icon name
  keywords?: string[]                  // ['æœç´¢', 'keyword']
  shortcut?: string                    // 'Ctrl+S' (ä»…å±•ç¤º)
  priority?: number                    // æ•°å€¼è¶Šå¤§è¶Šé å‰
  when?: () => boolean                 // æ˜¾ç¤ºæ¡ä»¶
}
```

**ç¤ºä¾‹**:
```typescript
{
  id: 'file.save',
  label: 'ä¿å­˜æ–‡ä»¶',
  category: 'file',
  keywords: ['save', 'ä¿å­˜', 'ctrl+s'],
  shortcut: 'Ctrl+S',
  priority: 100,
  action: async () => {
    await markdownStore.saveFile()
  },
  when: () => markdownStore.hasUnsavedChanges
}
```

---

## ğŸ“ é¢æ¿å®šä¹‰é€ŸæŸ¥

```typescript
interface RightSidebarPanel {
  id: string                    // å”¯ä¸€æ ‡è¯† (å¿…éœ€)
  label: string                 // æ ‡ç­¾æ–‡æœ¬ (å¿…éœ€)
  component: Component          // Vueç»„ä»¶ (å¿…éœ€)
  icon?: string                 // Element Plus icon name
  closable?: boolean            // æ˜¯å¦å¯å…³é—­ (é»˜è®¤ true)
  order?: number                // æ’åºæƒé‡ (æ•°å€¼è¶Šå°è¶Šé å‰)
  when?: () => boolean          // æ˜¾ç¤ºæ¡ä»¶
}
```

**ç¤ºä¾‹**:
```typescript
{
  id: 'outline',
  label: 'å¤§çº²',
  icon: 'List',
  closable: true,
  order: 1,
  component: defineAsyncComponent(() => 
    import('@components/ProjectPage.Shell/RightSidebar/panels/OutlinePanel.vue')
  ),
  when: () => markdownStore.hasOpenFile
}
```

---

## ğŸ”— API é€ŸæŸ¥

### å‘½ä»¤ API

```typescript
import { commandApi } from '@service/CommandPanelRightSidebar/command.api'

// æ³¨å†Œå‘½ä»¤
commandApi.register(command)
commandApi.registerBatch([command1, command2])

// æ‰§è¡Œå‘½ä»¤
await commandApi.execute('command.id')

// æ§åˆ¶é¢æ¿
commandApi.open()
commandApi.close()
commandApi.toggle()

// æŸ¥è¯¢
commandApi.getAvailableCommands()
commandApi.findCommand('command.id')
```

### å³ä¾§æ  API

```typescript
import { rightSidebarApi } from '@service/CommandPanelRightSidebar/rightSidebar.api'

// æ³¨å†Œé¢æ¿
rightSidebarApi.register(panel)

// åˆ‡æ¢é¢æ¿
rightSidebarApi.switchTo('panel-id')
rightSidebarApi.switchToNext()
rightSidebarApi.switchToPrev()

// æ˜¾ç¤ºæ§åˆ¶
rightSidebarApi.show()
rightSidebarApi.hide()
rightSidebarApi.toggle()
rightSidebarApi.setWidth('300px')

// æŸ¥è¯¢
rightSidebarApi.getAvailablePanels()
rightSidebarApi.getActivePanel()
rightSidebarApi.findPanel('panel-id')
```

---

## ğŸ”— è·¨æ¨¡å—çŠ¶æ€è®¿é—®

**æ ¸å¿ƒåŸåˆ™**: Pinia Store å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›´æ¥å¯¼å…¥ï¼Œæ— éœ€æ³¨å†Œã€‚

### åœ¨å‘½ä»¤æ’ä»¶ä¸­è®¿é—®å…¶ä»– Store

```typescript
import { useMarkdownStore } from '@stores/projectPage/Markdown'

// åœ¨ action å‡½æ•°å†…éƒ¨è°ƒç”¨
action: () => {
  const markdownStore = useMarkdownStore()
  markdownStore.saveCurrentFile()
}

// åœ¨ when() ä¸­ä½¿ç”¨
when: () => {
  const markdownStore = useMarkdownStore()
  return markdownStore.openTabs.length > 0
}
```

### åœ¨é¢æ¿ç»„ä»¶ä¸­è®¿é—® Store

```vue
<script setup lang="ts">
import { computed } from 'vue'
import { useMarkdownStore } from '@stores/projectPage/Markdown'

const markdownStore = useMarkdownStore()
const activeFile = computed(() => markdownStore.activeTab)
</script>
```

### âš ï¸ æ³¨æ„

- âœ… åœ¨å‡½æ•°**å†…éƒ¨**è°ƒç”¨ `useXxxStore()`
- âŒ ä¸è¦åœ¨æ¨¡å—**é¡¶å±‚**è°ƒç”¨

---

## ğŸ“ å…³é”®æ–‡ä»¶ä½ç½®

| åŠŸèƒ½ | è·¯å¾„ |
|------|------|
| **å‘½ä»¤æ’ä»¶** | `Client/Utils/Plugins/commands/` |
| **é¢æ¿æ’ä»¶** | `Client/Utils/Plugins/panels/` |
| **é¢æ¿ç»„ä»¶** | `Client/GUI/components/ProjectPage.Shell/RightSidebar/panels/` |
| **å‘½ä»¤ API** | `Client/Service/CommandPanelRightSidebar/command.api.ts` |
| **å³æ  API** | `Client/Service/CommandPanelRightSidebar/rightSidebar.api.ts` |
| **æ’ä»¶æ³¨å†Œå…¥å£** | `Client/GUI/Index/ProjectPageSystem.vue` |

---

## ğŸ¨ å¸¸ç”¨ Element Plus å›¾æ ‡

```
Document, Folder, FolderOpened, Files, 
Edit, Delete, Plus, Minus, Close, 
Search, View, Hide, Setting,
ArrowLeft, ArrowRight, ArrowUp, ArrowDown,
Check, Warning, InfoFilled
```

[å®Œæ•´å›¾æ ‡åˆ—è¡¨](https://element-plus.org/zh-CN/component/icon.html)

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å·²æ³¨å†Œçš„å‘½ä»¤
```typescript
import { useCommandPaletteStore } from '@stores/projectPage/commandPalette'

const store = useCommandPaletteStore()
console.log('æ‰€æœ‰å‘½ä»¤:', store.commands)
console.log('å¯ç”¨å‘½ä»¤:', store.availableCommands)
```

### 2. æŸ¥çœ‹å·²æ³¨å†Œçš„é¢æ¿
```typescript
import { useRightSidebarStore } from '@stores/projectPage/rightSidebar'

const store = useRightSidebarStore()
console.log('æ‰€æœ‰é¢æ¿:', store.panels)
console.log('å¯ç”¨é¢æ¿:', store.availablePanels)
```

### 3. æ’ä»¶æ³¨å†Œæ—¥å¿—
ç¡®ä¿æ§åˆ¶å°çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š
```
[ProjectPageSystem] Registering all plugins...
[Plugin] Outline panel registered
[Plugin] View commands registered
[ProjectPageSystem] All plugins registered successfully
```

---

## âš ï¸ å¸¸è§é”™è¯¯

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| å‘½ä»¤ä¸æ˜¾ç¤º | `when()` è¿”å› `false` | æ£€æŸ¥æ¡ä»¶é€»è¾‘ |
| é¢æ¿åŠ è½½å¤±è´¥ | ç»„ä»¶è·¯å¾„é”™è¯¯ | æ£€æŸ¥ `import()` è·¯å¾„ |
| API è°ƒç”¨å¤±è´¥ | æœªåœ¨ Vue ä¸Šä¸‹æ–‡ä¸­ | ç¡®ä¿åœ¨ç»„ä»¶æˆ–æ’ä»¶ä¸­è°ƒç”¨ |
| Store è®¿é—®å¤±è´¥ | åœ¨æ¨¡å—é¡¶å±‚è°ƒç”¨ | æ”¹ä¸ºåœ¨å‡½æ•°å†…éƒ¨è°ƒç”¨ `useXxxStore()` |

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å¼€å‘æŒ‡å—](./å‘½ä»¤é¢æ¿ä¸å³æ ç³»ç»Ÿå¼€å‘æŒ‡å—.md)
- [è®¾è®¡æ–‡æ¡£](../Design/å‘½ä»¤é¢æ¿ä¸å³æ é‡æ„/Design.md)

---

**ç‰ˆæœ¬**: v1.0 | **æ›´æ–°**: 2025-10-08

