# Nimbria 数据库模板修改工作流

**简化版本** - 直接告诉你要改哪些文件

---

## 🎯 修改数据库模板需要操作的文件

### 例子：从 v1.1.0 升级到 v1.2.0（添加用户偏好表）

## 📁 需要新增的文件

### 1. 新版本Schema文件
**文件**: `schema/versions/v1.2.0.schema.ts`
- 定义新表结构
- 继承旧版本未变更的表

### 2. 迁移脚本文件
**文件**: `schema/migrations/v1.2.0/005-add-user-preferences.migration.ts`
**文件**: `schema/migrations/v1.2.0/006-add-document-priority.migration.ts`
- 每个变更一个迁移文件
- 包含SQL和回滚逻辑

### 3. 新版本类型文件
**文件**: `types/database-v1.2.0.ts`
- 新增接口定义
- 扩展现有类型

## 📝 需要修改的文件

### 1. Schema版本注册
**文件**: `schema/versions/index.ts`
```typescript
// 添加新版本
export const SCHEMA_VERSIONS = {
  '1.0.0': PROJECT_SCHEMA_V1_0_0,
  '1.1.0': PROJECT_SCHEMA_V1_1_0,
  '1.2.0': PROJECT_SCHEMA_V1_2_0  // 新增这行
}

export const LATEST_SCHEMA_VERSION = '1.2.0'  // 更新这行
```

### 2. 迁移注册表
**文件**: `schema/migrations/registry.ts`
```typescript
// 添加新版本的迁移
export const MIGRATION_REGISTRY = {
  '1.0.0': [],
  '1.1.0': [...],
  '1.2.0': [  // 新增这个版本
    ADD_USER_PREFERENCES_MIGRATION,
    ADD_DOCUMENT_PRIORITY_MIGRATION
  ]
}
```

### 3. 类型导出
**文件**: `types/index.ts`
```typescript
// 导出最新版本
export * from './database-v1.2.0'

// 添加版本映射
export const DATABASE_TYPES_BY_VERSION = {
  '1.0.0': () => import('./database-v1.0.0'),
  '1.1.0': () => import('./database-v1.1.0'),
  '1.2.0': () => import('./database-v1.2.0')  // 新增这行
}
```

---

## 🎯 总结

**要修改数据库模板，你只需要：**

1. **新增3-4个文件**（Schema、迁移脚本、类型定义）
2. **修改3个文件**（版本注册、迁移注册、类型导出）

就这么简单！
